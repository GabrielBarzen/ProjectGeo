import { g as getContext, c as create_ssr_component, s as subscribe, e as escape } from "../../chunks/hooks.js";
import "../../chunks/exports.js";
import "devalue";
function get(key, parse = JSON.parse) {
  try {
    return parse(sessionStorage[key]);
  } catch {
  }
}
const SNAPSHOT_KEY = "sveltekit:snapshot";
const SCROLL_KEY = "sveltekit:scroll";
get(SCROLL_KEY) ?? {};
get(SNAPSHOT_KEY) ?? {};
const getStores = () => {
  const stores = getContext("__svelte__");
  return {
    /** @type {typeof page} */
    page: {
      subscribe: stores.page.subscribe
    },
    /** @type {typeof navigating} */
    navigating: {
      subscribe: stores.navigating.subscribe
    },
    /** @type {typeof updated} */
    updated: stores.updated
  };
};
const page = {
  subscribe(fn) {
    const store = getStores().page;
    return store.subscribe(fn);
  }
};
const Error$1 = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $page, $$unsubscribe_page;
  $$unsubscribe_page = subscribe(page, (value) => $page = value);
  $$unsubscribe_page();
  return `<h1>${escape($page.status)}</h1> <p>${escape($page.error?.message)}</p>`;
});
export {
  Error$1 as default
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3Iuc3ZlbHRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQHN2ZWx0ZWpzL2tpdC9zcmMvcnVudGltZS9jbGllbnQvc2Vzc2lvbi1zdG9yYWdlLmpzIiwiLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BzdmVsdGVqcy9raXQvc3JjL3J1bnRpbWUvY2xpZW50L2NvbnN0YW50cy5qcyIsIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9Ac3ZlbHRlanMva2l0L3NyYy9ydW50aW1lL2NsaWVudC9jbGllbnQuanMiLCIuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQHN2ZWx0ZWpzL2tpdC9zcmMvcnVudGltZS9hcHAvc3RvcmVzLmpzIiwiLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BzdmVsdGVqcy9raXQvc3JjL3J1bnRpbWUvY29tcG9uZW50cy9lcnJvci5zdmVsdGUiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSZWFkIGEgdmFsdWUgZnJvbSBgc2Vzc2lvblN0b3JhZ2VgXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5XG4gKiBAcGFyYW0geyh2YWx1ZTogc3RyaW5nKSA9PiBhbnl9IHBhcnNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXQoa2V5LCBwYXJzZSA9IEpTT04ucGFyc2UpIHtcblx0dHJ5IHtcblx0XHRyZXR1cm4gcGFyc2Uoc2Vzc2lvblN0b3JhZ2Vba2V5XSk7XG5cdH0gY2F0Y2gge1xuXHRcdC8vIGRvIG5vdGhpbmdcblx0fVxufVxuXG4vKipcbiAqIFdyaXRlIGEgdmFsdWUgdG8gYHNlc3Npb25TdG9yYWdlYFxuICogQHBhcmFtIHtzdHJpbmd9IGtleVxuICogQHBhcmFtIHthbnl9IHZhbHVlXG4gKiBAcGFyYW0geyh2YWx1ZTogYW55KSA9PiBzdHJpbmd9IHN0cmluZ2lmeVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUsIHN0cmluZ2lmeSA9IEpTT04uc3RyaW5naWZ5KSB7XG5cdGNvbnN0IGRhdGEgPSBzdHJpbmdpZnkodmFsdWUpO1xuXHR0cnkge1xuXHRcdHNlc3Npb25TdG9yYWdlW2tleV0gPSBkYXRhO1xuXHR9IGNhdGNoIHtcblx0XHQvLyBkbyBub3RoaW5nXG5cdH1cbn1cbiIsImV4cG9ydCBjb25zdCBTTkFQU0hPVF9LRVkgPSAnc3ZlbHRla2l0OnNuYXBzaG90JztcbmV4cG9ydCBjb25zdCBTQ1JPTExfS0VZID0gJ3N2ZWx0ZWtpdDpzY3JvbGwnO1xuZXhwb3J0IGNvbnN0IFNUQVRFU19LRVkgPSAnc3ZlbHRla2l0OnN0YXRlcyc7XG5leHBvcnQgY29uc3QgUEFHRV9VUkxfS0VZID0gJ3N2ZWx0ZWtpdDpwYWdldXJsJztcblxuZXhwb3J0IGNvbnN0IEhJU1RPUllfSU5ERVggPSAnc3ZlbHRla2l0Omhpc3RvcnknO1xuZXhwb3J0IGNvbnN0IE5BVklHQVRJT05fSU5ERVggPSAnc3ZlbHRla2l0Om5hdmlnYXRpb24nO1xuXG5leHBvcnQgY29uc3QgUFJFTE9BRF9QUklPUklUSUVTID0gLyoqIEB0eXBlIHtjb25zdH0gKi8gKHtcblx0dGFwOiAxLFxuXHRob3ZlcjogMixcblx0dmlld3BvcnQ6IDMsXG5cdGVhZ2VyOiA0LFxuXHRvZmY6IC0xLFxuXHRmYWxzZTogLTFcbn0pO1xuIiwiaW1wb3J0IHsgQlJPV1NFUiwgREVWIH0gZnJvbSAnZXNtLWVudic7XG5pbXBvcnQgeyBvbk1vdW50LCB0aWNrIH0gZnJvbSAnc3ZlbHRlJztcbmltcG9ydCB7XG5cdGFkZF9kYXRhX3N1ZmZpeCxcblx0ZGVjb2RlX3BhcmFtcyxcblx0ZGVjb2RlX3BhdGhuYW1lLFxuXHRzdHJpcF9oYXNoLFxuXHRtYWtlX3RyYWNrYWJsZSxcblx0bm9ybWFsaXplX3BhdGhcbn0gZnJvbSAnLi4vLi4vdXRpbHMvdXJsLmpzJztcbmltcG9ydCB7XG5cdGluaXRpYWxfZmV0Y2gsXG5cdGxvY2tfZmV0Y2gsXG5cdG5hdGl2ZV9mZXRjaCxcblx0c3Vic2VxdWVudF9mZXRjaCxcblx0dW5sb2NrX2ZldGNoXG59IGZyb20gJy4vZmV0Y2hlci5qcyc7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJy4vcGFyc2UuanMnO1xuaW1wb3J0ICogYXMgc3RvcmFnZSBmcm9tICcuL3Nlc3Npb24tc3RvcmFnZS5qcyc7XG5pbXBvcnQge1xuXHRmaW5kX2FuY2hvcixcblx0cmVzb2x2ZV91cmwsXG5cdGdldF9saW5rX2luZm8sXG5cdGdldF9yb3V0ZXJfb3B0aW9ucyxcblx0aXNfZXh0ZXJuYWxfdXJsLFxuXHRvcmlnaW4sXG5cdHNjcm9sbF9zdGF0ZSxcblx0bm90aWZpYWJsZV9zdG9yZSxcblx0Y3JlYXRlX3VwZGF0ZWRfc3RvcmVcbn0gZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgeyBiYXNlIH0gZnJvbSAnX19zdmVsdGVraXQvcGF0aHMnO1xuaW1wb3J0ICogYXMgZGV2YWx1ZSBmcm9tICdkZXZhbHVlJztcbmltcG9ydCB7XG5cdEhJU1RPUllfSU5ERVgsXG5cdE5BVklHQVRJT05fSU5ERVgsXG5cdFBSRUxPQURfUFJJT1JJVElFUyxcblx0U0NST0xMX0tFWSxcblx0U1RBVEVTX0tFWSxcblx0U05BUFNIT1RfS0VZLFxuXHRQQUdFX1VSTF9LRVlcbn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgdmFsaWRhdGVfcGFnZV9leHBvcnRzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXhwb3J0cy5qcyc7XG5pbXBvcnQgeyBjb21wYWN0IH0gZnJvbSAnLi4vLi4vdXRpbHMvYXJyYXkuanMnO1xuaW1wb3J0IHsgSHR0cEVycm9yLCBSZWRpcmVjdCwgU3ZlbHRlS2l0RXJyb3IgfSBmcm9tICcuLi9jb250cm9sLmpzJztcbmltcG9ydCB7IElOVkFMSURBVEVEX1BBUkFNLCBUUkFJTElOR19TTEFTSF9QQVJBTSwgdmFsaWRhdGVfZGVwZW5kcyB9IGZyb20gJy4uL3NoYXJlZC5qcyc7XG5pbXBvcnQgeyBnZXRfbWVzc2FnZSwgZ2V0X3N0YXR1cyB9IGZyb20gJy4uLy4uL3V0aWxzL2Vycm9yLmpzJztcbmltcG9ydCB7IHdyaXRhYmxlIH0gZnJvbSAnc3ZlbHRlL3N0b3JlJztcblxubGV0IGVycm9yZWQgPSBmYWxzZTtcblxuLy8gV2UgdHJhY2sgdGhlIHNjcm9sbCBwb3NpdGlvbiBhc3NvY2lhdGVkIHdpdGggZWFjaCBoaXN0b3J5IGVudHJ5IGluIHNlc3Npb25TdG9yYWdlLFxuLy8gcmF0aGVyIHRoYW4gb24gaGlzdG9yeS5zdGF0ZSBpdHNlbGYsIGJlY2F1c2Ugd2hlbiBuYXZpZ2F0aW9uIGlzIGRyaXZlbiBieVxuLy8gcG9wc3RhdGUgaXQncyB0b28gbGF0ZSB0byB1cGRhdGUgdGhlIHNjcm9sbCBwb3NpdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlXG4vLyBzdGF0ZSB3ZSdyZSBuYXZpZ2F0aW5nIGZyb21cbi8qKlxuICogaGlzdG9yeSBpbmRleCAtPiB7IHgsIHkgfVxuICogQHR5cGUge1JlY29yZDxudW1iZXIsIHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfT59XG4gKi9cbmNvbnN0IHNjcm9sbF9wb3NpdGlvbnMgPSBzdG9yYWdlLmdldChTQ1JPTExfS0VZKSA/PyB7fTtcblxuLyoqXG4gKiBuYXZpZ2F0aW9uIGluZGV4IC0+IGFueVxuICogQHR5cGUge1JlY29yZDxzdHJpbmcsIGFueVtdPn1cbiAqL1xuY29uc3Qgc25hcHNob3RzID0gc3RvcmFnZS5nZXQoU05BUFNIT1RfS0VZKSA/PyB7fTtcblxuaWYgKERFViAmJiBCUk9XU0VSKSB7XG5cdGxldCB3YXJuZWQgPSBmYWxzZTtcblxuXHRjb25zdCBjdXJyZW50X21vZHVsZV91cmwgPSBpbXBvcnQubWV0YS51cmwuc3BsaXQoJz8nKVswXTsgLy8gcmVtb3ZlIHF1ZXJ5IHBhcmFtcyB0aGF0IHZpdGUgYWRkcyB0byB0aGUgVVJMIHdoZW4gaXQgaXMgbG9hZGVkIGZyb20gbm9kZV9tb2R1bGVzXG5cblx0Y29uc3Qgd2FybiA9ICgpID0+IHtcblx0XHRpZiAod2FybmVkKSByZXR1cm47XG5cblx0XHQvLyBSYXRoZXIgdGhhbiBzYXZpbmcgYSBwb2ludGVyIHRvIHRoZSBvcmlnaW5hbCBoaXN0b3J5IG1ldGhvZHMsIHdoaWNoIHdvdWxkIHByZXZlbnQgbW9ua2V5cGF0Y2hpbmcgYnkgb3RoZXIgbGlicyxcblx0XHQvLyBpbnNwZWN0IHRoZSBzdGFjayB0cmFjZSB0byBzZWUgaWYgd2UncmUgYmVpbmcgY2FsbGVkIGZyb20gd2l0aGluIFN2ZWx0ZUtpdC5cblx0XHRsZXQgc3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjaz8uc3BsaXQoJ1xcbicpO1xuXHRcdGlmICghc3RhY2spIHJldHVybjtcblx0XHRpZiAoIXN0YWNrWzBdLmluY2x1ZGVzKCdodHRwczonKSAmJiAhc3RhY2tbMF0uaW5jbHVkZXMoJ2h0dHA6JykpIHN0YWNrID0gc3RhY2suc2xpY2UoMSk7IC8vIENocm9tZSBpbmNsdWRlcyB0aGUgZXJyb3IgbWVzc2FnZSBpbiB0aGUgc3RhY2tcblx0XHRzdGFjayA9IHN0YWNrLnNsaWNlKDIpOyAvLyByZW1vdmUgYHdhcm5gIGFuZCB0aGUgcGxhY2Ugd2hlcmUgYHdhcm5gIHdhcyBjYWxsZWRcblx0XHQvLyBDYW4gYmUgZmFsc3kgaWYgd2FzIGNhbGxlZCBkaXJlY3RseSBmcm9tIGFuIGFub255bW91cyBmdW5jdGlvblxuXHRcdGlmIChzdGFja1swXT8uaW5jbHVkZXMoY3VycmVudF9tb2R1bGVfdXJsKSkgcmV0dXJuO1xuXG5cdFx0d2FybmVkID0gdHJ1ZTtcblxuXHRcdGNvbnNvbGUud2Fybihcblx0XHRcdFwiQXZvaWQgdXNpbmcgYGhpc3RvcnkucHVzaFN0YXRlKC4uLilgIGFuZCBgaGlzdG9yeS5yZXBsYWNlU3RhdGUoLi4uKWAgYXMgdGhlc2Ugd2lsbCBjb25mbGljdCB3aXRoIFN2ZWx0ZUtpdCdzIHJvdXRlci4gVXNlIHRoZSBgcHVzaFN0YXRlYCBhbmQgYHJlcGxhY2VTdGF0ZWAgaW1wb3J0cyBmcm9tIGAkYXBwL25hdmlnYXRpb25gIGluc3RlYWQuXCJcblx0XHQpO1xuXHR9O1xuXG5cdGNvbnN0IHB1c2hfc3RhdGUgPSBoaXN0b3J5LnB1c2hTdGF0ZTtcblx0aGlzdG9yeS5wdXNoU3RhdGUgPSAoLi4uYXJncykgPT4ge1xuXHRcdHdhcm4oKTtcblx0XHRyZXR1cm4gcHVzaF9zdGF0ZS5hcHBseShoaXN0b3J5LCBhcmdzKTtcblx0fTtcblxuXHRjb25zdCByZXBsYWNlX3N0YXRlID0gaGlzdG9yeS5yZXBsYWNlU3RhdGU7XG5cdGhpc3RvcnkucmVwbGFjZVN0YXRlID0gKC4uLmFyZ3MpID0+IHtcblx0XHR3YXJuKCk7XG5cdFx0cmV0dXJuIHJlcGxhY2Vfc3RhdGUuYXBwbHkoaGlzdG9yeSwgYXJncyk7XG5cdH07XG59XG5cbmV4cG9ydCBjb25zdCBzdG9yZXMgPSB7XG5cdHVybDogLyogQF9fUFVSRV9fICovIG5vdGlmaWFibGVfc3RvcmUoe30pLFxuXHRwYWdlOiAvKiBAX19QVVJFX18gKi8gbm90aWZpYWJsZV9zdG9yZSh7fSksXG5cdG5hdmlnYXRpbmc6IC8qIEBfX1BVUkVfXyAqLyB3cml0YWJsZShcblx0XHQvKiogQHR5cGUge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLk5hdmlnYXRpb24gfCBudWxsfSAqLyAobnVsbClcblx0KSxcblx0dXBkYXRlZDogLyogQF9fUFVSRV9fICovIGNyZWF0ZV91cGRhdGVkX3N0b3JlKClcbn07XG5cbi8qKiBAcGFyYW0ge251bWJlcn0gaW5kZXggKi9cbmZ1bmN0aW9uIHVwZGF0ZV9zY3JvbGxfcG9zaXRpb25zKGluZGV4KSB7XG5cdHNjcm9sbF9wb3NpdGlvbnNbaW5kZXhdID0gc2Nyb2xsX3N0YXRlKCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGN1cnJlbnRfaGlzdG9yeV9pbmRleFxuICogQHBhcmFtIHtudW1iZXJ9IGN1cnJlbnRfbmF2aWdhdGlvbl9pbmRleFxuICovXG5mdW5jdGlvbiBjbGVhcl9vbndhcmRfaGlzdG9yeShjdXJyZW50X2hpc3RvcnlfaW5kZXgsIGN1cnJlbnRfbmF2aWdhdGlvbl9pbmRleCkge1xuXHQvLyBpZiB3ZSBuYXZpZ2F0ZWQgYmFjaywgdGhlbiBwdXNoZWQgYSBuZXcgc3RhdGUsIHdlIGNhblxuXHQvLyByZWxlYXNlIG1lbW9yeSBieSBwcnVuaW5nIHRoZSBzY3JvbGwvc25hcHNob3QgbG9va3VwXG5cdGxldCBpID0gY3VycmVudF9oaXN0b3J5X2luZGV4ICsgMTtcblx0d2hpbGUgKHNjcm9sbF9wb3NpdGlvbnNbaV0pIHtcblx0XHRkZWxldGUgc2Nyb2xsX3Bvc2l0aW9uc1tpXTtcblx0XHRpICs9IDE7XG5cdH1cblxuXHRpID0gY3VycmVudF9uYXZpZ2F0aW9uX2luZGV4ICsgMTtcblx0d2hpbGUgKHNuYXBzaG90c1tpXSkge1xuXHRcdGRlbGV0ZSBzbmFwc2hvdHNbaV07XG5cdFx0aSArPSAxO1xuXHR9XG59XG5cbi8qKlxuICogTG9hZHMgYGhyZWZgIHRoZSBvbGQtZmFzaGlvbmVkIHdheSwgd2l0aCBhIGZ1bGwgcGFnZSByZWxvYWQuXG4gKiBSZXR1cm5zIGEgYFByb21pc2VgIHRoYXQgbmV2ZXIgcmVzb2x2ZXMgKHRvIHByZXZlbnQgYW55XG4gKiBzdWJzZXF1ZW50IHdvcmssIGUuZy4gaGlzdG9yeSBtYW5pcHVsYXRpb24sIGZyb20gaGFwcGVuaW5nKVxuICogQHBhcmFtIHtVUkx9IHVybFxuICovXG5mdW5jdGlvbiBuYXRpdmVfbmF2aWdhdGlvbih1cmwpIHtcblx0bG9jYXRpb24uaHJlZiA9IHVybC5ocmVmO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoKCkgPT4ge30pO1xufVxuXG5mdW5jdGlvbiBub29wKCkge31cblxuLyoqIEB0eXBlIHtpbXBvcnQoJ3R5cGVzJykuQ1NSUm91dGVbXX0gKi9cbmxldCByb3V0ZXM7XG4vKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5DU1JQYWdlTm9kZUxvYWRlcn0gKi9cbmxldCBkZWZhdWx0X2xheW91dF9sb2FkZXI7XG4vKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5DU1JQYWdlTm9kZUxvYWRlcn0gKi9cbmxldCBkZWZhdWx0X2Vycm9yX2xvYWRlcjtcbi8qKiBAdHlwZSB7SFRNTEVsZW1lbnR9ICovXG5sZXQgY29udGFpbmVyO1xuLyoqIEB0eXBlIHtIVE1MRWxlbWVudH0gKi9cbmxldCB0YXJnZXQ7XG4vKiogQHR5cGUge2ltcG9ydCgnLi90eXBlcy5qcycpLlN2ZWx0ZUtpdEFwcH0gKi9cbmxldCBhcHA7XG5cbi8qKiBAdHlwZSB7QXJyYXk8KCh1cmw6IFVSTCkgPT4gYm9vbGVhbik+fSAqL1xuY29uc3QgaW52YWxpZGF0ZWQgPSBbXTtcblxuLyoqXG4gKiBBbiBhcnJheSBvZiB0aGUgYCtsYXlvdXQuc3ZlbHRlYCBhbmQgYCtwYWdlLnN2ZWx0ZWAgY29tcG9uZW50IGluc3RhbmNlc1xuICogdGhhdCBjdXJyZW50bHkgbGl2ZSBvbiB0aGUgcGFnZSDigJQgdXNlZCBmb3IgY2FwdHVyaW5nIGFuZCByZXN0b3Jpbmcgc25hcHNob3RzLlxuICogSXQncyB1cGRhdGVkL21hbmlwdWxhdGVkIHRocm91Z2ggYGJpbmQ6dGhpc2AgaW4gYFJvb3Quc3ZlbHRlYC5cbiAqIEB0eXBlIHtpbXBvcnQoJ3N2ZWx0ZScpLlN2ZWx0ZUNvbXBvbmVudFtdfVxuICovXG5jb25zdCBjb21wb25lbnRzID0gW107XG5cbi8qKiBAdHlwZSB7e2lkOiBzdHJpbmcsIHByb21pc2U6IFByb21pc2U8aW1wb3J0KCcuL3R5cGVzLmpzJykuTmF2aWdhdGlvblJlc3VsdD59IHwgbnVsbH0gKi9cbmxldCBsb2FkX2NhY2hlID0gbnVsbDtcblxuLyoqIEB0eXBlIHtBcnJheTwobmF2aWdhdGlvbjogaW1wb3J0KCdAc3ZlbHRlanMva2l0JykuQmVmb3JlTmF2aWdhdGUpID0+IHZvaWQ+fSAqL1xuY29uc3QgYmVmb3JlX25hdmlnYXRlX2NhbGxiYWNrcyA9IFtdO1xuXG4vKiogQHR5cGUge0FycmF5PChuYXZpZ2F0aW9uOiBpbXBvcnQoJ0BzdmVsdGVqcy9raXQnKS5Pbk5hdmlnYXRlKSA9PiBpbXBvcnQoJ3R5cGVzJykuTWF5YmVQcm9taXNlPCgoKSA9PiB2b2lkKSB8IHZvaWQ+Pn0gKi9cbmNvbnN0IG9uX25hdmlnYXRlX2NhbGxiYWNrcyA9IFtdO1xuXG4vKiogQHR5cGUge0FycmF5PChuYXZpZ2F0aW9uOiBpbXBvcnQoJ0BzdmVsdGVqcy9raXQnKS5BZnRlck5hdmlnYXRlKSA9PiB2b2lkPn0gKi9cbmxldCBhZnRlcl9uYXZpZ2F0ZV9jYWxsYmFja3MgPSBbXTtcblxuLyoqIEB0eXBlIHtpbXBvcnQoJy4vdHlwZXMuanMnKS5OYXZpZ2F0aW9uU3RhdGV9ICovXG5sZXQgY3VycmVudCA9IHtcblx0YnJhbmNoOiBbXSxcblx0ZXJyb3I6IG51bGwsXG5cdC8vIEB0cy1pZ25vcmUgLSB3ZSBuZWVkIHRoZSBpbml0aWFsIHZhbHVlIHRvIGJlIG51bGxcblx0dXJsOiBudWxsXG59O1xuXG4vKiogdGhpcyBiZWluZyB0cnVlIG1lYW5zIHdlIFNTUidkICovXG5sZXQgaHlkcmF0ZWQgPSBmYWxzZTtcbmxldCBzdGFydGVkID0gZmFsc2U7XG5sZXQgYXV0b3Njcm9sbCA9IHRydWU7XG5sZXQgdXBkYXRpbmcgPSBmYWxzZTtcbmxldCBuYXZpZ2F0aW5nID0gZmFsc2U7XG5sZXQgaGFzaF9uYXZpZ2F0aW5nID0gZmFsc2U7XG4vKiogVHJ1ZSBhcyBzb29uIGFzIHRoZXJlIGhhcHBlbmVkIG9uZSBjbGllbnQtc2lkZSBuYXZpZ2F0aW9uIChleGNsdWRpbmcgdGhlIFN2ZWx0ZUtpdC1pbml0aWFsaXplZCBpbml0aWFsIG9uZSB3aGVuIGluIFNQQSBtb2RlKSAqL1xubGV0IGhhc19uYXZpZ2F0ZWQgPSBmYWxzZTtcblxubGV0IGZvcmNlX2ludmFsaWRhdGlvbiA9IGZhbHNlO1xuXG4vKiogQHR5cGUge2ltcG9ydCgnc3ZlbHRlJykuU3ZlbHRlQ29tcG9uZW50fSAqL1xubGV0IHJvb3Q7XG5cbi8qKiBAdHlwZSB7bnVtYmVyfSBrZWVwaW5nIHRyYWNrIG9mIHRoZSBoaXN0b3J5IGluZGV4IGluIG9yZGVyIHRvIHByZXZlbnQgcG9wc3RhdGUgbmF2aWdhdGlvbiBldmVudHMgaWYgbmVlZGVkICovXG5sZXQgY3VycmVudF9oaXN0b3J5X2luZGV4O1xuXG4vKiogQHR5cGUge251bWJlcn0gKi9cbmxldCBjdXJyZW50X25hdmlnYXRpb25faW5kZXg7XG5cbi8qKiBAdHlwZSB7aW1wb3J0KCdAc3ZlbHRlanMva2l0JykuUGFnZX0gKi9cbmxldCBwYWdlO1xuXG4vKiogQHR5cGUge3t9fSAqL1xubGV0IHRva2VuO1xuXG4vKiogQHR5cGUge1Byb21pc2U8dm9pZD4gfCBudWxsfSAqL1xubGV0IHBlbmRpbmdfaW52YWxpZGF0ZTtcblxuLyoqXG4gKiBAcGFyYW0ge2ltcG9ydCgnLi90eXBlcy5qcycpLlN2ZWx0ZUtpdEFwcH0gX2FwcFxuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gX3RhcmdldFxuICogQHBhcmFtIHtQYXJhbWV0ZXJzPHR5cGVvZiBfaHlkcmF0ZT5bMV19IFtoeWRyYXRlXVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RhcnQoX2FwcCwgX3RhcmdldCwgaHlkcmF0ZSkge1xuXHRpZiAoREVWICYmIF90YXJnZXQgPT09IGRvY3VtZW50LmJvZHkpIHtcblx0XHRjb25zb2xlLndhcm4oXG5cdFx0XHQnUGxhY2luZyAlc3ZlbHRla2l0LmJvZHklIGRpcmVjdGx5IGluc2lkZSA8Ym9keT4gaXMgbm90IHJlY29tbWVuZGVkLCBhcyB5b3VyIGFwcCBtYXkgYnJlYWsgZm9yIHVzZXJzIHdobyBoYXZlIGNlcnRhaW4gYnJvd3NlciBleHRlbnNpb25zIGluc3RhbGxlZC5cXG5cXG5Db25zaWRlciB3cmFwcGluZyBpdCBpbiBhbiBlbGVtZW50OlxcblxcbjxkaXYgc3R5bGU9XCJkaXNwbGF5OiBjb250ZW50c1wiPlxcbiAgJXN2ZWx0ZWtpdC5ib2R5JVxcbjwvZGl2Pidcblx0XHQpO1xuXHR9XG5cblx0Ly8gZGV0ZWN0IGJhc2ljIGF1dGggY3JlZGVudGlhbHMgaW4gdGhlIGN1cnJlbnQgVVJMXG5cdC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9raXQvcHVsbC8xMTE3OVxuXHQvLyBpZiBzbywgcmVmcmVzaCB0aGUgcGFnZSB3aXRob3V0IGNyZWRlbnRpYWxzXG5cdGlmIChkb2N1bWVudC5VUkwgIT09IGxvY2F0aW9uLmhyZWYpIHtcblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1hc3NpZ25cblx0XHRsb2NhdGlvbi5ocmVmID0gbG9jYXRpb24uaHJlZjtcblx0fVxuXG5cdGFwcCA9IF9hcHA7XG5cdHJvdXRlcyA9IHBhcnNlKF9hcHApO1xuXHRjb250YWluZXIgPSBfX1NWRUxURUtJVF9FTUJFRERFRF9fID8gX3RhcmdldCA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblx0dGFyZ2V0ID0gX3RhcmdldDtcblxuXHQvLyB3ZSBpbXBvcnQgdGhlIHJvb3QgbGF5b3V0L2Vycm9yIG5vZGVzIGVhZ2VybHksIHNvIHRoYXRcblx0Ly8gY29ubmVjdGl2aXR5IGVycm9ycyBhZnRlciBpbml0aWFsaXNhdGlvbiBkb24ndCBudWtlIHRoZSBhcHBcblx0ZGVmYXVsdF9sYXlvdXRfbG9hZGVyID0gX2FwcC5ub2Rlc1swXTtcblx0ZGVmYXVsdF9lcnJvcl9sb2FkZXIgPSBfYXBwLm5vZGVzWzFdO1xuXHRkZWZhdWx0X2xheW91dF9sb2FkZXIoKTtcblx0ZGVmYXVsdF9lcnJvcl9sb2FkZXIoKTtcblxuXHRjdXJyZW50X2hpc3RvcnlfaW5kZXggPSBoaXN0b3J5LnN0YXRlPy5bSElTVE9SWV9JTkRFWF07XG5cdGN1cnJlbnRfbmF2aWdhdGlvbl9pbmRleCA9IGhpc3Rvcnkuc3RhdGU/LltOQVZJR0FUSU9OX0lOREVYXTtcblxuXHRpZiAoIWN1cnJlbnRfaGlzdG9yeV9pbmRleCkge1xuXHRcdC8vIHdlIHVzZSBEYXRlLm5vdygpIGFzIGFuIG9mZnNldCBzbyB0aGF0IGNyb3NzLWRvY3VtZW50IG5hdmlnYXRpb25zXG5cdFx0Ly8gd2l0aGluIHRoZSBhcHAgZG9uJ3QgcmVzdWx0IGluIGRhdGEgbG9zc1xuXHRcdGN1cnJlbnRfaGlzdG9yeV9pbmRleCA9IGN1cnJlbnRfbmF2aWdhdGlvbl9pbmRleCA9IERhdGUubm93KCk7XG5cblx0XHQvLyBjcmVhdGUgaW5pdGlhbCBoaXN0b3J5IGVudHJ5LCBzbyB3ZSBjYW4gcmV0dXJuIGhlcmVcblx0XHRoaXN0b3J5LnJlcGxhY2VTdGF0ZShcblx0XHRcdHtcblx0XHRcdFx0Li4uaGlzdG9yeS5zdGF0ZSxcblx0XHRcdFx0W0hJU1RPUllfSU5ERVhdOiBjdXJyZW50X2hpc3RvcnlfaW5kZXgsXG5cdFx0XHRcdFtOQVZJR0FUSU9OX0lOREVYXTogY3VycmVudF9uYXZpZ2F0aW9uX2luZGV4XG5cdFx0XHR9LFxuXHRcdFx0Jydcblx0XHQpO1xuXHR9XG5cblx0Ly8gaWYgd2UgcmVsb2FkIHRoZSBwYWdlLCBvciBDbWQtU2hpZnQtVCBiYWNrIHRvIGl0LFxuXHQvLyByZWNvdmVyIHNjcm9sbCBwb3NpdGlvblxuXHRjb25zdCBzY3JvbGwgPSBzY3JvbGxfcG9zaXRpb25zW2N1cnJlbnRfaGlzdG9yeV9pbmRleF07XG5cdGlmIChzY3JvbGwpIHtcblx0XHRoaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gJ21hbnVhbCc7XG5cdFx0c2Nyb2xsVG8oc2Nyb2xsLngsIHNjcm9sbC55KTtcblx0fVxuXG5cdGlmIChoeWRyYXRlKSB7XG5cdFx0YXdhaXQgX2h5ZHJhdGUodGFyZ2V0LCBoeWRyYXRlKTtcblx0fSBlbHNlIHtcblx0XHRnb3RvKGxvY2F0aW9uLmhyZWYsIHsgcmVwbGFjZVN0YXRlOiB0cnVlIH0pO1xuXHR9XG5cblx0X3N0YXJ0X3JvdXRlcigpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfaW52YWxpZGF0ZSgpIHtcblx0Ly8gQWNjZXB0IGFsbCBpbnZhbGlkYXRpb25zIGFzIHRoZXkgY29tZSwgZG9uJ3Qgc3dhbGxvdyBhbnkgd2hpbGUgYW5vdGhlciBpbnZhbGlkYXRpb25cblx0Ly8gaXMgcnVubmluZyBiZWNhdXNlIHN1YnNlcXVlbnQgaW52YWxpZGF0aW9ucyBtYXkgbWFrZSBlYXJsaWVyIG9uZXMgb3V0ZGF0ZWQsXG5cdC8vIGJ1dCBiYXRjaCBtdWx0aXBsZSBzeW5jaHJvbm91cyBpbnZhbGlkYXRpb25zLlxuXHRhd2FpdCAocGVuZGluZ19pbnZhbGlkYXRlIHx8PSBQcm9taXNlLnJlc29sdmUoKSk7XG5cdGlmICghcGVuZGluZ19pbnZhbGlkYXRlKSByZXR1cm47XG5cdHBlbmRpbmdfaW52YWxpZGF0ZSA9IG51bGw7XG5cblx0Y29uc3QgaW50ZW50ID0gZ2V0X25hdmlnYXRpb25faW50ZW50KGN1cnJlbnQudXJsLCB0cnVlKTtcblxuXHQvLyBDbGVhciBwcmVsb2FkLCBpdCBtaWdodCBiZSBhZmZlY3RlZCBieSB0aGUgaW52YWxpZGF0aW9uLlxuXHQvLyBBbHNvIHNvbHZlcyBhbiBlZGdlIGNhc2Ugd2hlcmUgYSBwcmVsb2FkIGlzIHRyaWdnZXJlZCwgdGhlIG5hdmlnYXRpb24gZm9yIGl0XG5cdC8vIHdhcyB0aGVuIHRyaWdnZXJlZCBhbmQgaXMgc3RpbGwgcnVubmluZyB3aGlsZSB0aGUgaW52YWxpZGF0aW9uIGtpY2tzIGluLFxuXHQvLyBhdCB3aGljaCBwb2ludCB0aGUgaW52YWxpZGF0aW9uIHNob3VsZCB0YWtlIG92ZXIgYW5kIFwid2luXCIuXG5cdGxvYWRfY2FjaGUgPSBudWxsO1xuXG5cdGNvbnN0IG5hdl90b2tlbiA9ICh0b2tlbiA9IHt9KTtcblx0Y29uc3QgbmF2aWdhdGlvbl9yZXN1bHQgPSBpbnRlbnQgJiYgKGF3YWl0IGxvYWRfcm91dGUoaW50ZW50KSk7XG5cdGlmICghbmF2aWdhdGlvbl9yZXN1bHQgfHwgbmF2X3Rva2VuICE9PSB0b2tlbikgcmV0dXJuO1xuXG5cdGlmIChuYXZpZ2F0aW9uX3Jlc3VsdC50eXBlID09PSAncmVkaXJlY3QnKSB7XG5cdFx0cmV0dXJuIF9nb3RvKG5ldyBVUkwobmF2aWdhdGlvbl9yZXN1bHQubG9jYXRpb24sIGN1cnJlbnQudXJsKS5ocmVmLCB7fSwgMSwgbmF2X3Rva2VuKTtcblx0fVxuXG5cdGlmIChuYXZpZ2F0aW9uX3Jlc3VsdC5wcm9wcy5wYWdlKSB7XG5cdFx0cGFnZSA9IG5hdmlnYXRpb25fcmVzdWx0LnByb3BzLnBhZ2U7XG5cdH1cblx0Y3VycmVudCA9IG5hdmlnYXRpb25fcmVzdWx0LnN0YXRlO1xuXHRyZXNldF9pbnZhbGlkYXRpb24oKTtcblx0cm9vdC4kc2V0KG5hdmlnYXRpb25fcmVzdWx0LnByb3BzKTtcbn1cblxuZnVuY3Rpb24gcmVzZXRfaW52YWxpZGF0aW9uKCkge1xuXHRpbnZhbGlkYXRlZC5sZW5ndGggPSAwO1xuXHRmb3JjZV9pbnZhbGlkYXRpb24gPSBmYWxzZTtcbn1cblxuLyoqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAqL1xuZnVuY3Rpb24gY2FwdHVyZV9zbmFwc2hvdChpbmRleCkge1xuXHRpZiAoY29tcG9uZW50cy5zb21lKChjKSA9PiBjPy5zbmFwc2hvdCkpIHtcblx0XHRzbmFwc2hvdHNbaW5kZXhdID0gY29tcG9uZW50cy5tYXAoKGMpID0+IGM/LnNuYXBzaG90Py5jYXB0dXJlKCkpO1xuXHR9XG59XG5cbi8qKiBAcGFyYW0ge251bWJlcn0gaW5kZXggKi9cbmZ1bmN0aW9uIHJlc3RvcmVfc25hcHNob3QoaW5kZXgpIHtcblx0c25hcHNob3RzW2luZGV4XT8uZm9yRWFjaCgodmFsdWUsIGkpID0+IHtcblx0XHRjb21wb25lbnRzW2ldPy5zbmFwc2hvdD8ucmVzdG9yZSh2YWx1ZSk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBwZXJzaXN0X3N0YXRlKCkge1xuXHR1cGRhdGVfc2Nyb2xsX3Bvc2l0aW9ucyhjdXJyZW50X2hpc3RvcnlfaW5kZXgpO1xuXHRzdG9yYWdlLnNldChTQ1JPTExfS0VZLCBzY3JvbGxfcG9zaXRpb25zKTtcblxuXHRjYXB0dXJlX3NuYXBzaG90KGN1cnJlbnRfbmF2aWdhdGlvbl9pbmRleCk7XG5cdHN0b3JhZ2Uuc2V0KFNOQVBTSE9UX0tFWSwgc25hcHNob3RzKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZyB8IFVSTH0gdXJsXG4gKiBAcGFyYW0ge3sgcmVwbGFjZVN0YXRlPzogYm9vbGVhbjsgbm9TY3JvbGw/OiBib29sZWFuOyBrZWVwRm9jdXM/OiBib29sZWFuOyBpbnZhbGlkYXRlQWxsPzogYm9vbGVhbjsgc3RhdGU/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IH19IG9wdGlvbnNcbiAqIEBwYXJhbSB7bnVtYmVyfSByZWRpcmVjdF9jb3VudFxuICogQHBhcmFtIHt7fX0gW25hdl90b2tlbl1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gX2dvdG8odXJsLCBvcHRpb25zLCByZWRpcmVjdF9jb3VudCwgbmF2X3Rva2VuKSB7XG5cdHJldHVybiBuYXZpZ2F0ZSh7XG5cdFx0dHlwZTogJ2dvdG8nLFxuXHRcdHVybDogcmVzb2x2ZV91cmwodXJsKSxcblx0XHRrZWVwZm9jdXM6IG9wdGlvbnMua2VlcEZvY3VzLFxuXHRcdG5vc2Nyb2xsOiBvcHRpb25zLm5vU2Nyb2xsLFxuXHRcdHJlcGxhY2Vfc3RhdGU6IG9wdGlvbnMucmVwbGFjZVN0YXRlLFxuXHRcdHN0YXRlOiBvcHRpb25zLnN0YXRlLFxuXHRcdHJlZGlyZWN0X2NvdW50LFxuXHRcdG5hdl90b2tlbixcblx0XHRhY2NlcHQ6ICgpID0+IHtcblx0XHRcdGlmIChvcHRpb25zLmludmFsaWRhdGVBbGwpIHtcblx0XHRcdFx0Zm9yY2VfaW52YWxpZGF0aW9uID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufVxuXG4vKiogQHBhcmFtIHtpbXBvcnQoJy4vdHlwZXMuanMnKS5OYXZpZ2F0aW9uSW50ZW50fSBpbnRlbnQgKi9cbmFzeW5jIGZ1bmN0aW9uIF9wcmVsb2FkX2RhdGEoaW50ZW50KSB7XG5cdGxvYWRfY2FjaGUgPSB7XG5cdFx0aWQ6IGludGVudC5pZCxcblx0XHRwcm9taXNlOiBsb2FkX3JvdXRlKGludGVudCkudGhlbigocmVzdWx0KSA9PiB7XG5cdFx0XHRpZiAocmVzdWx0LnR5cGUgPT09ICdsb2FkZWQnICYmIHJlc3VsdC5zdGF0ZS5lcnJvcikge1xuXHRcdFx0XHQvLyBEb24ndCBjYWNoZSBlcnJvcnMsIGJlY2F1c2UgdGhleSBtaWdodCBiZSB0cmFuc2llbnRcblx0XHRcdFx0bG9hZF9jYWNoZSA9IG51bGw7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdH0pXG5cdH07XG5cblx0cmV0dXJuIGxvYWRfY2FjaGUucHJvbWlzZTtcbn1cblxuLyoqIEBwYXJhbSB7c3RyaW5nfSBwYXRobmFtZSAqL1xuYXN5bmMgZnVuY3Rpb24gX3ByZWxvYWRfY29kZShwYXRobmFtZSkge1xuXHRjb25zdCByb3V0ZSA9IHJvdXRlcy5maW5kKChyb3V0ZSkgPT4gcm91dGUuZXhlYyhnZXRfdXJsX3BhdGgocGF0aG5hbWUpKSk7XG5cblx0aWYgKHJvdXRlKSB7XG5cdFx0YXdhaXQgUHJvbWlzZS5hbGwoWy4uLnJvdXRlLmxheW91dHMsIHJvdXRlLmxlYWZdLm1hcCgobG9hZCkgPT4gbG9hZD8uWzFdKCkpKTtcblx0fVxufVxuXG4vKipcbiAqIEBwYXJhbSB7aW1wb3J0KCcuL3R5cGVzLmpzJykuTmF2aWdhdGlvbkZpbmlzaGVkfSByZXN1bHRcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHRhcmdldFxuICovXG5mdW5jdGlvbiBpbml0aWFsaXplKHJlc3VsdCwgdGFyZ2V0KSB7XG5cdGlmIChERVYgJiYgcmVzdWx0LnN0YXRlLmVycm9yICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3ZpdGUtZXJyb3Itb3ZlcmxheScpKSByZXR1cm47XG5cblx0Y3VycmVudCA9IHJlc3VsdC5zdGF0ZTtcblxuXHRjb25zdCBzdHlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N0eWxlW2RhdGEtc3ZlbHRla2l0XScpO1xuXHRpZiAoc3R5bGUpIHN0eWxlLnJlbW92ZSgpO1xuXG5cdHBhZ2UgPSAvKiogQHR5cGUge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLlBhZ2V9ICovIChyZXN1bHQucHJvcHMucGFnZSk7XG5cblx0cm9vdCA9IG5ldyBhcHAucm9vdCh7XG5cdFx0dGFyZ2V0LFxuXHRcdHByb3BzOiB7IC4uLnJlc3VsdC5wcm9wcywgc3RvcmVzLCBjb21wb25lbnRzIH0sXG5cdFx0aHlkcmF0ZTogdHJ1ZVxuXHR9KTtcblxuXHRyZXN0b3JlX3NuYXBzaG90KGN1cnJlbnRfbmF2aWdhdGlvbl9pbmRleCk7XG5cblx0LyoqIEB0eXBlIHtpbXBvcnQoJ0BzdmVsdGVqcy9raXQnKS5BZnRlck5hdmlnYXRlfSAqL1xuXHRjb25zdCBuYXZpZ2F0aW9uID0ge1xuXHRcdGZyb206IG51bGwsXG5cdFx0dG86IHtcblx0XHRcdHBhcmFtczogY3VycmVudC5wYXJhbXMsXG5cdFx0XHRyb3V0ZTogeyBpZDogY3VycmVudC5yb3V0ZT8uaWQgPz8gbnVsbCB9LFxuXHRcdFx0dXJsOiBuZXcgVVJMKGxvY2F0aW9uLmhyZWYpXG5cdFx0fSxcblx0XHR3aWxsVW5sb2FkOiBmYWxzZSxcblx0XHR0eXBlOiAnZW50ZXInLFxuXHRcdGNvbXBsZXRlOiBQcm9taXNlLnJlc29sdmUoKVxuXHR9O1xuXG5cdGFmdGVyX25hdmlnYXRlX2NhbGxiYWNrcy5mb3JFYWNoKChmbikgPT4gZm4obmF2aWdhdGlvbikpO1xuXG5cdHN0YXJ0ZWQgPSB0cnVlO1xufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0ge3tcbiAqICAgdXJsOiBVUkw7XG4gKiAgIHBhcmFtczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAqICAgYnJhbmNoOiBBcnJheTxpbXBvcnQoJy4vdHlwZXMuanMnKS5CcmFuY2hOb2RlIHwgdW5kZWZpbmVkPjtcbiAqICAgc3RhdHVzOiBudW1iZXI7XG4gKiAgIGVycm9yOiBBcHAuRXJyb3IgfCBudWxsO1xuICogICByb3V0ZTogaW1wb3J0KCd0eXBlcycpLkNTUlJvdXRlIHwgbnVsbDtcbiAqICAgZm9ybT86IFJlY29yZDxzdHJpbmcsIGFueT4gfCBudWxsO1xuICogfX0gb3B0c1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRfbmF2aWdhdGlvbl9yZXN1bHRfZnJvbV9icmFuY2goe1xuXHR1cmwsXG5cdHBhcmFtcyxcblx0YnJhbmNoLFxuXHRzdGF0dXMsXG5cdGVycm9yLFxuXHRyb3V0ZSxcblx0Zm9ybVxufSkge1xuXHQvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5UcmFpbGluZ1NsYXNofSAqL1xuXHRsZXQgc2xhc2ggPSAnbmV2ZXInO1xuXG5cdC8vIGlmIGBwYXRocy5iYXNlID09PSAnL2EvYi9jYCwgdGhlbiB0aGUgcm9vdCByb3V0ZSBpcyBhbHdheXMgYC9hL2IvYy9gLCByZWdhcmRsZXNzIG9mXG5cdC8vIHRoZSBgdHJhaWxpbmdTbGFzaGAgcm91dGUgb3B0aW9uLCBzbyB0aGF0IHJlbGF0aXZlIHBhdGhzIHRvIEpTIGFuZCBDU1Mgd29ya1xuXHRpZiAoYmFzZSAmJiAodXJsLnBhdGhuYW1lID09PSBiYXNlIHx8IHVybC5wYXRobmFtZSA9PT0gYmFzZSArICcvJykpIHtcblx0XHRzbGFzaCA9ICdhbHdheXMnO1xuXHR9IGVsc2Uge1xuXHRcdGZvciAoY29uc3Qgbm9kZSBvZiBicmFuY2gpIHtcblx0XHRcdGlmIChub2RlPy5zbGFzaCAhPT0gdW5kZWZpbmVkKSBzbGFzaCA9IG5vZGUuc2xhc2g7XG5cdFx0fVxuXHR9XG5cblx0dXJsLnBhdGhuYW1lID0gbm9ybWFsaXplX3BhdGgodXJsLnBhdGhuYW1lLCBzbGFzaCk7XG5cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5cdHVybC5zZWFyY2ggPSB1cmwuc2VhcmNoOyAvLyB0dXJuIGAvP2AgaW50byBgL2BcblxuXHQvKiogQHR5cGUge2ltcG9ydCgnLi90eXBlcy5qcycpLk5hdmlnYXRpb25GaW5pc2hlZH0gKi9cblx0Y29uc3QgcmVzdWx0ID0ge1xuXHRcdHR5cGU6ICdsb2FkZWQnLFxuXHRcdHN0YXRlOiB7XG5cdFx0XHR1cmwsXG5cdFx0XHRwYXJhbXMsXG5cdFx0XHRicmFuY2gsXG5cdFx0XHRlcnJvcixcblx0XHRcdHJvdXRlXG5cdFx0fSxcblx0XHRwcm9wczoge1xuXHRcdFx0Ly8gQHRzLWlnbm9yZSBTb21laG93IGl0J3MgZ2V0dGluZyBTdmVsdGVDb21wb25lbnQgYW5kIFN2ZWx0ZUNvbXBvbmVudERldiBtaXhlZCB1cFxuXHRcdFx0Y29uc3RydWN0b3JzOiBjb21wYWN0KGJyYW5jaCkubWFwKChicmFuY2hfbm9kZSkgPT4gYnJhbmNoX25vZGUubm9kZS5jb21wb25lbnQpLFxuXHRcdFx0cGFnZVxuXHRcdH1cblx0fTtcblxuXHRpZiAoZm9ybSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmVzdWx0LnByb3BzLmZvcm0gPSBmb3JtO1xuXHR9XG5cblx0bGV0IGRhdGEgPSB7fTtcblx0bGV0IGRhdGFfY2hhbmdlZCA9ICFwYWdlO1xuXG5cdGxldCBwID0gMDtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IE1hdGgubWF4KGJyYW5jaC5sZW5ndGgsIGN1cnJlbnQuYnJhbmNoLmxlbmd0aCk7IGkgKz0gMSkge1xuXHRcdGNvbnN0IG5vZGUgPSBicmFuY2hbaV07XG5cdFx0Y29uc3QgcHJldiA9IGN1cnJlbnQuYnJhbmNoW2ldO1xuXG5cdFx0aWYgKG5vZGU/LmRhdGEgIT09IHByZXY/LmRhdGEpIGRhdGFfY2hhbmdlZCA9IHRydWU7XG5cdFx0aWYgKCFub2RlKSBjb250aW51ZTtcblxuXHRcdGRhdGEgPSB7IC4uLmRhdGEsIC4uLm5vZGUuZGF0YSB9O1xuXG5cdFx0Ly8gT25seSBzZXQgcHJvcHMgaWYgdGhlIG5vZGUgYWN0dWFsbHkgdXBkYXRlZC4gVGhpcyBwcmV2ZW50cyBuZWVkbGVzcyByZXJlbmRlcnMuXG5cdFx0aWYgKGRhdGFfY2hhbmdlZCkge1xuXHRcdFx0cmVzdWx0LnByb3BzW2BkYXRhXyR7cH1gXSA9IGRhdGE7XG5cdFx0fVxuXG5cdFx0cCArPSAxO1xuXHR9XG5cblx0Y29uc3QgcGFnZV9jaGFuZ2VkID1cblx0XHQhY3VycmVudC51cmwgfHxcblx0XHR1cmwuaHJlZiAhPT0gY3VycmVudC51cmwuaHJlZiB8fFxuXHRcdGN1cnJlbnQuZXJyb3IgIT09IGVycm9yIHx8XG5cdFx0KGZvcm0gIT09IHVuZGVmaW5lZCAmJiBmb3JtICE9PSBwYWdlLmZvcm0pIHx8XG5cdFx0ZGF0YV9jaGFuZ2VkO1xuXG5cdGlmIChwYWdlX2NoYW5nZWQpIHtcblx0XHRyZXN1bHQucHJvcHMucGFnZSA9IHtcblx0XHRcdGVycm9yLFxuXHRcdFx0cGFyYW1zLFxuXHRcdFx0cm91dGU6IHtcblx0XHRcdFx0aWQ6IHJvdXRlPy5pZCA/PyBudWxsXG5cdFx0XHR9LFxuXHRcdFx0c3RhdGU6IHt9LFxuXHRcdFx0c3RhdHVzLFxuXHRcdFx0dXJsOiBuZXcgVVJMKHVybCksXG5cdFx0XHRmb3JtOiBmb3JtID8/IG51bGwsXG5cdFx0XHQvLyBUaGUgd2hvbGUgcGFnZSBzdG9yZSBpcyB1cGRhdGVkLCBidXQgdGhpcyB3YXkgdGhlIG9iamVjdCByZWZlcmVuY2Ugc3RheXMgdGhlIHNhbWVcblx0XHRcdGRhdGE6IGRhdGFfY2hhbmdlZCA/IGRhdGEgOiBwYWdlLmRhdGFcblx0XHR9O1xuXHR9XG5cblx0cmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDYWxsIHRoZSBsb2FkIGZ1bmN0aW9uIG9mIHRoZSBnaXZlbiBub2RlLCBpZiBpdCBleGlzdHMuXG4gKiBJZiBgc2VydmVyX2RhdGFgIGlzIHBhc3NlZCwgdGhpcyBpcyB0cmVhdGVkIGFzIHRoZSBpbml0aWFsIHJ1biBhbmQgdGhlIHBhZ2UgZW5kcG9pbnQgaXMgbm90IHJlcXVlc3RlZC5cbiAqXG4gKiBAcGFyYW0ge3tcbiAqICAgbG9hZGVyOiBpbXBvcnQoJ3R5cGVzJykuQ1NSUGFnZU5vZGVMb2FkZXI7XG4gKiBcdCBwYXJlbnQ6ICgpID0+IFByb21pc2U8UmVjb3JkPHN0cmluZywgYW55Pj47XG4gKiAgIHVybDogVVJMO1xuICogICBwYXJhbXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gKiAgIHJvdXRlOiB7IGlkOiBzdHJpbmcgfCBudWxsIH07XG4gKiBcdCBzZXJ2ZXJfZGF0YV9ub2RlOiBpbXBvcnQoJy4vdHlwZXMuanMnKS5EYXRhTm9kZSB8IG51bGw7XG4gKiB9fSBvcHRpb25zXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxpbXBvcnQoJy4vdHlwZXMuanMnKS5CcmFuY2hOb2RlPn1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbG9hZF9ub2RlKHsgbG9hZGVyLCBwYXJlbnQsIHVybCwgcGFyYW1zLCByb3V0ZSwgc2VydmVyX2RhdGFfbm9kZSB9KSB7XG5cdC8qKiBAdHlwZSB7UmVjb3JkPHN0cmluZywgYW55PiB8IG51bGx9ICovXG5cdGxldCBkYXRhID0gbnVsbDtcblxuXHRsZXQgaXNfdHJhY2tpbmcgPSB0cnVlO1xuXG5cdC8qKiBAdHlwZSB7aW1wb3J0KCd0eXBlcycpLlVzZXN9ICovXG5cdGNvbnN0IHVzZXMgPSB7XG5cdFx0ZGVwZW5kZW5jaWVzOiBuZXcgU2V0KCksXG5cdFx0cGFyYW1zOiBuZXcgU2V0KCksXG5cdFx0cGFyZW50OiBmYWxzZSxcblx0XHRyb3V0ZTogZmFsc2UsXG5cdFx0dXJsOiBmYWxzZSxcblx0XHRzZWFyY2hfcGFyYW1zOiBuZXcgU2V0KClcblx0fTtcblxuXHRjb25zdCBub2RlID0gYXdhaXQgbG9hZGVyKCk7XG5cblx0aWYgKERFVikge1xuXHRcdHZhbGlkYXRlX3BhZ2VfZXhwb3J0cyhub2RlLnVuaXZlcnNhbCk7XG5cdH1cblxuXHRpZiAobm9kZS51bml2ZXJzYWw/LmxvYWQpIHtcblx0XHQvKiogQHBhcmFtIHtzdHJpbmdbXX0gZGVwcyAqL1xuXHRcdGZ1bmN0aW9uIGRlcGVuZHMoLi4uZGVwcykge1xuXHRcdFx0Zm9yIChjb25zdCBkZXAgb2YgZGVwcykge1xuXHRcdFx0XHRpZiAoREVWKSB2YWxpZGF0ZV9kZXBlbmRzKC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAocm91dGUuaWQpLCBkZXApO1xuXG5cdFx0XHRcdGNvbnN0IHsgaHJlZiB9ID0gbmV3IFVSTChkZXAsIHVybCk7XG5cdFx0XHRcdHVzZXMuZGVwZW5kZW5jaWVzLmFkZChocmVmKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKiogQHR5cGUge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLkxvYWRFdmVudH0gKi9cblx0XHRjb25zdCBsb2FkX2lucHV0ID0ge1xuXHRcdFx0cm91dGU6IG5ldyBQcm94eShyb3V0ZSwge1xuXHRcdFx0XHRnZXQ6ICh0YXJnZXQsIGtleSkgPT4ge1xuXHRcdFx0XHRcdGlmIChpc190cmFja2luZykge1xuXHRcdFx0XHRcdFx0dXNlcy5yb3V0ZSA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiB0YXJnZXRbLyoqIEB0eXBlIHsnaWQnfSAqLyAoa2V5KV07XG5cdFx0XHRcdH1cblx0XHRcdH0pLFxuXHRcdFx0cGFyYW1zOiBuZXcgUHJveHkocGFyYW1zLCB7XG5cdFx0XHRcdGdldDogKHRhcmdldCwga2V5KSA9PiB7XG5cdFx0XHRcdFx0aWYgKGlzX3RyYWNraW5nKSB7XG5cdFx0XHRcdFx0XHR1c2VzLnBhcmFtcy5hZGQoLyoqIEB0eXBlIHtzdHJpbmd9ICovIChrZXkpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldFsvKiogQHR5cGUge3N0cmluZ30gKi8gKGtleSldO1xuXHRcdFx0XHR9XG5cdFx0XHR9KSxcblx0XHRcdGRhdGE6IHNlcnZlcl9kYXRhX25vZGU/LmRhdGEgPz8gbnVsbCxcblx0XHRcdHVybDogbWFrZV90cmFja2FibGUoXG5cdFx0XHRcdHVybCxcblx0XHRcdFx0KCkgPT4ge1xuXHRcdFx0XHRcdGlmIChpc190cmFja2luZykge1xuXHRcdFx0XHRcdFx0dXNlcy51cmwgPSB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdFx0KHBhcmFtKSA9PiB7XG5cdFx0XHRcdFx0aWYgKGlzX3RyYWNraW5nKSB7XG5cdFx0XHRcdFx0XHR1c2VzLnNlYXJjaF9wYXJhbXMuYWRkKHBhcmFtKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdCksXG5cdFx0XHRhc3luYyBmZXRjaChyZXNvdXJjZSwgaW5pdCkge1xuXHRcdFx0XHQvKiogQHR5cGUge1VSTCB8IHN0cmluZ30gKi9cblx0XHRcdFx0bGV0IHJlcXVlc3RlZDtcblxuXHRcdFx0XHRpZiAocmVzb3VyY2UgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7XG5cdFx0XHRcdFx0cmVxdWVzdGVkID0gcmVzb3VyY2UudXJsO1xuXG5cdFx0XHRcdFx0Ly8gd2UncmUgbm90IGFsbG93ZWQgdG8gbW9kaWZ5IHRoZSByZWNlaXZlZCBgUmVxdWVzdGAgb2JqZWN0LCBzbyBpbiBvcmRlclxuXHRcdFx0XHRcdC8vIHRvIGZpeHVwIHJlbGF0aXZlIHVybHMgd2UgY3JlYXRlIGEgbmV3IGVxdWl2YWxlbnQgYGluaXRgIG9iamVjdCBpbnN0ZWFkXG5cdFx0XHRcdFx0aW5pdCA9IHtcblx0XHRcdFx0XHRcdC8vIHRoZSByZXF1ZXN0IGJvZHkgbXVzdCBiZSBjb25zdW1lZCBpbiBtZW1vcnkgdW50aWwgYnJvd3NlcnNcblx0XHRcdFx0XHRcdC8vIGltcGxlbWVudCBzdHJlYW1pbmcgcmVxdWVzdCBib2RpZXMgYW5kL29yIHRoZSBib2R5IGdldHRlclxuXHRcdFx0XHRcdFx0Ym9keTpcblx0XHRcdFx0XHRcdFx0cmVzb3VyY2UubWV0aG9kID09PSAnR0VUJyB8fCByZXNvdXJjZS5tZXRob2QgPT09ICdIRUFEJ1xuXHRcdFx0XHRcdFx0XHRcdD8gdW5kZWZpbmVkXG5cdFx0XHRcdFx0XHRcdFx0OiBhd2FpdCByZXNvdXJjZS5ibG9iKCksXG5cdFx0XHRcdFx0XHRjYWNoZTogcmVzb3VyY2UuY2FjaGUsXG5cdFx0XHRcdFx0XHRjcmVkZW50aWFsczogcmVzb3VyY2UuY3JlZGVudGlhbHMsXG5cdFx0XHRcdFx0XHRoZWFkZXJzOiByZXNvdXJjZS5oZWFkZXJzLFxuXHRcdFx0XHRcdFx0aW50ZWdyaXR5OiByZXNvdXJjZS5pbnRlZ3JpdHksXG5cdFx0XHRcdFx0XHRrZWVwYWxpdmU6IHJlc291cmNlLmtlZXBhbGl2ZSxcblx0XHRcdFx0XHRcdG1ldGhvZDogcmVzb3VyY2UubWV0aG9kLFxuXHRcdFx0XHRcdFx0bW9kZTogcmVzb3VyY2UubW9kZSxcblx0XHRcdFx0XHRcdHJlZGlyZWN0OiByZXNvdXJjZS5yZWRpcmVjdCxcblx0XHRcdFx0XHRcdHJlZmVycmVyOiByZXNvdXJjZS5yZWZlcnJlcixcblx0XHRcdFx0XHRcdHJlZmVycmVyUG9saWN5OiByZXNvdXJjZS5yZWZlcnJlclBvbGljeSxcblx0XHRcdFx0XHRcdHNpZ25hbDogcmVzb3VyY2Uuc2lnbmFsLFxuXHRcdFx0XHRcdFx0Li4uaW5pdFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmVxdWVzdGVkID0gcmVzb3VyY2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyB3ZSBtdXN0IGZpeHVwIHJlbGF0aXZlIHVybHMgc28gdGhleSBhcmUgcmVzb2x2ZWQgZnJvbSB0aGUgdGFyZ2V0IHBhZ2Vcblx0XHRcdFx0Y29uc3QgcmVzb2x2ZWQgPSBuZXcgVVJMKHJlcXVlc3RlZCwgdXJsKTtcblx0XHRcdFx0aWYgKGlzX3RyYWNraW5nKSB7XG5cdFx0XHRcdFx0ZGVwZW5kcyhyZXNvbHZlZC5ocmVmKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIG1hdGNoIHNzciBzZXJpYWxpemVkIGRhdGEgdXJsLCB3aGljaCBpcyBpbXBvcnRhbnQgdG8gZmluZCBjYWNoZWQgcmVzcG9uc2VzXG5cdFx0XHRcdGlmIChyZXNvbHZlZC5vcmlnaW4gPT09IHVybC5vcmlnaW4pIHtcblx0XHRcdFx0XHRyZXF1ZXN0ZWQgPSByZXNvbHZlZC5ocmVmLnNsaWNlKHVybC5vcmlnaW4ubGVuZ3RoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIHByZXJlbmRlcmVkIHBhZ2VzIG1heSBiZSBzZXJ2ZWQgZnJvbSBhbnkgb3JpZ2luLCBzbyBgaW5pdGlhbF9mZXRjaGAgdXJscyBzaG91bGRuJ3QgYmUgcmVzb2x2ZWRcblx0XHRcdFx0cmV0dXJuIHN0YXJ0ZWRcblx0XHRcdFx0XHQ/IHN1YnNlcXVlbnRfZmV0Y2gocmVxdWVzdGVkLCByZXNvbHZlZC5ocmVmLCBpbml0KVxuXHRcdFx0XHRcdDogaW5pdGlhbF9mZXRjaChyZXF1ZXN0ZWQsIGluaXQpO1xuXHRcdFx0fSxcblx0XHRcdHNldEhlYWRlcnM6ICgpID0+IHt9LCAvLyBub29wXG5cdFx0XHRkZXBlbmRzLFxuXHRcdFx0cGFyZW50KCkge1xuXHRcdFx0XHRpZiAoaXNfdHJhY2tpbmcpIHtcblx0XHRcdFx0XHR1c2VzLnBhcmVudCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHBhcmVudCgpO1xuXHRcdFx0fSxcblx0XHRcdHVudHJhY2soZm4pIHtcblx0XHRcdFx0aXNfdHJhY2tpbmcgPSBmYWxzZTtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRyZXR1cm4gZm4oKTtcblx0XHRcdFx0fSBmaW5hbGx5IHtcblx0XHRcdFx0XHRpc190cmFja2luZyA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0aWYgKERFVikge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0bG9ja19mZXRjaCgpO1xuXHRcdFx0XHRkYXRhID0gKGF3YWl0IG5vZGUudW5pdmVyc2FsLmxvYWQuY2FsbChudWxsLCBsb2FkX2lucHV0KSkgPz8gbnVsbDtcblx0XHRcdFx0aWYgKGRhdGEgIT0gbnVsbCAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZGF0YSkgIT09IE9iamVjdC5wcm90b3R5cGUpIHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0XHRgYSBsb2FkIGZ1bmN0aW9uIHJlbGF0ZWQgdG8gcm91dGUgJyR7cm91dGUuaWR9JyByZXR1cm5lZCAke1xuXHRcdFx0XHRcdFx0XHR0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCdcblx0XHRcdFx0XHRcdFx0XHQ/IGBhICR7dHlwZW9mIGRhdGF9YFxuXHRcdFx0XHRcdFx0XHRcdDogZGF0YSBpbnN0YW5jZW9mIFJlc3BvbnNlXG5cdFx0XHRcdFx0XHRcdFx0XHQ/ICdhIFJlc3BvbnNlIG9iamVjdCdcblx0XHRcdFx0XHRcdFx0XHRcdDogQXJyYXkuaXNBcnJheShkYXRhKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHQ/ICdhbiBhcnJheSdcblx0XHRcdFx0XHRcdFx0XHRcdFx0OiAnYSBub24tcGxhaW4gb2JqZWN0J1xuXHRcdFx0XHRcdFx0fSwgYnV0IG11c3QgcmV0dXJuIGEgcGxhaW4gb2JqZWN0IGF0IHRoZSB0b3AgbGV2ZWwgKGkuZS4gXFxgcmV0dXJuIHsuLi59XFxgKWBcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGZpbmFsbHkge1xuXHRcdFx0XHR1bmxvY2tfZmV0Y2goKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0ZGF0YSA9IChhd2FpdCBub2RlLnVuaXZlcnNhbC5sb2FkLmNhbGwobnVsbCwgbG9hZF9pbnB1dCkpID8/IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRub2RlLFxuXHRcdGxvYWRlcixcblx0XHRzZXJ2ZXI6IHNlcnZlcl9kYXRhX25vZGUsXG5cdFx0dW5pdmVyc2FsOiBub2RlLnVuaXZlcnNhbD8ubG9hZCA/IHsgdHlwZTogJ2RhdGEnLCBkYXRhLCB1c2VzIH0gOiBudWxsLFxuXHRcdGRhdGE6IGRhdGEgPz8gc2VydmVyX2RhdGFfbm9kZT8uZGF0YSA/PyBudWxsLFxuXHRcdHNsYXNoOiBub2RlLnVuaXZlcnNhbD8udHJhaWxpbmdTbGFzaCA/PyBzZXJ2ZXJfZGF0YV9ub2RlPy5zbGFzaFxuXHR9O1xufVxuXG4vKipcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gcGFyZW50X2NoYW5nZWRcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gcm91dGVfY2hhbmdlZFxuICogQHBhcmFtIHtib29sZWFufSB1cmxfY2hhbmdlZFxuICogQHBhcmFtIHtTZXQ8c3RyaW5nPn0gc2VhcmNoX3BhcmFtc19jaGFuZ2VkXG4gKiBAcGFyYW0ge2ltcG9ydCgndHlwZXMnKS5Vc2VzIHwgdW5kZWZpbmVkfSB1c2VzXG4gKiBAcGFyYW0ge1JlY29yZDxzdHJpbmcsIHN0cmluZz59IHBhcmFtc1xuICovXG5mdW5jdGlvbiBoYXNfY2hhbmdlZChcblx0cGFyZW50X2NoYW5nZWQsXG5cdHJvdXRlX2NoYW5nZWQsXG5cdHVybF9jaGFuZ2VkLFxuXHRzZWFyY2hfcGFyYW1zX2NoYW5nZWQsXG5cdHVzZXMsXG5cdHBhcmFtc1xuKSB7XG5cdGlmIChmb3JjZV9pbnZhbGlkYXRpb24pIHJldHVybiB0cnVlO1xuXG5cdGlmICghdXNlcykgcmV0dXJuIGZhbHNlO1xuXG5cdGlmICh1c2VzLnBhcmVudCAmJiBwYXJlbnRfY2hhbmdlZCkgcmV0dXJuIHRydWU7XG5cdGlmICh1c2VzLnJvdXRlICYmIHJvdXRlX2NoYW5nZWQpIHJldHVybiB0cnVlO1xuXHRpZiAodXNlcy51cmwgJiYgdXJsX2NoYW5nZWQpIHJldHVybiB0cnVlO1xuXG5cdGZvciAoY29uc3QgdHJhY2tlZF9wYXJhbXMgb2YgdXNlcy5zZWFyY2hfcGFyYW1zKSB7XG5cdFx0aWYgKHNlYXJjaF9wYXJhbXNfY2hhbmdlZC5oYXModHJhY2tlZF9wYXJhbXMpKSByZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdGZvciAoY29uc3QgcGFyYW0gb2YgdXNlcy5wYXJhbXMpIHtcblx0XHRpZiAocGFyYW1zW3BhcmFtXSAhPT0gY3VycmVudC5wYXJhbXNbcGFyYW1dKSByZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdGZvciAoY29uc3QgaHJlZiBvZiB1c2VzLmRlcGVuZGVuY2llcykge1xuXHRcdGlmIChpbnZhbGlkYXRlZC5zb21lKChmbikgPT4gZm4obmV3IFVSTChocmVmKSkpKSByZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge2ltcG9ydCgndHlwZXMnKS5TZXJ2ZXJEYXRhTm9kZSB8IGltcG9ydCgndHlwZXMnKS5TZXJ2ZXJEYXRhU2tpcHBlZE5vZGUgfCBudWxsfSBub2RlXG4gKiBAcGFyYW0ge2ltcG9ydCgnLi90eXBlcy5qcycpLkRhdGFOb2RlIHwgbnVsbH0gW3ByZXZpb3VzXVxuICogQHJldHVybnMge2ltcG9ydCgnLi90eXBlcy5qcycpLkRhdGFOb2RlIHwgbnVsbH1cbiAqL1xuZnVuY3Rpb24gY3JlYXRlX2RhdGFfbm9kZShub2RlLCBwcmV2aW91cykge1xuXHRpZiAobm9kZT8udHlwZSA9PT0gJ2RhdGEnKSByZXR1cm4gbm9kZTtcblx0aWYgKG5vZGU/LnR5cGUgPT09ICdza2lwJykgcmV0dXJuIHByZXZpb3VzID8/IG51bGw7XG5cdHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0ge1VSTCB8IG51bGx9IG9sZF91cmxcbiAqIEBwYXJhbSB7VVJMfSBuZXdfdXJsXG4gKi9cbmZ1bmN0aW9uIGRpZmZfc2VhcmNoX3BhcmFtcyhvbGRfdXJsLCBuZXdfdXJsKSB7XG5cdGlmICghb2xkX3VybCkgcmV0dXJuIG5ldyBTZXQobmV3X3VybC5zZWFyY2hQYXJhbXMua2V5cygpKTtcblxuXHRjb25zdCBjaGFuZ2VkID0gbmV3IFNldChbLi4ub2xkX3VybC5zZWFyY2hQYXJhbXMua2V5cygpLCAuLi5uZXdfdXJsLnNlYXJjaFBhcmFtcy5rZXlzKCldKTtcblxuXHRmb3IgKGNvbnN0IGtleSBvZiBjaGFuZ2VkKSB7XG5cdFx0Y29uc3Qgb2xkX3ZhbHVlcyA9IG9sZF91cmwuc2VhcmNoUGFyYW1zLmdldEFsbChrZXkpO1xuXHRcdGNvbnN0IG5ld192YWx1ZXMgPSBuZXdfdXJsLnNlYXJjaFBhcmFtcy5nZXRBbGwoa2V5KTtcblxuXHRcdGlmIChcblx0XHRcdG9sZF92YWx1ZXMuZXZlcnkoKHZhbHVlKSA9PiBuZXdfdmFsdWVzLmluY2x1ZGVzKHZhbHVlKSkgJiZcblx0XHRcdG5ld192YWx1ZXMuZXZlcnkoKHZhbHVlKSA9PiBvbGRfdmFsdWVzLmluY2x1ZGVzKHZhbHVlKSlcblx0XHQpIHtcblx0XHRcdGNoYW5nZWQuZGVsZXRlKGtleSk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGNoYW5nZWQ7XG59XG5cbi8qKlxuICogQHBhcmFtIHtpbXBvcnQoJy4vdHlwZXMuanMnKS5OYXZpZ2F0aW9uSW50ZW50fSBpbnRlbnRcbiAqIEByZXR1cm5zIHtQcm9taXNlPGltcG9ydCgnLi90eXBlcy5qcycpLk5hdmlnYXRpb25SZXN1bHQ+fVxuICovXG5hc3luYyBmdW5jdGlvbiBsb2FkX3JvdXRlKHsgaWQsIGludmFsaWRhdGluZywgdXJsLCBwYXJhbXMsIHJvdXRlIH0pIHtcblx0aWYgKGxvYWRfY2FjaGU/LmlkID09PSBpZCkge1xuXHRcdHJldHVybiBsb2FkX2NhY2hlLnByb21pc2U7XG5cdH1cblxuXHRjb25zdCB7IGVycm9ycywgbGF5b3V0cywgbGVhZiB9ID0gcm91dGU7XG5cblx0Y29uc3QgbG9hZGVycyA9IFsuLi5sYXlvdXRzLCBsZWFmXTtcblxuXHQvLyBwcmVsb2FkIG1vZHVsZXMgdG8gYXZvaWQgd2F0ZXJmYWxsLCBidXQgaGFuZGxlIHJlamVjdGlvbnNcblx0Ly8gc28gdGhleSBkb24ndCBnZXQgcmVwb3J0ZWQgdG8gU2VudHJ5IGV0IGFsICh3ZSBkb24ndCBuZWVkXG5cdC8vIHRvIGFjdCBvbiB0aGUgZmFpbHVyZXMgYXQgdGhpcyBwb2ludClcblx0ZXJyb3JzLmZvckVhY2goKGxvYWRlcikgPT4gbG9hZGVyPy4oKS5jYXRjaCgoKSA9PiB7fSkpO1xuXHRsb2FkZXJzLmZvckVhY2goKGxvYWRlcikgPT4gbG9hZGVyPy5bMV0oKS5jYXRjaCgoKSA9PiB7fSkpO1xuXG5cdC8qKiBAdHlwZSB7aW1wb3J0KCd0eXBlcycpLlNlcnZlck5vZGVzUmVzcG9uc2UgfCBpbXBvcnQoJ3R5cGVzJykuU2VydmVyUmVkaXJlY3ROb2RlIHwgbnVsbH0gKi9cblx0bGV0IHNlcnZlcl9kYXRhID0gbnVsbDtcblx0Y29uc3QgdXJsX2NoYW5nZWQgPSBjdXJyZW50LnVybCA/IGlkICE9PSBjdXJyZW50LnVybC5wYXRobmFtZSArIGN1cnJlbnQudXJsLnNlYXJjaCA6IGZhbHNlO1xuXHRjb25zdCByb3V0ZV9jaGFuZ2VkID0gY3VycmVudC5yb3V0ZSA/IHJvdXRlLmlkICE9PSBjdXJyZW50LnJvdXRlLmlkIDogZmFsc2U7XG5cdGNvbnN0IHNlYXJjaF9wYXJhbXNfY2hhbmdlZCA9IGRpZmZfc2VhcmNoX3BhcmFtcyhjdXJyZW50LnVybCwgdXJsKTtcblxuXHRsZXQgcGFyZW50X2ludmFsaWQgPSBmYWxzZTtcblx0Y29uc3QgaW52YWxpZF9zZXJ2ZXJfbm9kZXMgPSBsb2FkZXJzLm1hcCgobG9hZGVyLCBpKSA9PiB7XG5cdFx0Y29uc3QgcHJldmlvdXMgPSBjdXJyZW50LmJyYW5jaFtpXTtcblxuXHRcdGNvbnN0IGludmFsaWQgPVxuXHRcdFx0ISFsb2FkZXI/LlswXSAmJlxuXHRcdFx0KHByZXZpb3VzPy5sb2FkZXIgIT09IGxvYWRlclsxXSB8fFxuXHRcdFx0XHRoYXNfY2hhbmdlZChcblx0XHRcdFx0XHRwYXJlbnRfaW52YWxpZCxcblx0XHRcdFx0XHRyb3V0ZV9jaGFuZ2VkLFxuXHRcdFx0XHRcdHVybF9jaGFuZ2VkLFxuXHRcdFx0XHRcdHNlYXJjaF9wYXJhbXNfY2hhbmdlZCxcblx0XHRcdFx0XHRwcmV2aW91cy5zZXJ2ZXI/LnVzZXMsXG5cdFx0XHRcdFx0cGFyYW1zXG5cdFx0XHRcdCkpO1xuXG5cdFx0aWYgKGludmFsaWQpIHtcblx0XHRcdC8vIEZvciB0aGUgbmV4dCBvbmVcblx0XHRcdHBhcmVudF9pbnZhbGlkID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gaW52YWxpZDtcblx0fSk7XG5cblx0aWYgKGludmFsaWRfc2VydmVyX25vZGVzLnNvbWUoQm9vbGVhbikpIHtcblx0XHR0cnkge1xuXHRcdFx0c2VydmVyX2RhdGEgPSBhd2FpdCBsb2FkX2RhdGEodXJsLCBpbnZhbGlkX3NlcnZlcl9ub2Rlcyk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHJldHVybiBsb2FkX3Jvb3RfZXJyb3JfcGFnZSh7XG5cdFx0XHRcdHN0YXR1czogZ2V0X3N0YXR1cyhlcnJvciksXG5cdFx0XHRcdGVycm9yOiBhd2FpdCBoYW5kbGVfZXJyb3IoZXJyb3IsIHsgdXJsLCBwYXJhbXMsIHJvdXRlOiB7IGlkOiByb3V0ZS5pZCB9IH0pLFxuXHRcdFx0XHR1cmwsXG5cdFx0XHRcdHJvdXRlXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoc2VydmVyX2RhdGEudHlwZSA9PT0gJ3JlZGlyZWN0Jykge1xuXHRcdFx0cmV0dXJuIHNlcnZlcl9kYXRhO1xuXHRcdH1cblx0fVxuXG5cdGNvbnN0IHNlcnZlcl9kYXRhX25vZGVzID0gc2VydmVyX2RhdGE/Lm5vZGVzO1xuXG5cdGxldCBwYXJlbnRfY2hhbmdlZCA9IGZhbHNlO1xuXG5cdGNvbnN0IGJyYW5jaF9wcm9taXNlcyA9IGxvYWRlcnMubWFwKGFzeW5jIChsb2FkZXIsIGkpID0+IHtcblx0XHRpZiAoIWxvYWRlcikgcmV0dXJuO1xuXG5cdFx0LyoqIEB0eXBlIHtpbXBvcnQoJy4vdHlwZXMuanMnKS5CcmFuY2hOb2RlIHwgdW5kZWZpbmVkfSAqL1xuXHRcdGNvbnN0IHByZXZpb3VzID0gY3VycmVudC5icmFuY2hbaV07XG5cblx0XHRjb25zdCBzZXJ2ZXJfZGF0YV9ub2RlID0gc2VydmVyX2RhdGFfbm9kZXM/LltpXTtcblxuXHRcdC8vIHJlLXVzZSBkYXRhIGZyb20gcHJldmlvdXMgbG9hZCBpZiBpdCdzIHN0aWxsIHZhbGlkXG5cdFx0Y29uc3QgdmFsaWQgPVxuXHRcdFx0KCFzZXJ2ZXJfZGF0YV9ub2RlIHx8IHNlcnZlcl9kYXRhX25vZGUudHlwZSA9PT0gJ3NraXAnKSAmJlxuXHRcdFx0bG9hZGVyWzFdID09PSBwcmV2aW91cz8ubG9hZGVyICYmXG5cdFx0XHQhaGFzX2NoYW5nZWQoXG5cdFx0XHRcdHBhcmVudF9jaGFuZ2VkLFxuXHRcdFx0XHRyb3V0ZV9jaGFuZ2VkLFxuXHRcdFx0XHR1cmxfY2hhbmdlZCxcblx0XHRcdFx0c2VhcmNoX3BhcmFtc19jaGFuZ2VkLFxuXHRcdFx0XHRwcmV2aW91cy51bml2ZXJzYWw/LnVzZXMsXG5cdFx0XHRcdHBhcmFtc1xuXHRcdFx0KTtcblx0XHRpZiAodmFsaWQpIHJldHVybiBwcmV2aW91cztcblxuXHRcdHBhcmVudF9jaGFuZ2VkID0gdHJ1ZTtcblxuXHRcdGlmIChzZXJ2ZXJfZGF0YV9ub2RlPy50eXBlID09PSAnZXJyb3InKSB7XG5cdFx0XHQvLyByZXRocm93IGFuZCBjYXRjaCBiZWxvd1xuXHRcdFx0dGhyb3cgc2VydmVyX2RhdGFfbm9kZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbG9hZF9ub2RlKHtcblx0XHRcdGxvYWRlcjogbG9hZGVyWzFdLFxuXHRcdFx0dXJsLFxuXHRcdFx0cGFyYW1zLFxuXHRcdFx0cm91dGUsXG5cdFx0XHRwYXJlbnQ6IGFzeW5jICgpID0+IHtcblx0XHRcdFx0Y29uc3QgZGF0YSA9IHt9O1xuXHRcdFx0XHRmb3IgKGxldCBqID0gMDsgaiA8IGk7IGogKz0gMSkge1xuXHRcdFx0XHRcdE9iamVjdC5hc3NpZ24oZGF0YSwgKGF3YWl0IGJyYW5jaF9wcm9taXNlc1tqXSk/LmRhdGEpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBkYXRhO1xuXHRcdFx0fSxcblx0XHRcdHNlcnZlcl9kYXRhX25vZGU6IGNyZWF0ZV9kYXRhX25vZGUoXG5cdFx0XHRcdC8vIHNlcnZlcl9kYXRhX25vZGUgaXMgdW5kZWZpbmVkIGlmIGl0IHdhc24ndCByZWxvYWRlZCBmcm9tIHRoZSBzZXJ2ZXI7XG5cdFx0XHRcdC8vIGFuZCBpZiBjdXJyZW50IGxvYWRlciB1c2VzIHNlcnZlciBkYXRhLCB3ZSB3YW50IHRvIHJldXNlIHByZXZpb3VzIGRhdGEuXG5cdFx0XHRcdHNlcnZlcl9kYXRhX25vZGUgPT09IHVuZGVmaW5lZCAmJiBsb2FkZXJbMF0gPyB7IHR5cGU6ICdza2lwJyB9IDogc2VydmVyX2RhdGFfbm9kZSA/PyBudWxsLFxuXHRcdFx0XHRsb2FkZXJbMF0gPyBwcmV2aW91cz8uc2VydmVyIDogdW5kZWZpbmVkXG5cdFx0XHQpXG5cdFx0fSk7XG5cdH0pO1xuXG5cdC8vIGlmIHdlIGRvbid0IGRvIHRoaXMsIHJlamVjdGlvbnMgd2lsbCBiZSB1bmhhbmRsZWRcblx0Zm9yIChjb25zdCBwIG9mIGJyYW5jaF9wcm9taXNlcykgcC5jYXRjaCgoKSA9PiB7fSk7XG5cblx0LyoqIEB0eXBlIHtBcnJheTxpbXBvcnQoJy4vdHlwZXMuanMnKS5CcmFuY2hOb2RlIHwgdW5kZWZpbmVkPn0gKi9cblx0Y29uc3QgYnJhbmNoID0gW107XG5cblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsb2FkZXJzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0aWYgKGxvYWRlcnNbaV0pIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGJyYW5jaC5wdXNoKGF3YWl0IGJyYW5jaF9wcm9taXNlc1tpXSk7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0aWYgKGVyciBpbnN0YW5jZW9mIFJlZGlyZWN0KSB7XG5cdFx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRcdHR5cGU6ICdyZWRpcmVjdCcsXG5cdFx0XHRcdFx0XHRsb2NhdGlvbjogZXJyLmxvY2F0aW9uXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxldCBzdGF0dXMgPSBnZXRfc3RhdHVzKGVycik7XG5cdFx0XHRcdC8qKiBAdHlwZSB7QXBwLkVycm9yfSAqL1xuXHRcdFx0XHRsZXQgZXJyb3I7XG5cblx0XHRcdFx0aWYgKHNlcnZlcl9kYXRhX25vZGVzPy5pbmNsdWRlcygvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5TZXJ2ZXJFcnJvck5vZGV9ICovIChlcnIpKSkge1xuXHRcdFx0XHRcdC8vIHRoaXMgaXMgdGhlIHNlcnZlciBlcnJvciByZXRocm93biBhYm92ZSwgcmVjb25zdHJ1Y3QgYnV0IGRvbid0IGludm9rZVxuXHRcdFx0XHRcdC8vIHRoZSBjbGllbnQgZXJyb3IgaGFuZGxlcjsgaXQgc2hvdWxkJ3ZlIGFscmVhZHkgYmVlbiBoYW5kbGVkIG9uIHRoZSBzZXJ2ZXJcblx0XHRcdFx0XHRzdGF0dXMgPSAvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5TZXJ2ZXJFcnJvck5vZGV9ICovIChlcnIpLnN0YXR1cyA/PyBzdGF0dXM7XG5cdFx0XHRcdFx0ZXJyb3IgPSAvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5TZXJ2ZXJFcnJvck5vZGV9ICovIChlcnIpLmVycm9yO1xuXHRcdFx0XHR9IGVsc2UgaWYgKGVyciBpbnN0YW5jZW9mIEh0dHBFcnJvcikge1xuXHRcdFx0XHRcdGVycm9yID0gZXJyLmJvZHk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gUmVmZXJlbmNlZCBub2RlIGNvdWxkIGhhdmUgYmVlbiByZW1vdmVkIGR1ZSB0byByZWRlcGxveSwgY2hlY2tcblx0XHRcdFx0XHRjb25zdCB1cGRhdGVkID0gYXdhaXQgc3RvcmVzLnVwZGF0ZWQuY2hlY2soKTtcblx0XHRcdFx0XHRpZiAodXBkYXRlZCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGF3YWl0IG5hdGl2ZV9uYXZpZ2F0aW9uKHVybCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZXJyb3IgPSBhd2FpdCBoYW5kbGVfZXJyb3IoZXJyLCB7IHBhcmFtcywgdXJsLCByb3V0ZTogeyBpZDogcm91dGUuaWQgfSB9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IGVycm9yX2xvYWQgPSBhd2FpdCBsb2FkX25lYXJlc3RfZXJyb3JfcGFnZShpLCBicmFuY2gsIGVycm9ycyk7XG5cdFx0XHRcdGlmIChlcnJvcl9sb2FkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGF3YWl0IGdldF9uYXZpZ2F0aW9uX3Jlc3VsdF9mcm9tX2JyYW5jaCh7XG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRwYXJhbXMsXG5cdFx0XHRcdFx0XHRicmFuY2g6IGJyYW5jaC5zbGljZSgwLCBlcnJvcl9sb2FkLmlkeCkuY29uY2F0KGVycm9yX2xvYWQubm9kZSksXG5cdFx0XHRcdFx0XHRzdGF0dXMsXG5cdFx0XHRcdFx0XHRlcnJvcixcblx0XHRcdFx0XHRcdHJvdXRlXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gaWYgd2UgZ2V0IGhlcmUsIGl0J3MgYmVjYXVzZSB0aGUgcm9vdCBgbG9hZGAgZnVuY3Rpb24gZmFpbGVkLFxuXHRcdFx0XHRcdC8vIGFuZCB3ZSBuZWVkIHRvIGZhbGwgYmFjayB0byB0aGUgc2VydmVyXG5cdFx0XHRcdFx0cmV0dXJuIGF3YWl0IHNlcnZlcl9mYWxsYmFjayh1cmwsIHsgaWQ6IHJvdXRlLmlkIH0sIGVycm9yLCBzdGF0dXMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIHB1c2ggYW4gZW1wdHkgc2xvdCBzbyB3ZSBjYW4gcmV3aW5kIHBhc3QgZ2FwcyB0byB0aGVcblx0XHRcdC8vIGxheW91dCB0aGF0IGNvcnJlc3BvbmRzIHdpdGggYW4gK2Vycm9yLnN2ZWx0ZSBwYWdlXG5cdFx0XHRicmFuY2gucHVzaCh1bmRlZmluZWQpO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBhd2FpdCBnZXRfbmF2aWdhdGlvbl9yZXN1bHRfZnJvbV9icmFuY2goe1xuXHRcdHVybCxcblx0XHRwYXJhbXMsXG5cdFx0YnJhbmNoLFxuXHRcdHN0YXR1czogMjAwLFxuXHRcdGVycm9yOiBudWxsLFxuXHRcdHJvdXRlLFxuXHRcdC8vIFJlc2V0IGBmb3JtYCBvbiBuYXZpZ2F0aW9uLCBidXQgbm90IGludmFsaWRhdGlvblxuXHRcdGZvcm06IGludmFsaWRhdGluZyA/IHVuZGVmaW5lZCA6IG51bGxcblx0fSk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGkgU3RhcnQgaW5kZXggdG8gYmFja3RyYWNrIGZyb21cbiAqIEBwYXJhbSB7QXJyYXk8aW1wb3J0KCcuL3R5cGVzLmpzJykuQnJhbmNoTm9kZSB8IHVuZGVmaW5lZD59IGJyYW5jaCBCcmFuY2ggdG8gYmFja3RyYWNrXG4gKiBAcGFyYW0ge0FycmF5PGltcG9ydCgndHlwZXMnKS5DU1JQYWdlTm9kZUxvYWRlciB8IHVuZGVmaW5lZD59IGVycm9ycyBBbGwgZXJyb3IgcGFnZXMgZm9yIHRoaXMgYnJhbmNoXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7aWR4OiBudW1iZXI7IG5vZGU6IGltcG9ydCgnLi90eXBlcy5qcycpLkJyYW5jaE5vZGV9IHwgdW5kZWZpbmVkPn1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbG9hZF9uZWFyZXN0X2Vycm9yX3BhZ2UoaSwgYnJhbmNoLCBlcnJvcnMpIHtcblx0d2hpbGUgKGktLSkge1xuXHRcdGlmIChlcnJvcnNbaV0pIHtcblx0XHRcdGxldCBqID0gaTtcblx0XHRcdHdoaWxlICghYnJhbmNoW2pdKSBqIC09IDE7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdGlkeDogaiArIDEsXG5cdFx0XHRcdFx0bm9kZToge1xuXHRcdFx0XHRcdFx0bm9kZTogYXdhaXQgLyoqIEB0eXBlIHtpbXBvcnQoJ3R5cGVzJykuQ1NSUGFnZU5vZGVMb2FkZXIgfSAqLyAoZXJyb3JzW2ldKSgpLFxuXHRcdFx0XHRcdFx0bG9hZGVyOiAvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5DU1JQYWdlTm9kZUxvYWRlciB9ICovIChlcnJvcnNbaV0pLFxuXHRcdFx0XHRcdFx0ZGF0YToge30sXG5cdFx0XHRcdFx0XHRzZXJ2ZXI6IG51bGwsXG5cdFx0XHRcdFx0XHR1bml2ZXJzYWw6IG51bGxcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG4vKipcbiAqIEBwYXJhbSB7e1xuICogICBzdGF0dXM6IG51bWJlcjtcbiAqICAgZXJyb3I6IEFwcC5FcnJvcjtcbiAqICAgdXJsOiBVUkw7XG4gKiAgIHJvdXRlOiB7IGlkOiBzdHJpbmcgfCBudWxsIH1cbiAqIH19IG9wdHNcbiAqIEByZXR1cm5zIHtQcm9taXNlPGltcG9ydCgnLi90eXBlcy5qcycpLk5hdmlnYXRpb25GaW5pc2hlZD59XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxvYWRfcm9vdF9lcnJvcl9wYWdlKHsgc3RhdHVzLCBlcnJvciwgdXJsLCByb3V0ZSB9KSB7XG5cdC8qKiBAdHlwZSB7UmVjb3JkPHN0cmluZywgc3RyaW5nPn0gKi9cblx0Y29uc3QgcGFyYW1zID0ge307IC8vIGVycm9yIHBhZ2UgZG9lcyBub3QgaGF2ZSBwYXJhbXNcblxuXHQvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5TZXJ2ZXJEYXRhTm9kZSB8IG51bGx9ICovXG5cdGxldCBzZXJ2ZXJfZGF0YV9ub2RlID0gbnVsbDtcblxuXHRjb25zdCBkZWZhdWx0X2xheW91dF9oYXNfc2VydmVyX2xvYWQgPSBhcHAuc2VydmVyX2xvYWRzWzBdID09PSAwO1xuXG5cdGlmIChkZWZhdWx0X2xheW91dF9oYXNfc2VydmVyX2xvYWQpIHtcblx0XHQvLyBUT0RPIHBvc3QtaHR0cHM6Ly9naXRodWIuY29tL3N2ZWx0ZWpzL2tpdC9kaXNjdXNzaW9ucy82MTI0IHdlIGNhbiB1c2Vcblx0XHQvLyBleGlzdGluZyByb290IGxheW91dCBkYXRhXG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHNlcnZlcl9kYXRhID0gYXdhaXQgbG9hZF9kYXRhKHVybCwgW3RydWVdKTtcblxuXHRcdFx0aWYgKFxuXHRcdFx0XHRzZXJ2ZXJfZGF0YS50eXBlICE9PSAnZGF0YScgfHxcblx0XHRcdFx0KHNlcnZlcl9kYXRhLm5vZGVzWzBdICYmIHNlcnZlcl9kYXRhLm5vZGVzWzBdLnR5cGUgIT09ICdkYXRhJylcblx0XHRcdCkge1xuXHRcdFx0XHR0aHJvdyAwO1xuXHRcdFx0fVxuXG5cdFx0XHRzZXJ2ZXJfZGF0YV9ub2RlID0gc2VydmVyX2RhdGEubm9kZXNbMF0gPz8gbnVsbDtcblx0XHR9IGNhdGNoIHtcblx0XHRcdC8vIGF0IHRoaXMgcG9pbnQgd2UgaGF2ZSBubyBjaG9pY2UgYnV0IHRvIGZhbGwgYmFjayB0byB0aGUgc2VydmVyLCBpZiBpdCB3b3VsZG4ndFxuXHRcdFx0Ly8gYnJpbmcgdXMgcmlnaHQgYmFjayBoZXJlLCB0dXJuaW5nIHRoaXMgaW50byBhbiBlbmRsZXNzIGxvb3Bcblx0XHRcdGlmICh1cmwub3JpZ2luICE9PSBvcmlnaW4gfHwgdXJsLnBhdGhuYW1lICE9PSBsb2NhdGlvbi5wYXRobmFtZSB8fCBoeWRyYXRlZCkge1xuXHRcdFx0XHRhd2FpdCBuYXRpdmVfbmF2aWdhdGlvbih1cmwpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGNvbnN0IHJvb3RfbGF5b3V0ID0gYXdhaXQgbG9hZF9ub2RlKHtcblx0XHRsb2FkZXI6IGRlZmF1bHRfbGF5b3V0X2xvYWRlcixcblx0XHR1cmwsXG5cdFx0cGFyYW1zLFxuXHRcdHJvdXRlLFxuXHRcdHBhcmVudDogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHt9KSxcblx0XHRzZXJ2ZXJfZGF0YV9ub2RlOiBjcmVhdGVfZGF0YV9ub2RlKHNlcnZlcl9kYXRhX25vZGUpXG5cdH0pO1xuXG5cdC8qKiBAdHlwZSB7aW1wb3J0KCcuL3R5cGVzLmpzJykuQnJhbmNoTm9kZX0gKi9cblx0Y29uc3Qgcm9vdF9lcnJvciA9IHtcblx0XHRub2RlOiBhd2FpdCBkZWZhdWx0X2Vycm9yX2xvYWRlcigpLFxuXHRcdGxvYWRlcjogZGVmYXVsdF9lcnJvcl9sb2FkZXIsXG5cdFx0dW5pdmVyc2FsOiBudWxsLFxuXHRcdHNlcnZlcjogbnVsbCxcblx0XHRkYXRhOiBudWxsXG5cdH07XG5cblx0cmV0dXJuIGF3YWl0IGdldF9uYXZpZ2F0aW9uX3Jlc3VsdF9mcm9tX2JyYW5jaCh7XG5cdFx0dXJsLFxuXHRcdHBhcmFtcyxcblx0XHRicmFuY2g6IFtyb290X2xheW91dCwgcm9vdF9lcnJvcl0sXG5cdFx0c3RhdHVzLFxuXHRcdGVycm9yLFxuXHRcdHJvdXRlOiBudWxsXG5cdH0pO1xufVxuXG4vKipcbiAqIFJlc29sdmUgdGhlIGZ1bGwgaW5mbyAod2hpY2ggcm91dGUsIHBhcmFtcywgZXRjLikgZm9yIGEgY2xpZW50LXNpZGUgbmF2aWdhdGlvbiBmcm9tIHRoZSBVUkwsXG4gKiB0YWtpbmcgdGhlIHJlcm91dGUgaG9vayBpbnRvIGFjY291bnQuIElmIHRoaXMgaXNuJ3QgYSBjbGllbnQtc2lkZS1uYXZpZ2F0aW9uIChvciB0aGUgVVJMIGlzIHVuZGVmaW5lZCksXG4gKiByZXR1cm5zIHVuZGVmaW5lZC5cbiAqIEBwYXJhbSB7VVJMIHwgdW5kZWZpbmVkfSB1cmxcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaW52YWxpZGF0aW5nXG4gKi9cbmZ1bmN0aW9uIGdldF9uYXZpZ2F0aW9uX2ludGVudCh1cmwsIGludmFsaWRhdGluZykge1xuXHRpZiAoIXVybCkgcmV0dXJuIHVuZGVmaW5lZDtcblx0aWYgKGlzX2V4dGVybmFsX3VybCh1cmwsIGJhc2UpKSByZXR1cm47XG5cblx0Ly8gcmVyb3V0ZSBjb3VsZCBhbHRlciB0aGUgZ2l2ZW4gVVJMLCBzbyB3ZSBwYXNzIGEgY29weVxuXHRsZXQgcmVyb3V0ZWQ7XG5cdHRyeSB7XG5cdFx0cmVyb3V0ZWQgPSBhcHAuaG9va3MucmVyb3V0ZSh7IHVybDogbmV3IFVSTCh1cmwpIH0pID8/IHVybC5wYXRobmFtZTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmIChERVYpIHtcblx0XHRcdC8vIGluIGRldmVsb3BtZW50LCBwcmludCB0aGUgZXJyb3IuLi5cblx0XHRcdGNvbnNvbGUuZXJyb3IoZSk7XG5cblx0XHRcdC8vIC4uLmFuZCBwYXVzZSBleGVjdXRpb24sIHNpbmNlIG90aGVyd2lzZSB3ZSB3aWxsIGltbWVkaWF0ZWx5IHJlbG9hZCB0aGUgcGFnZVxuXHRcdFx0ZGVidWdnZXI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblx0XHR9XG5cblx0XHQvLyBmYWxsIGJhY2sgdG8gbmF0aXZlIG5hdmlnYXRpb25cblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9XG5cblx0Y29uc3QgcGF0aCA9IGdldF91cmxfcGF0aChyZXJvdXRlZCk7XG5cblx0Zm9yIChjb25zdCByb3V0ZSBvZiByb3V0ZXMpIHtcblx0XHRjb25zdCBwYXJhbXMgPSByb3V0ZS5leGVjKHBhdGgpO1xuXG5cdFx0aWYgKHBhcmFtcykge1xuXHRcdFx0Y29uc3QgaWQgPSB1cmwucGF0aG5hbWUgKyB1cmwuc2VhcmNoO1xuXHRcdFx0LyoqIEB0eXBlIHtpbXBvcnQoJy4vdHlwZXMuanMnKS5OYXZpZ2F0aW9uSW50ZW50fSAqL1xuXHRcdFx0Y29uc3QgaW50ZW50ID0ge1xuXHRcdFx0XHRpZCxcblx0XHRcdFx0aW52YWxpZGF0aW5nLFxuXHRcdFx0XHRyb3V0ZSxcblx0XHRcdFx0cGFyYW1zOiBkZWNvZGVfcGFyYW1zKHBhcmFtcyksXG5cdFx0XHRcdHVybFxuXHRcdFx0fTtcblx0XHRcdHJldHVybiBpbnRlbnQ7XG5cdFx0fVxuXHR9XG59XG5cbi8qKiBAcGFyYW0ge3N0cmluZ30gcGF0aG5hbWUgKi9cbmZ1bmN0aW9uIGdldF91cmxfcGF0aChwYXRobmFtZSkge1xuXHRyZXR1cm4gZGVjb2RlX3BhdGhuYW1lKHBhdGhuYW1lLnNsaWNlKGJhc2UubGVuZ3RoKSB8fCAnLycpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7e1xuICogICB1cmw6IFVSTDtcbiAqICAgdHlwZTogaW1wb3J0KCdAc3ZlbHRlanMva2l0JykuTmF2aWdhdGlvbltcInR5cGVcIl07XG4gKiAgIGludGVudD86IGltcG9ydCgnLi90eXBlcy5qcycpLk5hdmlnYXRpb25JbnRlbnQ7XG4gKiAgIGRlbHRhPzogbnVtYmVyO1xuICogfX0gb3B0c1xuICovXG5mdW5jdGlvbiBfYmVmb3JlX25hdmlnYXRlKHsgdXJsLCB0eXBlLCBpbnRlbnQsIGRlbHRhIH0pIHtcblx0bGV0IHNob3VsZF9ibG9jayA9IGZhbHNlO1xuXG5cdGNvbnN0IG5hdiA9IGNyZWF0ZV9uYXZpZ2F0aW9uKGN1cnJlbnQsIGludGVudCwgdXJsLCB0eXBlKTtcblxuXHRpZiAoZGVsdGEgIT09IHVuZGVmaW5lZCkge1xuXHRcdG5hdi5uYXZpZ2F0aW9uLmRlbHRhID0gZGVsdGE7XG5cdH1cblxuXHRjb25zdCBjYW5jZWxsYWJsZSA9IHtcblx0XHQuLi5uYXYubmF2aWdhdGlvbixcblx0XHRjYW5jZWw6ICgpID0+IHtcblx0XHRcdHNob3VsZF9ibG9jayA9IHRydWU7XG5cdFx0XHRuYXYucmVqZWN0KG5ldyBFcnJvcignbmF2aWdhdGlvbiBjYW5jZWxsZWQnKSk7XG5cdFx0fVxuXHR9O1xuXG5cdGlmICghbmF2aWdhdGluZykge1xuXHRcdC8vIERvbid0IHJ1biB0aGUgZXZlbnQgZHVyaW5nIHJlZGlyZWN0c1xuXHRcdGJlZm9yZV9uYXZpZ2F0ZV9jYWxsYmFja3MuZm9yRWFjaCgoZm4pID0+IGZuKGNhbmNlbGxhYmxlKSk7XG5cdH1cblxuXHRyZXR1cm4gc2hvdWxkX2Jsb2NrID8gbnVsbCA6IG5hdjtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge3tcbiAqICAgdHlwZTogaW1wb3J0KCdAc3ZlbHRlanMva2l0JykuTmF2aWdhdGlvbltcInR5cGVcIl07XG4gKiAgIHVybDogVVJMO1xuICogICBwb3BwZWQ/OiB7XG4gKiAgICAgc3RhdGU6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gKiAgICAgc2Nyb2xsOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gKiAgICAgZGVsdGE6IG51bWJlcjtcbiAqICAgfTtcbiAqICAga2VlcGZvY3VzPzogYm9vbGVhbjtcbiAqICAgbm9zY3JvbGw/OiBib29sZWFuO1xuICogICByZXBsYWNlX3N0YXRlPzogYm9vbGVhbjtcbiAqICAgc3RhdGU/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICogICByZWRpcmVjdF9jb3VudD86IG51bWJlcjtcbiAqICAgbmF2X3Rva2VuPzoge307XG4gKiAgIGFjY2VwdD86ICgpID0+IHZvaWQ7XG4gKiAgIGJsb2NrPzogKCkgPT4gdm9pZDtcbiAqIH19IG9wdHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gbmF2aWdhdGUoe1xuXHR0eXBlLFxuXHR1cmwsXG5cdHBvcHBlZCxcblx0a2VlcGZvY3VzLFxuXHRub3Njcm9sbCxcblx0cmVwbGFjZV9zdGF0ZSxcblx0c3RhdGUgPSB7fSxcblx0cmVkaXJlY3RfY291bnQgPSAwLFxuXHRuYXZfdG9rZW4gPSB7fSxcblx0YWNjZXB0ID0gbm9vcCxcblx0YmxvY2sgPSBub29wXG59KSB7XG5cdGNvbnN0IGludGVudCA9IGdldF9uYXZpZ2F0aW9uX2ludGVudCh1cmwsIGZhbHNlKTtcblx0Y29uc3QgbmF2ID0gX2JlZm9yZV9uYXZpZ2F0ZSh7IHVybCwgdHlwZSwgZGVsdGE6IHBvcHBlZD8uZGVsdGEsIGludGVudCB9KTtcblxuXHRpZiAoIW5hdikge1xuXHRcdGJsb2NrKCk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Ly8gc3RvcmUgdGhpcyBiZWZvcmUgY2FsbGluZyBgYWNjZXB0KClgLCB3aGljaCBtYXkgY2hhbmdlIHRoZSBpbmRleFxuXHRjb25zdCBwcmV2aW91c19oaXN0b3J5X2luZGV4ID0gY3VycmVudF9oaXN0b3J5X2luZGV4O1xuXHRjb25zdCBwcmV2aW91c19uYXZpZ2F0aW9uX2luZGV4ID0gY3VycmVudF9uYXZpZ2F0aW9uX2luZGV4O1xuXG5cdGFjY2VwdCgpO1xuXG5cdG5hdmlnYXRpbmcgPSB0cnVlO1xuXG5cdGlmIChzdGFydGVkKSB7XG5cdFx0c3RvcmVzLm5hdmlnYXRpbmcuc2V0KG5hdi5uYXZpZ2F0aW9uKTtcblx0fVxuXG5cdHRva2VuID0gbmF2X3Rva2VuO1xuXHRsZXQgbmF2aWdhdGlvbl9yZXN1bHQgPSBpbnRlbnQgJiYgKGF3YWl0IGxvYWRfcm91dGUoaW50ZW50KSk7XG5cblx0aWYgKCFuYXZpZ2F0aW9uX3Jlc3VsdCkge1xuXHRcdGlmIChpc19leHRlcm5hbF91cmwodXJsLCBiYXNlKSkge1xuXHRcdFx0cmV0dXJuIGF3YWl0IG5hdGl2ZV9uYXZpZ2F0aW9uKHVybCk7XG5cdFx0fVxuXHRcdG5hdmlnYXRpb25fcmVzdWx0ID0gYXdhaXQgc2VydmVyX2ZhbGxiYWNrKFxuXHRcdFx0dXJsLFxuXHRcdFx0eyBpZDogbnVsbCB9LFxuXHRcdFx0YXdhaXQgaGFuZGxlX2Vycm9yKG5ldyBTdmVsdGVLaXRFcnJvcig0MDQsICdOb3QgRm91bmQnLCBgTm90IGZvdW5kOiAke3VybC5wYXRobmFtZX1gKSwge1xuXHRcdFx0XHR1cmwsXG5cdFx0XHRcdHBhcmFtczoge30sXG5cdFx0XHRcdHJvdXRlOiB7IGlkOiBudWxsIH1cblx0XHRcdH0pLFxuXHRcdFx0NDA0XG5cdFx0KTtcblx0fVxuXG5cdC8vIGlmIHRoaXMgaXMgYW4gaW50ZXJuYWwgbmF2aWdhdGlvbiBpbnRlbnQsIHVzZSB0aGUgbm9ybWFsaXplZFxuXHQvLyBVUkwgZm9yIHRoZSByZXN0IG9mIHRoZSBmdW5jdGlvblxuXHR1cmwgPSBpbnRlbnQ/LnVybCB8fCB1cmw7XG5cblx0Ly8gYWJvcnQgaWYgdXNlciBuYXZpZ2F0ZWQgZHVyaW5nIHVwZGF0ZVxuXHRpZiAodG9rZW4gIT09IG5hdl90b2tlbikge1xuXHRcdG5hdi5yZWplY3QobmV3IEVycm9yKCduYXZpZ2F0aW9uIGFib3J0ZWQnKSk7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0aWYgKG5hdmlnYXRpb25fcmVzdWx0LnR5cGUgPT09ICdyZWRpcmVjdCcpIHtcblx0XHQvLyB3aGF0d2cgZmV0Y2ggc3BlYyBodHRwczovL2ZldGNoLnNwZWMud2hhdHdnLm9yZy8jaHR0cC1yZWRpcmVjdC1mZXRjaCBzYXlzIHRvIGVycm9yIGFmdGVyIDIwIHJlZGlyZWN0c1xuXHRcdGlmIChyZWRpcmVjdF9jb3VudCA+PSAyMCkge1xuXHRcdFx0bmF2aWdhdGlvbl9yZXN1bHQgPSBhd2FpdCBsb2FkX3Jvb3RfZXJyb3JfcGFnZSh7XG5cdFx0XHRcdHN0YXR1czogNTAwLFxuXHRcdFx0XHRlcnJvcjogYXdhaXQgaGFuZGxlX2Vycm9yKG5ldyBFcnJvcignUmVkaXJlY3QgbG9vcCcpLCB7XG5cdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdHBhcmFtczoge30sXG5cdFx0XHRcdFx0cm91dGU6IHsgaWQ6IG51bGwgfVxuXHRcdFx0XHR9KSxcblx0XHRcdFx0dXJsLFxuXHRcdFx0XHRyb3V0ZTogeyBpZDogbnVsbCB9XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X2dvdG8obmV3IFVSTChuYXZpZ2F0aW9uX3Jlc3VsdC5sb2NhdGlvbiwgdXJsKS5ocmVmLCB7fSwgcmVkaXJlY3RfY291bnQgKyAxLCBuYXZfdG9rZW4pO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fSBlbHNlIGlmICgvKiogQHR5cGUge251bWJlcn0gKi8gKG5hdmlnYXRpb25fcmVzdWx0LnByb3BzLnBhZ2Uuc3RhdHVzKSA+PSA0MDApIHtcblx0XHRjb25zdCB1cGRhdGVkID0gYXdhaXQgc3RvcmVzLnVwZGF0ZWQuY2hlY2soKTtcblx0XHRpZiAodXBkYXRlZCkge1xuXHRcdFx0YXdhaXQgbmF0aXZlX25hdmlnYXRpb24odXJsKTtcblx0XHR9XG5cdH1cblxuXHQvLyByZXNldCBpbnZhbGlkYXRpb24gb25seSBhZnRlciBhIGZpbmlzaGVkIG5hdmlnYXRpb24uIElmIHRoZXJlIGFyZSByZWRpcmVjdHMgb3Jcblx0Ly8gYWRkaXRpb25hbCBpbnZhbGlkYXRpb25zLCB0aGV5IHNob3VsZCBnZXQgdGhlIHNhbWUgaW52YWxpZGF0aW9uIHRyZWF0bWVudFxuXHRyZXNldF9pbnZhbGlkYXRpb24oKTtcblxuXHR1cGRhdGluZyA9IHRydWU7XG5cblx0dXBkYXRlX3Njcm9sbF9wb3NpdGlvbnMocHJldmlvdXNfaGlzdG9yeV9pbmRleCk7XG5cdGNhcHR1cmVfc25hcHNob3QocHJldmlvdXNfbmF2aWdhdGlvbl9pbmRleCk7XG5cblx0Ly8gZW5zdXJlIHRoZSB1cmwgcGF0aG5hbWUgbWF0Y2hlcyB0aGUgcGFnZSdzIHRyYWlsaW5nIHNsYXNoIG9wdGlvblxuXHRpZiAobmF2aWdhdGlvbl9yZXN1bHQucHJvcHMucGFnZS51cmwucGF0aG5hbWUgIT09IHVybC5wYXRobmFtZSkge1xuXHRcdHVybC5wYXRobmFtZSA9IG5hdmlnYXRpb25fcmVzdWx0LnByb3BzLnBhZ2UudXJsLnBhdGhuYW1lO1xuXHR9XG5cblx0c3RhdGUgPSBwb3BwZWQgPyBwb3BwZWQuc3RhdGUgOiBzdGF0ZTtcblxuXHRpZiAoIXBvcHBlZCkge1xuXHRcdC8vIHRoaXMgaXMgYSBuZXcgbmF2aWdhdGlvbiwgcmF0aGVyIHRoYW4gYSBwb3BzdGF0ZVxuXHRcdGNvbnN0IGNoYW5nZSA9IHJlcGxhY2Vfc3RhdGUgPyAwIDogMTtcblxuXHRcdGNvbnN0IGVudHJ5ID0ge1xuXHRcdFx0W0hJU1RPUllfSU5ERVhdOiAoY3VycmVudF9oaXN0b3J5X2luZGV4ICs9IGNoYW5nZSksXG5cdFx0XHRbTkFWSUdBVElPTl9JTkRFWF06IChjdXJyZW50X25hdmlnYXRpb25faW5kZXggKz0gY2hhbmdlKSxcblx0XHRcdFtTVEFURVNfS0VZXTogc3RhdGVcblx0XHR9O1xuXG5cdFx0Y29uc3QgZm4gPSByZXBsYWNlX3N0YXRlID8gaGlzdG9yeS5yZXBsYWNlU3RhdGUgOiBoaXN0b3J5LnB1c2hTdGF0ZTtcblx0XHRmbi5jYWxsKGhpc3RvcnksIGVudHJ5LCAnJywgdXJsKTtcblxuXHRcdGlmICghcmVwbGFjZV9zdGF0ZSkge1xuXHRcdFx0Y2xlYXJfb253YXJkX2hpc3RvcnkoY3VycmVudF9oaXN0b3J5X2luZGV4LCBjdXJyZW50X25hdmlnYXRpb25faW5kZXgpO1xuXHRcdH1cblx0fVxuXG5cdC8vIHJlc2V0IHByZWxvYWQgc3luY2hyb25vdXNseSBhZnRlciB0aGUgaGlzdG9yeSBzdGF0ZSBoYXMgYmVlbiBzZXQgdG8gYXZvaWQgcmFjZSBjb25kaXRpb25zXG5cdGxvYWRfY2FjaGUgPSBudWxsO1xuXG5cdG5hdmlnYXRpb25fcmVzdWx0LnByb3BzLnBhZ2Uuc3RhdGUgPSBzdGF0ZTtcblxuXHRpZiAoc3RhcnRlZCkge1xuXHRcdGN1cnJlbnQgPSBuYXZpZ2F0aW9uX3Jlc3VsdC5zdGF0ZTtcblxuXHRcdC8vIHJlc2V0IHVybCBiZWZvcmUgdXBkYXRpbmcgcGFnZSBzdG9yZVxuXHRcdGlmIChuYXZpZ2F0aW9uX3Jlc3VsdC5wcm9wcy5wYWdlKSB7XG5cdFx0XHRuYXZpZ2F0aW9uX3Jlc3VsdC5wcm9wcy5wYWdlLnVybCA9IHVybDtcblx0XHR9XG5cblx0XHRjb25zdCBhZnRlcl9uYXZpZ2F0ZSA9IChcblx0XHRcdGF3YWl0IFByb21pc2UuYWxsKFxuXHRcdFx0XHRvbl9uYXZpZ2F0ZV9jYWxsYmFja3MubWFwKChmbikgPT5cblx0XHRcdFx0XHRmbigvKiogQHR5cGUge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLk9uTmF2aWdhdGV9ICovIChuYXYubmF2aWdhdGlvbikpXG5cdFx0XHRcdClcblx0XHRcdClcblx0XHQpLmZpbHRlcigvKiogQHJldHVybnMge3ZhbHVlIGlzICgpID0+IHZvaWR9ICovICh2YWx1ZSkgPT4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKTtcblxuXHRcdGlmIChhZnRlcl9uYXZpZ2F0ZS5sZW5ndGggPiAwKSB7XG5cdFx0XHRmdW5jdGlvbiBjbGVhbnVwKCkge1xuXHRcdFx0XHRhZnRlcl9uYXZpZ2F0ZV9jYWxsYmFja3MgPSBhZnRlcl9uYXZpZ2F0ZV9jYWxsYmFja3MuZmlsdGVyKFxuXHRcdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0XHQoZm4pID0+ICFhZnRlcl9uYXZpZ2F0ZS5pbmNsdWRlcyhmbilcblx0XHRcdFx0KTtcblx0XHRcdH1cblxuXHRcdFx0YWZ0ZXJfbmF2aWdhdGUucHVzaChjbGVhbnVwKTtcblx0XHRcdGFmdGVyX25hdmlnYXRlX2NhbGxiYWNrcy5wdXNoKC4uLmFmdGVyX25hdmlnYXRlKTtcblx0XHR9XG5cblx0XHRyb290LiRzZXQobmF2aWdhdGlvbl9yZXN1bHQucHJvcHMpO1xuXHRcdGhhc19uYXZpZ2F0ZWQgPSB0cnVlO1xuXHR9IGVsc2Uge1xuXHRcdGluaXRpYWxpemUobmF2aWdhdGlvbl9yZXN1bHQsIHRhcmdldCk7XG5cdH1cblxuXHRjb25zdCB7IGFjdGl2ZUVsZW1lbnQgfSA9IGRvY3VtZW50O1xuXG5cdC8vIG5lZWQgdG8gcmVuZGVyIHRoZSBET00gYmVmb3JlIHdlIGNhbiBzY3JvbGwgdG8gdGhlIHJlbmRlcmVkIGVsZW1lbnRzIGFuZCBkbyBmb2N1cyBtYW5hZ2VtZW50XG5cdGF3YWl0IHRpY2soKTtcblxuXHQvLyB3ZSByZXNldCBzY3JvbGwgYmVmb3JlIGRlYWxpbmcgd2l0aCBmb2N1cywgdG8gYXZvaWQgYSBmbGFzaCBvZiB1bnNjcm9sbGVkIGNvbnRlbnRcblx0Y29uc3Qgc2Nyb2xsID0gcG9wcGVkID8gcG9wcGVkLnNjcm9sbCA6IG5vc2Nyb2xsID8gc2Nyb2xsX3N0YXRlKCkgOiBudWxsO1xuXG5cdGlmIChhdXRvc2Nyb2xsKSB7XG5cdFx0Y29uc3QgZGVlcF9saW5rZWQgPSB1cmwuaGFzaCAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkZWNvZGVVUklDb21wb25lbnQodXJsLmhhc2guc2xpY2UoMSkpKTtcblx0XHRpZiAoc2Nyb2xsKSB7XG5cdFx0XHRzY3JvbGxUbyhzY3JvbGwueCwgc2Nyb2xsLnkpO1xuXHRcdH0gZWxzZSBpZiAoZGVlcF9saW5rZWQpIHtcblx0XHRcdC8vIEhlcmUgd2UgdXNlIGBzY3JvbGxJbnRvVmlld2Agb24gdGhlIGVsZW1lbnQgaW5zdGVhZCBvZiBgc2Nyb2xsVG9gXG5cdFx0XHQvLyBiZWNhdXNlIGl0IG5hdGl2ZWx5IHN1cHBvcnRzIHRoZSBgc2Nyb2xsLW1hcmdpbmAgYW5kIGBzY3JvbGwtYmVoYXZpb3JgXG5cdFx0XHQvLyBDU1MgcHJvcGVydGllcy5cblx0XHRcdGRlZXBfbGlua2VkLnNjcm9sbEludG9WaWV3KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNjcm9sbFRvKDAsIDApO1xuXHRcdH1cblx0fVxuXG5cdGNvbnN0IGNoYW5nZWRfZm9jdXMgPVxuXHRcdC8vIHJlc2V0IGZvY3VzIG9ubHkgaWYgYW55IG1hbnVhbCBmb2N1cyBtYW5hZ2VtZW50IGRpZG4ndCBvdmVycmlkZSBpdFxuXHRcdGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IGFjdGl2ZUVsZW1lbnQgJiZcblx0XHQvLyBhbHNvIHJlZm9jdXMgd2hlbiBhY3RpdmVFbGVtZW50IGlzIGJvZHkgYWxyZWFkeSBiZWNhdXNlIHRoZVxuXHRcdC8vIGZvY3VzIGV2ZW50IG1pZ2h0IG5vdCBoYXZlIGJlZW4gZmlyZWQgb24gaXQgeWV0XG5cdFx0ZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gZG9jdW1lbnQuYm9keTtcblxuXHRpZiAoIWtlZXBmb2N1cyAmJiAhY2hhbmdlZF9mb2N1cykge1xuXHRcdHJlc2V0X2ZvY3VzKCk7XG5cdH1cblxuXHRhdXRvc2Nyb2xsID0gdHJ1ZTtcblxuXHRpZiAobmF2aWdhdGlvbl9yZXN1bHQucHJvcHMucGFnZSkge1xuXHRcdHBhZ2UgPSBuYXZpZ2F0aW9uX3Jlc3VsdC5wcm9wcy5wYWdlO1xuXHR9XG5cblx0bmF2aWdhdGluZyA9IGZhbHNlO1xuXG5cdGlmICh0eXBlID09PSAncG9wc3RhdGUnKSB7XG5cdFx0cmVzdG9yZV9zbmFwc2hvdChjdXJyZW50X25hdmlnYXRpb25faW5kZXgpO1xuXHR9XG5cblx0bmF2LmZ1bGZpbCh1bmRlZmluZWQpO1xuXG5cdGFmdGVyX25hdmlnYXRlX2NhbGxiYWNrcy5mb3JFYWNoKChmbikgPT5cblx0XHRmbigvKiogQHR5cGUge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLkFmdGVyTmF2aWdhdGV9ICovIChuYXYubmF2aWdhdGlvbikpXG5cdCk7XG5cblx0c3RvcmVzLm5hdmlnYXRpbmcuc2V0KG51bGwpO1xuXG5cdHVwZGF0aW5nID0gZmFsc2U7XG59XG5cbi8qKlxuICogRG9lcyBhIGZ1bGwgcGFnZSByZWxvYWQgaWYgaXQgd291bGRuJ3QgcmVzdWx0IGluIGFuIGVuZGxlc3MgbG9vcCBpbiB0aGUgU1BBIGNhc2VcbiAqIEBwYXJhbSB7VVJMfSB1cmxcbiAqIEBwYXJhbSB7eyBpZDogc3RyaW5nIHwgbnVsbCB9fSByb3V0ZVxuICogQHBhcmFtIHtBcHAuRXJyb3J9IGVycm9yXG4gKiBAcGFyYW0ge251bWJlcn0gc3RhdHVzXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxpbXBvcnQoJy4vdHlwZXMuanMnKS5OYXZpZ2F0aW9uRmluaXNoZWQ+fVxuICovXG5hc3luYyBmdW5jdGlvbiBzZXJ2ZXJfZmFsbGJhY2sodXJsLCByb3V0ZSwgZXJyb3IsIHN0YXR1cykge1xuXHRpZiAodXJsLm9yaWdpbiA9PT0gb3JpZ2luICYmIHVybC5wYXRobmFtZSA9PT0gbG9jYXRpb24ucGF0aG5hbWUgJiYgIWh5ZHJhdGVkKSB7XG5cdFx0Ly8gV2Ugd291bGQgcmVsb2FkIHRoZSBzYW1lIHBhZ2Ugd2UncmUgY3VycmVudGx5IG9uLCB3aGljaCBpc24ndCBoeWRyYXRlZCxcblx0XHQvLyB3aGljaCBtZWFucyBubyBTU1IsIHdoaWNoIG1lYW5zIHdlIHdvdWxkIGVuZCB1cCBpbiBhbiBlbmRsZXNzIGxvb3Bcblx0XHRyZXR1cm4gYXdhaXQgbG9hZF9yb290X2Vycm9yX3BhZ2Uoe1xuXHRcdFx0c3RhdHVzLFxuXHRcdFx0ZXJyb3IsXG5cdFx0XHR1cmwsXG5cdFx0XHRyb3V0ZVxuXHRcdH0pO1xuXHR9XG5cblx0aWYgKERFViAmJiBzdGF0dXMgIT09IDQwNCkge1xuXHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHQnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgbG9hZGluZyB0aGUgcGFnZS4gVGhpcyB3aWxsIGNhdXNlIGEgZnVsbCBwYWdlIHJlbG9hZC4gKFRoaXMgbWVzc2FnZSB3aWxsIG9ubHkgYXBwZWFyIGR1cmluZyBkZXZlbG9wbWVudC4pJ1xuXHRcdCk7XG5cblx0XHRkZWJ1Z2dlcjsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXHR9XG5cblx0cmV0dXJuIGF3YWl0IG5hdGl2ZV9uYXZpZ2F0aW9uKHVybCk7XG59XG5cbmlmIChpbXBvcnQubWV0YS5ob3QpIHtcblx0aW1wb3J0Lm1ldGEuaG90Lm9uKCd2aXRlOmJlZm9yZVVwZGF0ZScsICgpID0+IHtcblx0XHRpZiAoY3VycmVudC5lcnJvcikgbG9jYXRpb24ucmVsb2FkKCk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBzZXR1cF9wcmVsb2FkKCkge1xuXHQvKiogQHR5cGUge05vZGVKUy5UaW1lb3V0fSAqL1xuXHRsZXQgbW91c2Vtb3ZlX3RpbWVvdXQ7XG5cblx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIChldmVudCkgPT4ge1xuXHRcdGNvbnN0IHRhcmdldCA9IC8qKiBAdHlwZSB7RWxlbWVudH0gKi8gKGV2ZW50LnRhcmdldCk7XG5cblx0XHRjbGVhclRpbWVvdXQobW91c2Vtb3ZlX3RpbWVvdXQpO1xuXHRcdG1vdXNlbW92ZV90aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRwcmVsb2FkKHRhcmdldCwgMik7XG5cdFx0fSwgMjApO1xuXHR9KTtcblxuXHQvKiogQHBhcmFtIHtFdmVudH0gZXZlbnQgKi9cblx0ZnVuY3Rpb24gdGFwKGV2ZW50KSB7XG5cdFx0cHJlbG9hZCgvKiogQHR5cGUge0VsZW1lbnR9ICovIChldmVudC5jb21wb3NlZFBhdGgoKVswXSksIDEpO1xuXHR9XG5cblx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRhcCk7XG5cdGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGFwLCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cblx0Y29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXG5cdFx0KGVudHJpZXMpID0+IHtcblx0XHRcdGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuXHRcdFx0XHRpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcblx0XHRcdFx0XHRfcHJlbG9hZF9jb2RlKC8qKiBAdHlwZSB7SFRNTEFuY2hvckVsZW1lbnR9ICovIChlbnRyeS50YXJnZXQpLmhyZWYpO1xuXHRcdFx0XHRcdG9ic2VydmVyLnVub2JzZXJ2ZShlbnRyeS50YXJnZXQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblx0XHR7IHRocmVzaG9sZDogMCB9XG5cdCk7XG5cblx0LyoqXG5cdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudFxuXHQgKiBAcGFyYW0ge251bWJlcn0gcHJpb3JpdHlcblx0ICovXG5cdGZ1bmN0aW9uIHByZWxvYWQoZWxlbWVudCwgcHJpb3JpdHkpIHtcblx0XHRjb25zdCBhID0gZmluZF9hbmNob3IoZWxlbWVudCwgY29udGFpbmVyKTtcblx0XHRpZiAoIWEpIHJldHVybjtcblxuXHRcdGNvbnN0IHsgdXJsLCBleHRlcm5hbCwgZG93bmxvYWQgfSA9IGdldF9saW5rX2luZm8oYSwgYmFzZSk7XG5cdFx0aWYgKGV4dGVybmFsIHx8IGRvd25sb2FkKSByZXR1cm47XG5cblx0XHRjb25zdCBvcHRpb25zID0gZ2V0X3JvdXRlcl9vcHRpb25zKGEpO1xuXG5cdFx0aWYgKCFvcHRpb25zLnJlbG9hZCkge1xuXHRcdFx0aWYgKHByaW9yaXR5IDw9IG9wdGlvbnMucHJlbG9hZF9kYXRhKSB7XG5cdFx0XHRcdGNvbnN0IGludGVudCA9IGdldF9uYXZpZ2F0aW9uX2ludGVudCh1cmwsIGZhbHNlKTtcblx0XHRcdFx0aWYgKGludGVudCkge1xuXHRcdFx0XHRcdGlmIChERVYpIHtcblx0XHRcdFx0XHRcdF9wcmVsb2FkX2RhdGEoaW50ZW50KS50aGVuKChyZXN1bHQpID0+IHtcblx0XHRcdFx0XHRcdFx0aWYgKHJlc3VsdC50eXBlID09PSAnbG9hZGVkJyAmJiByZXN1bHQuc3RhdGUuZXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXG5cdFx0XHRcdFx0XHRcdFx0XHRgUHJlbG9hZGluZyBkYXRhIGZvciAke2ludGVudC51cmwucGF0aG5hbWV9IGZhaWxlZCB3aXRoIHRoZSBmb2xsb3dpbmcgZXJyb3I6ICR7cmVzdWx0LnN0YXRlLmVycm9yLm1lc3NhZ2V9XFxuYCArXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCdJZiB0aGlzIGVycm9yIGlzIHRyYW5zaWVudCwgeW91IGNhbiBpZ25vcmUgaXQuIE90aGVyd2lzZSwgY29uc2lkZXIgZGlzYWJsaW5nIHByZWxvYWRpbmcgZm9yIHRoaXMgcm91dGUuICcgK1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQnVGhpcyByb3V0ZSB3YXMgcHJlbG9hZGVkIGR1ZSB0byBhIGRhdGEtc3ZlbHRla2l0LXByZWxvYWQtZGF0YSBhdHRyaWJ1dGUuICcgK1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQnU2VlIGh0dHBzOi8va2l0LnN2ZWx0ZS5kZXYvZG9jcy9saW5rLW9wdGlvbnMgZm9yIG1vcmUgaW5mbydcblx0XHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0X3ByZWxvYWRfZGF0YShpbnRlbnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChwcmlvcml0eSA8PSBvcHRpb25zLnByZWxvYWRfY29kZSkge1xuXHRcdFx0XHRfcHJlbG9hZF9jb2RlKC8qKiBAdHlwZSB7VVJMfSAqLyAodXJsKS5wYXRobmFtZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gYWZ0ZXJfbmF2aWdhdGUoKSB7XG5cdFx0b2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuXG5cdFx0Zm9yIChjb25zdCBhIG9mIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhJykpIHtcblx0XHRcdGNvbnN0IHsgdXJsLCBleHRlcm5hbCwgZG93bmxvYWQgfSA9IGdldF9saW5rX2luZm8oYSwgYmFzZSk7XG5cdFx0XHRpZiAoZXh0ZXJuYWwgfHwgZG93bmxvYWQpIGNvbnRpbnVlO1xuXG5cdFx0XHRjb25zdCBvcHRpb25zID0gZ2V0X3JvdXRlcl9vcHRpb25zKGEpO1xuXHRcdFx0aWYgKG9wdGlvbnMucmVsb2FkKSBjb250aW51ZTtcblxuXHRcdFx0aWYgKG9wdGlvbnMucHJlbG9hZF9jb2RlID09PSBQUkVMT0FEX1BSSU9SSVRJRVMudmlld3BvcnQpIHtcblx0XHRcdFx0b2JzZXJ2ZXIub2JzZXJ2ZShhKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG9wdGlvbnMucHJlbG9hZF9jb2RlID09PSBQUkVMT0FEX1BSSU9SSVRJRVMuZWFnZXIpIHtcblx0XHRcdFx0X3ByZWxvYWRfY29kZSgvKiogQHR5cGUge1VSTH0gKi8gKHVybCkucGF0aG5hbWUpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGFmdGVyX25hdmlnYXRlX2NhbGxiYWNrcy5wdXNoKGFmdGVyX25hdmlnYXRlKTtcblx0YWZ0ZXJfbmF2aWdhdGUoKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge3Vua25vd259IGVycm9yXG4gKiBAcGFyYW0ge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLk5hdmlnYXRpb25FdmVudH0gZXZlbnRcbiAqIEByZXR1cm5zIHtpbXBvcnQoJ3R5cGVzJykuTWF5YmVQcm9taXNlPEFwcC5FcnJvcj59XG4gKi9cbmZ1bmN0aW9uIGhhbmRsZV9lcnJvcihlcnJvciwgZXZlbnQpIHtcblx0aWYgKGVycm9yIGluc3RhbmNlb2YgSHR0cEVycm9yKSB7XG5cdFx0cmV0dXJuIGVycm9yLmJvZHk7XG5cdH1cblxuXHRpZiAoREVWKSB7XG5cdFx0ZXJyb3JlZCA9IHRydWU7XG5cdFx0Y29uc29sZS53YXJuKCdUaGUgbmV4dCBITVIgdXBkYXRlIHdpbGwgY2F1c2UgdGhlIHBhZ2UgdG8gcmVsb2FkJyk7XG5cdH1cblxuXHRjb25zdCBzdGF0dXMgPSBnZXRfc3RhdHVzKGVycm9yKTtcblx0Y29uc3QgbWVzc2FnZSA9IGdldF9tZXNzYWdlKGVycm9yKTtcblxuXHRyZXR1cm4gKFxuXHRcdGFwcC5ob29rcy5oYW5kbGVFcnJvcih7IGVycm9yLCBldmVudCwgc3RhdHVzLCBtZXNzYWdlIH0pID8/IC8qKiBAdHlwZSB7YW55fSAqLyAoeyBtZXNzYWdlIH0pXG5cdCk7XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIHtGdW5jdGlvbn0gVFxuICogQHBhcmFtIHtUW119IGNhbGxiYWNrc1xuICogQHBhcmFtIHtUfSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiBhZGRfbmF2aWdhdGlvbl9jYWxsYmFjayhjYWxsYmFja3MsIGNhbGxiYWNrKSB7XG5cdG9uTW91bnQoKCkgPT4ge1xuXHRcdGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcblxuXHRcdHJldHVybiAoKSA9PiB7XG5cdFx0XHRjb25zdCBpID0gY2FsbGJhY2tzLmluZGV4T2YoY2FsbGJhY2spO1xuXHRcdFx0Y2FsbGJhY2tzLnNwbGljZShpLCAxKTtcblx0XHR9O1xuXHR9KTtcbn1cblxuLyoqXG4gKiBBIGxpZmVjeWNsZSBmdW5jdGlvbiB0aGF0IHJ1bnMgdGhlIHN1cHBsaWVkIGBjYWxsYmFja2Agd2hlbiB0aGUgY3VycmVudCBjb21wb25lbnQgbW91bnRzLCBhbmQgYWxzbyB3aGVuZXZlciB3ZSBuYXZpZ2F0ZSB0byBhIG5ldyBVUkwuXG4gKlxuICogYGFmdGVyTmF2aWdhdGVgIG11c3QgYmUgY2FsbGVkIGR1cmluZyBhIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbi4gSXQgcmVtYWlucyBhY3RpdmUgYXMgbG9uZyBhcyB0aGUgY29tcG9uZW50IGlzIG1vdW50ZWQuXG4gKiBAcGFyYW0geyhuYXZpZ2F0aW9uOiBpbXBvcnQoJ0BzdmVsdGVqcy9raXQnKS5BZnRlck5hdmlnYXRlKSA9PiB2b2lkfSBjYWxsYmFja1xuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZnRlck5hdmlnYXRlKGNhbGxiYWNrKSB7XG5cdGFkZF9uYXZpZ2F0aW9uX2NhbGxiYWNrKGFmdGVyX25hdmlnYXRlX2NhbGxiYWNrcywgY2FsbGJhY2spO1xufVxuXG4vKipcbiAqIEEgbmF2aWdhdGlvbiBpbnRlcmNlcHRvciB0aGF0IHRyaWdnZXJzIGJlZm9yZSB3ZSBuYXZpZ2F0ZSB0byBhIG5ldyBVUkwsIHdoZXRoZXIgYnkgY2xpY2tpbmcgYSBsaW5rLCBjYWxsaW5nIGBnb3RvKC4uLilgLCBvciB1c2luZyB0aGUgYnJvd3NlciBiYWNrL2ZvcndhcmQgY29udHJvbHMuXG4gKlxuICogQ2FsbGluZyBgY2FuY2VsKClgIHdpbGwgcHJldmVudCB0aGUgbmF2aWdhdGlvbiBmcm9tIGNvbXBsZXRpbmcuIElmIGBuYXZpZ2F0aW9uLnR5cGUgPT09ICdsZWF2ZSdgIOKAlCBtZWFuaW5nIHRoZSB1c2VyIGlzIG5hdmlnYXRpbmcgYXdheSBmcm9tIHRoZSBhcHAgKG9yIGNsb3NpbmcgdGhlIHRhYikg4oCUIGNhbGxpbmcgYGNhbmNlbGAgd2lsbCB0cmlnZ2VyIHRoZSBuYXRpdmUgYnJvd3NlciB1bmxvYWQgY29uZmlybWF0aW9uIGRpYWxvZy4gSW4gdGhpcyBjYXNlLCB0aGUgbmF2aWdhdGlvbiBtYXkgb3IgbWF5IG5vdCBiZSBjYW5jZWxsZWQgZGVwZW5kaW5nIG9uIHRoZSB1c2VyJ3MgcmVzcG9uc2UuXG4gKlxuICogV2hlbiBhIG5hdmlnYXRpb24gaXNuJ3QgdG8gYSBTdmVsdGVLaXQtb3duZWQgcm91dGUgKGFuZCB0aGVyZWZvcmUgY29udHJvbGxlZCBieSBTdmVsdGVLaXQncyBjbGllbnQtc2lkZSByb3V0ZXIpLCBgbmF2aWdhdGlvbi50by5yb3V0ZS5pZGAgd2lsbCBiZSBgbnVsbGAuXG4gKlxuICogSWYgdGhlIG5hdmlnYXRpb24gd2lsbCAoaWYgbm90IGNhbmNlbGxlZCkgY2F1c2UgdGhlIGRvY3VtZW50IHRvIHVubG9hZCDigJQgaW4gb3RoZXIgd29yZHMgYCdsZWF2ZSdgIG5hdmlnYXRpb25zIGFuZCBgJ2xpbmsnYCBuYXZpZ2F0aW9ucyB3aGVyZSBgbmF2aWdhdGlvbi50by5yb3V0ZSA9PT0gbnVsbGAg4oCUIGBuYXZpZ2F0aW9uLndpbGxVbmxvYWRgIGlzIGB0cnVlYC5cbiAqXG4gKiBgYmVmb3JlTmF2aWdhdGVgIG11c3QgYmUgY2FsbGVkIGR1cmluZyBhIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbi4gSXQgcmVtYWlucyBhY3RpdmUgYXMgbG9uZyBhcyB0aGUgY29tcG9uZW50IGlzIG1vdW50ZWQuXG4gKiBAcGFyYW0geyhuYXZpZ2F0aW9uOiBpbXBvcnQoJ0BzdmVsdGVqcy9raXQnKS5CZWZvcmVOYXZpZ2F0ZSkgPT4gdm9pZH0gY2FsbGJhY2tcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gYmVmb3JlTmF2aWdhdGUoY2FsbGJhY2spIHtcblx0YWRkX25hdmlnYXRpb25fY2FsbGJhY2soYmVmb3JlX25hdmlnYXRlX2NhbGxiYWNrcywgY2FsbGJhY2spO1xufVxuXG4vKipcbiAqIEEgbGlmZWN5Y2xlIGZ1bmN0aW9uIHRoYXQgcnVucyB0aGUgc3VwcGxpZWQgYGNhbGxiYWNrYCBpbW1lZGlhdGVseSBiZWZvcmUgd2UgbmF2aWdhdGUgdG8gYSBuZXcgVVJMIGV4Y2VwdCBkdXJpbmcgZnVsbC1wYWdlIG5hdmlnYXRpb25zLlxuICpcbiAqIElmIHlvdSByZXR1cm4gYSBgUHJvbWlzZWAsIFN2ZWx0ZUtpdCB3aWxsIHdhaXQgZm9yIGl0IHRvIHJlc29sdmUgYmVmb3JlIGNvbXBsZXRpbmcgdGhlIG5hdmlnYXRpb24uIFRoaXMgYWxsb3dzIHlvdSB0byDigJQgZm9yIGV4YW1wbGUg4oCUIHVzZSBgZG9jdW1lbnQuc3RhcnRWaWV3VHJhbnNpdGlvbmAuIEF2b2lkIHByb21pc2VzIHRoYXQgYXJlIHNsb3cgdG8gcmVzb2x2ZSwgc2luY2UgbmF2aWdhdGlvbiB3aWxsIGFwcGVhciBzdGFsbGVkIHRvIHRoZSB1c2VyLlxuICpcbiAqIElmIGEgZnVuY3Rpb24gKG9yIGEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgdG8gYSBmdW5jdGlvbikgaXMgcmV0dXJuZWQgZnJvbSB0aGUgY2FsbGJhY2ssIGl0IHdpbGwgYmUgY2FsbGVkIG9uY2UgdGhlIERPTSBoYXMgdXBkYXRlZC5cbiAqXG4gKiBgb25OYXZpZ2F0ZWAgbXVzdCBiZSBjYWxsZWQgZHVyaW5nIGEgY29tcG9uZW50IGluaXRpYWxpemF0aW9uLiBJdCByZW1haW5zIGFjdGl2ZSBhcyBsb25nIGFzIHRoZSBjb21wb25lbnQgaXMgbW91bnRlZC5cbiAqIEBwYXJhbSB7KG5hdmlnYXRpb246IGltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLk9uTmF2aWdhdGUpID0+IGltcG9ydCgndHlwZXMnKS5NYXliZVByb21pc2U8KCgpID0+IHZvaWQpIHwgdm9pZD59IGNhbGxiYWNrXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9uTmF2aWdhdGUoY2FsbGJhY2spIHtcblx0YWRkX25hdmlnYXRpb25fY2FsbGJhY2sob25fbmF2aWdhdGVfY2FsbGJhY2tzLCBjYWxsYmFjayk7XG59XG5cbi8qKlxuICogSWYgY2FsbGVkIHdoZW4gdGhlIHBhZ2UgaXMgYmVpbmcgdXBkYXRlZCBmb2xsb3dpbmcgYSBuYXZpZ2F0aW9uIChpbiBgb25Nb3VudGAgb3IgYGFmdGVyTmF2aWdhdGVgIG9yIGFuIGFjdGlvbiwgZm9yIGV4YW1wbGUpLCB0aGlzIGRpc2FibGVzIFN2ZWx0ZUtpdCdzIGJ1aWx0LWluIHNjcm9sbCBoYW5kbGluZy5cbiAqIFRoaXMgaXMgZ2VuZXJhbGx5IGRpc2NvdXJhZ2VkLCBzaW5jZSBpdCBicmVha3MgdXNlciBleHBlY3RhdGlvbnMuXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRpc2FibGVTY3JvbGxIYW5kbGluZygpIHtcblx0aWYgKCFCUk9XU0VSKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBkaXNhYmxlU2Nyb2xsSGFuZGxpbmcoKSBvbiB0aGUgc2VydmVyJyk7XG5cdH1cblxuXHRpZiAoREVWICYmIHN0YXJ0ZWQgJiYgIXVwZGF0aW5nKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW4gb25seSBkaXNhYmxlIHNjcm9sbCBoYW5kbGluZyBkdXJpbmcgbmF2aWdhdGlvbicpO1xuXHR9XG5cblx0aWYgKHVwZGF0aW5nIHx8ICFzdGFydGVkKSB7XG5cdFx0YXV0b3Njcm9sbCA9IGZhbHNlO1xuXHR9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIFN2ZWx0ZUtpdCBuYXZpZ2F0ZXMgKG9yIGZhaWxzIHRvIG5hdmlnYXRlLCBpbiB3aGljaCBjYXNlIHRoZSBwcm9taXNlIHJlamVjdHMpIHRvIHRoZSBzcGVjaWZpZWQgYHVybGAuXG4gKiBGb3IgZXh0ZXJuYWwgVVJMcywgdXNlIGB3aW5kb3cubG9jYXRpb24gPSB1cmxgIGluc3RlYWQgb2YgY2FsbGluZyBgZ290byh1cmwpYC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZyB8IFVSTH0gdXJsIFdoZXJlIHRvIG5hdmlnYXRlIHRvLiBOb3RlIHRoYXQgaWYgeW91J3ZlIHNldCBbYGNvbmZpZy5raXQucGF0aHMuYmFzZWBdKGh0dHBzOi8va2l0LnN2ZWx0ZS5kZXYvZG9jcy9jb25maWd1cmF0aW9uI3BhdGhzKSBhbmQgdGhlIFVSTCBpcyByb290LXJlbGF0aXZlLCB5b3UgbmVlZCB0byBwcmVwZW5kIHRoZSBiYXNlIHBhdGggaWYgeW91IHdhbnQgdG8gbmF2aWdhdGUgd2l0aGluIHRoZSBhcHAuXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdHNdIE9wdGlvbnMgcmVsYXRlZCB0byB0aGUgbmF2aWdhdGlvblxuICogQHBhcmFtIHtib29sZWFufSBbb3B0cy5yZXBsYWNlU3RhdGVdIElmIGB0cnVlYCwgd2lsbCByZXBsYWNlIHRoZSBjdXJyZW50IGBoaXN0b3J5YCBlbnRyeSByYXRoZXIgdGhhbiBjcmVhdGluZyBhIG5ldyBvbmUgd2l0aCBgcHVzaFN0YXRlYFxuICogQHBhcmFtIHtib29sZWFufSBbb3B0cy5ub1Njcm9sbF0gSWYgYHRydWVgLCB0aGUgYnJvd3NlciB3aWxsIG1haW50YWluIGl0cyBzY3JvbGwgcG9zaXRpb24gcmF0aGVyIHRoYW4gc2Nyb2xsaW5nIHRvIHRoZSB0b3Agb2YgdGhlIHBhZ2UgYWZ0ZXIgbmF2aWdhdGlvblxuICogQHBhcmFtIHtib29sZWFufSBbb3B0cy5rZWVwRm9jdXNdIElmIGB0cnVlYCwgdGhlIGN1cnJlbnRseSBmb2N1c2VkIGVsZW1lbnQgd2lsbCByZXRhaW4gZm9jdXMgYWZ0ZXIgbmF2aWdhdGlvbi4gT3RoZXJ3aXNlLCBmb2N1cyB3aWxsIGJlIHJlc2V0IHRvIHRoZSBib2R5XG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRzLmludmFsaWRhdGVBbGxdIElmIGB0cnVlYCwgYWxsIGBsb2FkYCBmdW5jdGlvbnMgb2YgdGhlIHBhZ2Ugd2lsbCBiZSByZXJ1bi4gU2VlIGh0dHBzOi8va2l0LnN2ZWx0ZS5kZXYvZG9jcy9sb2FkI3JlcnVubmluZy1sb2FkLWZ1bmN0aW9ucyBmb3IgbW9yZSBpbmZvIG9uIGludmFsaWRhdGlvbi5cbiAqIEBwYXJhbSB7QXBwLlBhZ2VTdGF0ZX0gW29wdHMuc3RhdGVdIEFuIG9wdGlvbmFsIG9iamVjdCB0aGF0IHdpbGwgYmUgYXZhaWxhYmxlIG9uIHRoZSBgJHBhZ2Uuc3RhdGVgIHN0b3JlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdvdG8odXJsLCBvcHRzID0ge30pIHtcblx0aWYgKCFCUk9XU0VSKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBnb3RvKC4uLikgb24gdGhlIHNlcnZlcicpO1xuXHR9XG5cblx0dXJsID0gcmVzb2x2ZV91cmwodXJsKTtcblxuXHRpZiAodXJsLm9yaWdpbiAhPT0gb3JpZ2luKSB7XG5cdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KFxuXHRcdFx0bmV3IEVycm9yKFxuXHRcdFx0XHRERVZcblx0XHRcdFx0XHQ/IGBDYW5ub3QgdXNlIFxcYGdvdG9cXGAgd2l0aCBhbiBleHRlcm5hbCBVUkwuIFVzZSBcXGB3aW5kb3cubG9jYXRpb24gPSBcIiR7dXJsfVwiXFxgIGluc3RlYWRgXG5cdFx0XHRcdFx0OiAnZ290bzogaW52YWxpZCBVUkwnXG5cdFx0XHQpXG5cdFx0KTtcblx0fVxuXG5cdHJldHVybiBfZ290byh1cmwsIG9wdHMsIDApO1xufVxuXG4vKipcbiAqIENhdXNlcyBhbnkgYGxvYWRgIGZ1bmN0aW9ucyBiZWxvbmdpbmcgdG8gdGhlIGN1cnJlbnRseSBhY3RpdmUgcGFnZSB0byByZS1ydW4gaWYgdGhleSBkZXBlbmQgb24gdGhlIGB1cmxgIGluIHF1ZXN0aW9uLCB2aWEgYGZldGNoYCBvciBgZGVwZW5kc2AuIFJldHVybnMgYSBgUHJvbWlzZWAgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBwYWdlIGlzIHN1YnNlcXVlbnRseSB1cGRhdGVkLlxuICpcbiAqIElmIHRoZSBhcmd1bWVudCBpcyBnaXZlbiBhcyBhIGBzdHJpbmdgIG9yIGBVUkxgLCBpdCBtdXN0IHJlc29sdmUgdG8gdGhlIHNhbWUgVVJMIHRoYXQgd2FzIHBhc3NlZCB0byBgZmV0Y2hgIG9yIGBkZXBlbmRzYCAoaW5jbHVkaW5nIHF1ZXJ5IHBhcmFtZXRlcnMpLlxuICogVG8gY3JlYXRlIGEgY3VzdG9tIGlkZW50aWZpZXIsIHVzZSBhIHN0cmluZyBiZWdpbm5pbmcgd2l0aCBgW2Etel0rOmAgKGUuZy4gYGN1c3RvbTpzdGF0ZWApIOKAlCB0aGlzIGlzIGEgdmFsaWQgVVJMLlxuICpcbiAqIFRoZSBgZnVuY3Rpb25gIGFyZ3VtZW50IGNhbiBiZSB1c2VkIGRlZmluZSBhIGN1c3RvbSBwcmVkaWNhdGUuIEl0IHJlY2VpdmVzIHRoZSBmdWxsIGBVUkxgIGFuZCBjYXVzZXMgYGxvYWRgIHRvIHJlcnVuIGlmIGB0cnVlYCBpcyByZXR1cm5lZC5cbiAqIFRoaXMgY2FuIGJlIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBpbnZhbGlkYXRlIGJhc2VkIG9uIGEgcGF0dGVybiBpbnN0ZWFkIG9mIGEgZXhhY3QgbWF0Y2guXG4gKlxuICogYGBgdHNcbiAqIC8vIEV4YW1wbGU6IE1hdGNoICcvcGF0aCcgcmVnYXJkbGVzcyBvZiB0aGUgcXVlcnkgcGFyYW1ldGVyc1xuICogaW1wb3J0IHsgaW52YWxpZGF0ZSB9IGZyb20gJyRhcHAvbmF2aWdhdGlvbic7XG4gKlxuICogaW52YWxpZGF0ZSgodXJsKSA9PiB1cmwucGF0aG5hbWUgPT09ICcvcGF0aCcpO1xuICogYGBgXG4gKiBAcGFyYW0ge3N0cmluZyB8IFVSTCB8ICgodXJsOiBVUkwpID0+IGJvb2xlYW4pfSByZXNvdXJjZSBUaGUgaW52YWxpZGF0ZWQgVVJMXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGludmFsaWRhdGUocmVzb3VyY2UpIHtcblx0aWYgKCFCUk9XU0VSKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBpbnZhbGlkYXRlKC4uLikgb24gdGhlIHNlcnZlcicpO1xuXHR9XG5cblx0aWYgKHR5cGVvZiByZXNvdXJjZSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdGludmFsaWRhdGVkLnB1c2gocmVzb3VyY2UpO1xuXHR9IGVsc2Uge1xuXHRcdGNvbnN0IHsgaHJlZiB9ID0gbmV3IFVSTChyZXNvdXJjZSwgbG9jYXRpb24uaHJlZik7XG5cdFx0aW52YWxpZGF0ZWQucHVzaCgodXJsKSA9PiB1cmwuaHJlZiA9PT0gaHJlZik7XG5cdH1cblxuXHRyZXR1cm4gX2ludmFsaWRhdGUoKTtcbn1cblxuLyoqXG4gKiBDYXVzZXMgYWxsIGBsb2FkYCBmdW5jdGlvbnMgYmVsb25naW5nIHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHBhZ2UgdG8gcmUtcnVuLiBSZXR1cm5zIGEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgcGFnZSBpcyBzdWJzZXF1ZW50bHkgdXBkYXRlZC5cbiAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICovXG5leHBvcnQgZnVuY3Rpb24gaW52YWxpZGF0ZUFsbCgpIHtcblx0aWYgKCFCUk9XU0VSKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBpbnZhbGlkYXRlQWxsKCkgb24gdGhlIHNlcnZlcicpO1xuXHR9XG5cblx0Zm9yY2VfaW52YWxpZGF0aW9uID0gdHJ1ZTtcblx0cmV0dXJuIF9pbnZhbGlkYXRlKCk7XG59XG5cbi8qKlxuICogUHJvZ3JhbW1hdGljYWxseSBwcmVsb2FkcyB0aGUgZ2l2ZW4gcGFnZSwgd2hpY2ggbWVhbnNcbiAqICAxLiBlbnN1cmluZyB0aGF0IHRoZSBjb2RlIGZvciB0aGUgcGFnZSBpcyBsb2FkZWQsIGFuZFxuICogIDIuIGNhbGxpbmcgdGhlIHBhZ2UncyBsb2FkIGZ1bmN0aW9uIHdpdGggdGhlIGFwcHJvcHJpYXRlIG9wdGlvbnMuXG4gKlxuICogVGhpcyBpcyB0aGUgc2FtZSBiZWhhdmlvdXIgdGhhdCBTdmVsdGVLaXQgdHJpZ2dlcnMgd2hlbiB0aGUgdXNlciB0YXBzIG9yIG1vdXNlcyBvdmVyIGFuIGA8YT5gIGVsZW1lbnQgd2l0aCBgZGF0YS1zdmVsdGVraXQtcHJlbG9hZC1kYXRhYC5cbiAqIElmIHRoZSBuZXh0IG5hdmlnYXRpb24gaXMgdG8gYGhyZWZgLCB0aGUgdmFsdWVzIHJldHVybmVkIGZyb20gbG9hZCB3aWxsIGJlIHVzZWQsIG1ha2luZyBuYXZpZ2F0aW9uIGluc3RhbnRhbmVvdXMuXG4gKiBSZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIHJlc3VsdCBvZiBydW5uaW5nIHRoZSBuZXcgcm91dGUncyBgbG9hZGAgZnVuY3Rpb25zIG9uY2UgdGhlIHByZWxvYWQgaXMgY29tcGxldGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGhyZWYgUGFnZSB0byBwcmVsb2FkXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7IHR5cGU6ICdsb2FkZWQnOyBzdGF0dXM6IG51bWJlcjsgZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiB9IHwgeyB0eXBlOiAncmVkaXJlY3QnOyBsb2NhdGlvbjogc3RyaW5nIH0+fVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJlbG9hZERhdGEoaHJlZikge1xuXHRpZiAoIUJST1dTRVIpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjYWxsIHByZWxvYWREYXRhKC4uLikgb24gdGhlIHNlcnZlcicpO1xuXHR9XG5cblx0Y29uc3QgdXJsID0gcmVzb2x2ZV91cmwoaHJlZik7XG5cdGNvbnN0IGludGVudCA9IGdldF9uYXZpZ2F0aW9uX2ludGVudCh1cmwsIGZhbHNlKTtcblxuXHRpZiAoIWludGVudCkge1xuXHRcdHRocm93IG5ldyBFcnJvcihgQXR0ZW1wdGVkIHRvIHByZWxvYWQgYSBVUkwgdGhhdCBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBhcHA6ICR7dXJsfWApO1xuXHR9XG5cblx0Y29uc3QgcmVzdWx0ID0gYXdhaXQgX3ByZWxvYWRfZGF0YShpbnRlbnQpO1xuXHRpZiAocmVzdWx0LnR5cGUgPT09ICdyZWRpcmVjdCcpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dHlwZTogcmVzdWx0LnR5cGUsXG5cdFx0XHRsb2NhdGlvbjogcmVzdWx0LmxvY2F0aW9uXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IHsgc3RhdHVzLCBkYXRhIH0gPSByZXN1bHQucHJvcHMucGFnZSA/PyBwYWdlO1xuXHRyZXR1cm4geyB0eXBlOiByZXN1bHQudHlwZSwgc3RhdHVzLCBkYXRhIH07XG59XG5cbi8qKlxuICogUHJvZ3JhbW1hdGljYWxseSBpbXBvcnRzIHRoZSBjb2RlIGZvciByb3V0ZXMgdGhhdCBoYXZlbid0IHlldCBiZWVuIGZldGNoZWQuXG4gKiBUeXBpY2FsbHksIHlvdSBtaWdodCBjYWxsIHRoaXMgdG8gc3BlZWQgdXAgc3Vic2VxdWVudCBuYXZpZ2F0aW9uLlxuICpcbiAqIFlvdSBjYW4gc3BlY2lmeSByb3V0ZXMgYnkgYW55IG1hdGNoaW5nIHBhdGhuYW1lIHN1Y2ggYXMgYC9hYm91dGAgKHRvIG1hdGNoIGBzcmMvcm91dGVzL2Fib3V0LytwYWdlLnN2ZWx0ZWApIG9yIGAvYmxvZy8qYCAodG8gbWF0Y2ggYHNyYy9yb3V0ZXMvYmxvZy9bc2x1Z10vK3BhZ2Uuc3ZlbHRlYCkuXG4gKlxuICogVW5saWtlIGBwcmVsb2FkRGF0YWAsIHRoaXMgd29uJ3QgY2FsbCBgbG9hZGAgZnVuY3Rpb25zLlxuICogUmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBtb2R1bGVzIGhhdmUgYmVlbiBpbXBvcnRlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aG5hbWVcbiAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICovXG5leHBvcnQgZnVuY3Rpb24gcHJlbG9hZENvZGUocGF0aG5hbWUpIHtcblx0aWYgKCFCUk9XU0VSKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBwcmVsb2FkQ29kZSguLi4pIG9uIHRoZSBzZXJ2ZXInKTtcblx0fVxuXG5cdGlmIChERVYpIHtcblx0XHRpZiAoIXBhdGhuYW1lLnN0YXJ0c1dpdGgoYmFzZSkpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0YHBhdGhuYW1lcyBwYXNzZWQgdG8gcHJlbG9hZENvZGUgbXVzdCBzdGFydCB3aXRoIFxcYHBhdGhzLmJhc2VcXGAgKGkuZS4gXCIke2Jhc2V9JHtwYXRobmFtZX1cIiByYXRoZXIgdGhhbiBcIiR7cGF0aG5hbWV9XCIpYFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAoIXJvdXRlcy5maW5kKChyb3V0ZSkgPT4gcm91dGUuZXhlYyhnZXRfdXJsX3BhdGgocGF0aG5hbWUpKSkpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgJyR7cGF0aG5hbWV9JyBkaWQgbm90IG1hdGNoIGFueSByb3V0ZXNgKTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gX3ByZWxvYWRfY29kZShwYXRobmFtZSk7XG59XG5cbi8qKlxuICogUHJvZ3JhbW1hdGljYWxseSBjcmVhdGUgYSBuZXcgaGlzdG9yeSBlbnRyeSB3aXRoIHRoZSBnaXZlbiBgJHBhZ2Uuc3RhdGVgLiBUbyB1c2UgdGhlIGN1cnJlbnQgVVJMLCB5b3UgY2FuIHBhc3MgYCcnYCBhcyB0aGUgZmlyc3QgYXJndW1lbnQuIFVzZWQgZm9yIFtzaGFsbG93IHJvdXRpbmddKGh0dHBzOi8va2l0LnN2ZWx0ZS5kZXYvZG9jcy9zaGFsbG93LXJvdXRpbmcpLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nIHwgVVJMfSB1cmxcbiAqIEBwYXJhbSB7QXBwLlBhZ2VTdGF0ZX0gc3RhdGVcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gcHVzaFN0YXRlKHVybCwgc3RhdGUpIHtcblx0aWYgKCFCUk9XU0VSKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBwdXNoU3RhdGUoLi4uKSBvbiB0aGUgc2VydmVyJyk7XG5cdH1cblxuXHRpZiAoREVWKSB7XG5cdFx0dHJ5IHtcblx0XHRcdC8vIHVzZSBgZGV2YWx1ZS5zdHJpbmdpZnlgIGFzIGEgY29udmVuaWVudCB3YXkgdG8gZW5zdXJlIHdlIGV4Y2x1ZGUgdmFsdWVzIHRoYXQgY2FuJ3QgYmUgcHJvcGVybHkgcmVoeWRyYXRlZCwgc3VjaCBhcyBjdXN0b20gY2xhc3MgaW5zdGFuY2VzXG5cdFx0XHRkZXZhbHVlLnN0cmluZ2lmeShzdGF0ZSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdC8vIEB0cy1leHBlY3QtZXJyb3Jcblx0XHRcdHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IHNlcmlhbGl6ZSBzdGF0ZSR7ZXJyb3IucGF0aH1gKTtcblx0XHR9XG5cdH1cblxuXHR1cGRhdGVfc2Nyb2xsX3Bvc2l0aW9ucyhjdXJyZW50X2hpc3RvcnlfaW5kZXgpO1xuXG5cdGNvbnN0IG9wdHMgPSB7XG5cdFx0W0hJU1RPUllfSU5ERVhdOiAoY3VycmVudF9oaXN0b3J5X2luZGV4ICs9IDEpLFxuXHRcdFtOQVZJR0FUSU9OX0lOREVYXTogY3VycmVudF9uYXZpZ2F0aW9uX2luZGV4LFxuXHRcdFtQQUdFX1VSTF9LRVldOiBwYWdlLnVybC5ocmVmLFxuXHRcdFtTVEFURVNfS0VZXTogc3RhdGVcblx0fTtcblxuXHRoaXN0b3J5LnB1c2hTdGF0ZShvcHRzLCAnJywgcmVzb2x2ZV91cmwodXJsKSk7XG5cdGhhc19uYXZpZ2F0ZWQgPSB0cnVlO1xuXG5cdHBhZ2UgPSB7IC4uLnBhZ2UsIHN0YXRlIH07XG5cdHJvb3QuJHNldCh7IHBhZ2UgfSk7XG5cblx0Y2xlYXJfb253YXJkX2hpc3RvcnkoY3VycmVudF9oaXN0b3J5X2luZGV4LCBjdXJyZW50X25hdmlnYXRpb25faW5kZXgpO1xufVxuXG4vKipcbiAqIFByb2dyYW1tYXRpY2FsbHkgcmVwbGFjZSB0aGUgY3VycmVudCBoaXN0b3J5IGVudHJ5IHdpdGggdGhlIGdpdmVuIGAkcGFnZS5zdGF0ZWAuIFRvIHVzZSB0aGUgY3VycmVudCBVUkwsIHlvdSBjYW4gcGFzcyBgJydgIGFzIHRoZSBmaXJzdCBhcmd1bWVudC4gVXNlZCBmb3IgW3NoYWxsb3cgcm91dGluZ10oaHR0cHM6Ly9raXQuc3ZlbHRlLmRldi9kb2NzL3NoYWxsb3ctcm91dGluZykuXG4gKlxuICogQHBhcmFtIHtzdHJpbmcgfCBVUkx9IHVybFxuICogQHBhcmFtIHtBcHAuUGFnZVN0YXRlfSBzdGF0ZVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlU3RhdGUodXJsLCBzdGF0ZSkge1xuXHRpZiAoIUJST1dTRVIpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjYWxsIHJlcGxhY2VTdGF0ZSguLi4pIG9uIHRoZSBzZXJ2ZXInKTtcblx0fVxuXG5cdGlmIChERVYpIHtcblx0XHR0cnkge1xuXHRcdFx0Ly8gdXNlIGBkZXZhbHVlLnN0cmluZ2lmeWAgYXMgYSBjb252ZW5pZW50IHdheSB0byBlbnN1cmUgd2UgZXhjbHVkZSB2YWx1ZXMgdGhhdCBjYW4ndCBiZSBwcm9wZXJseSByZWh5ZHJhdGVkLCBzdWNoIGFzIGN1c3RvbSBjbGFzcyBpbnN0YW5jZXNcblx0XHRcdGRldmFsdWUuc3RyaW5naWZ5KHN0YXRlKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0Ly8gQHRzLWV4cGVjdC1lcnJvclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3Qgc2VyaWFsaXplIHN0YXRlJHtlcnJvci5wYXRofWApO1xuXHRcdH1cblx0fVxuXG5cdGNvbnN0IG9wdHMgPSB7XG5cdFx0W0hJU1RPUllfSU5ERVhdOiBjdXJyZW50X2hpc3RvcnlfaW5kZXgsXG5cdFx0W05BVklHQVRJT05fSU5ERVhdOiBjdXJyZW50X25hdmlnYXRpb25faW5kZXgsXG5cdFx0W1BBR0VfVVJMX0tFWV06IHBhZ2UudXJsLmhyZWYsXG5cdFx0W1NUQVRFU19LRVldOiBzdGF0ZVxuXHR9O1xuXG5cdGhpc3RvcnkucmVwbGFjZVN0YXRlKG9wdHMsICcnLCByZXNvbHZlX3VybCh1cmwpKTtcblxuXHRwYWdlID0geyAuLi5wYWdlLCBzdGF0ZSB9O1xuXHRyb290LiRzZXQoeyBwYWdlIH0pO1xufVxuXG4vKipcbiAqIFRoaXMgYWN0aW9uIHVwZGF0ZXMgdGhlIGBmb3JtYCBwcm9wZXJ0eSBvZiB0aGUgY3VycmVudCBwYWdlIHdpdGggdGhlIGdpdmVuIGRhdGEgYW5kIHVwZGF0ZXMgYCRwYWdlLnN0YXR1c2AuXG4gKiBJbiBjYXNlIG9mIGFuIGVycm9yLCBpdCByZWRpcmVjdHMgdG8gdGhlIG5lYXJlc3QgZXJyb3IgcGFnZS5cbiAqIEB0ZW1wbGF0ZSB7UmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCB1bmRlZmluZWR9IFN1Y2Nlc3NcbiAqIEB0ZW1wbGF0ZSB7UmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCB1bmRlZmluZWR9IEZhaWx1cmVcbiAqIEBwYXJhbSB7aW1wb3J0KCdAc3ZlbHRlanMva2l0JykuQWN0aW9uUmVzdWx0PFN1Y2Nlc3MsIEZhaWx1cmU+fSByZXN1bHRcbiAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlBY3Rpb24ocmVzdWx0KSB7XG5cdGlmICghQlJPV1NFUikge1xuXHRcdHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNhbGwgYXBwbHlBY3Rpb24oLi4uKSBvbiB0aGUgc2VydmVyJyk7XG5cdH1cblxuXHRpZiAocmVzdWx0LnR5cGUgPT09ICdlcnJvcicpIHtcblx0XHRjb25zdCB1cmwgPSBuZXcgVVJMKGxvY2F0aW9uLmhyZWYpO1xuXG5cdFx0Y29uc3QgeyBicmFuY2gsIHJvdXRlIH0gPSBjdXJyZW50O1xuXHRcdGlmICghcm91dGUpIHJldHVybjtcblxuXHRcdGNvbnN0IGVycm9yX2xvYWQgPSBhd2FpdCBsb2FkX25lYXJlc3RfZXJyb3JfcGFnZShjdXJyZW50LmJyYW5jaC5sZW5ndGgsIGJyYW5jaCwgcm91dGUuZXJyb3JzKTtcblx0XHRpZiAoZXJyb3JfbG9hZCkge1xuXHRcdFx0Y29uc3QgbmF2aWdhdGlvbl9yZXN1bHQgPSBhd2FpdCBnZXRfbmF2aWdhdGlvbl9yZXN1bHRfZnJvbV9icmFuY2goe1xuXHRcdFx0XHR1cmwsXG5cdFx0XHRcdHBhcmFtczogY3VycmVudC5wYXJhbXMsXG5cdFx0XHRcdGJyYW5jaDogYnJhbmNoLnNsaWNlKDAsIGVycm9yX2xvYWQuaWR4KS5jb25jYXQoZXJyb3JfbG9hZC5ub2RlKSxcblx0XHRcdFx0c3RhdHVzOiByZXN1bHQuc3RhdHVzID8/IDUwMCxcblx0XHRcdFx0ZXJyb3I6IHJlc3VsdC5lcnJvcixcblx0XHRcdFx0cm91dGVcblx0XHRcdH0pO1xuXG5cdFx0XHRjdXJyZW50ID0gbmF2aWdhdGlvbl9yZXN1bHQuc3RhdGU7XG5cblx0XHRcdHJvb3QuJHNldChuYXZpZ2F0aW9uX3Jlc3VsdC5wcm9wcyk7XG5cblx0XHRcdHRpY2soKS50aGVuKHJlc2V0X2ZvY3VzKTtcblx0XHR9XG5cdH0gZWxzZSBpZiAocmVzdWx0LnR5cGUgPT09ICdyZWRpcmVjdCcpIHtcblx0XHRfZ290byhyZXN1bHQubG9jYXRpb24sIHsgaW52YWxpZGF0ZUFsbDogdHJ1ZSB9LCAwKTtcblx0fSBlbHNlIHtcblx0XHQvKiogQHR5cGUge1JlY29yZDxzdHJpbmcsIGFueT59ICovXG5cdFx0cm9vdC4kc2V0KHtcblx0XHRcdC8vIHRoaXMgYnJpbmdzIFN2ZWx0ZSdzIHZpZXcgb2YgdGhlIHdvcmxkIGluIGxpbmUgd2l0aCBTdmVsdGVLaXQnc1xuXHRcdFx0Ly8gYWZ0ZXIgdXNlOmVuaGFuY2UgcmVzZXQgdGhlIGZvcm0uLi4uXG5cdFx0XHRmb3JtOiBudWxsLFxuXHRcdFx0cGFnZTogeyAuLi5wYWdlLCBmb3JtOiByZXN1bHQuZGF0YSwgc3RhdHVzOiByZXN1bHQuc3RhdHVzIH1cblx0XHR9KTtcblxuXHRcdC8vIC4uLnNvIHRoYXQgc2V0dGluZyB0aGUgYGZvcm1gIHByb3AgdGFrZXMgZWZmZWN0IGFuZCBpc24ndCBpZ25vcmVkXG5cdFx0YXdhaXQgdGljaygpO1xuXHRcdHJvb3QuJHNldCh7IGZvcm06IHJlc3VsdC5kYXRhIH0pO1xuXG5cdFx0aWYgKHJlc3VsdC50eXBlID09PSAnc3VjY2VzcycpIHtcblx0XHRcdHJlc2V0X2ZvY3VzKCk7XG5cdFx0fVxuXHR9XG59XG5cbmZ1bmN0aW9uIF9zdGFydF9yb3V0ZXIoKSB7XG5cdGhpc3Rvcnkuc2Nyb2xsUmVzdG9yYXRpb24gPSAnbWFudWFsJztcblxuXHQvLyBBZG9wdGVkIGZyb20gTnV4dC5qc1xuXHQvLyBSZXNldCBzY3JvbGxSZXN0b3JhdGlvbiB0byBhdXRvIHdoZW4gbGVhdmluZyBwYWdlLCBhbGxvd2luZyBwYWdlIHJlbG9hZFxuXHQvLyBhbmQgYmFjay1uYXZpZ2F0aW9uIGZyb20gb3RoZXIgcGFnZXMgdG8gdXNlIHRoZSBicm93c2VyIHRvIHJlc3RvcmUgdGhlXG5cdC8vIHNjcm9sbGluZyBwb3NpdGlvbi5cblx0YWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgKGUpID0+IHtcblx0XHRsZXQgc2hvdWxkX2Jsb2NrID0gZmFsc2U7XG5cblx0XHRwZXJzaXN0X3N0YXRlKCk7XG5cblx0XHRpZiAoIW5hdmlnYXRpbmcpIHtcblx0XHRcdGNvbnN0IG5hdiA9IGNyZWF0ZV9uYXZpZ2F0aW9uKGN1cnJlbnQsIHVuZGVmaW5lZCwgbnVsbCwgJ2xlYXZlJyk7XG5cblx0XHRcdC8vIElmIHdlJ3JlIG5hdmlnYXRpbmcsIGJlZm9yZU5hdmlnYXRlIHdhcyBhbHJlYWR5IGNhbGxlZC4gSWYgd2UgZW5kIHVwIGluIGhlcmUgZHVyaW5nIG5hdmlnYXRpb24sXG5cdFx0XHQvLyBpdCdzIGR1ZSB0byBhbiBleHRlcm5hbCBvciBmdWxsLXBhZ2UtcmVsb2FkIGxpbmssIGZvciB3aGljaCB3ZSBkb24ndCB3YW50IHRvIGNhbGwgdGhlIGhvb2sgYWdhaW4uXG5cdFx0XHQvKiogQHR5cGUge2ltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLkJlZm9yZU5hdmlnYXRlfSAqL1xuXHRcdFx0Y29uc3QgbmF2aWdhdGlvbiA9IHtcblx0XHRcdFx0Li4ubmF2Lm5hdmlnYXRpb24sXG5cdFx0XHRcdGNhbmNlbDogKCkgPT4ge1xuXHRcdFx0XHRcdHNob3VsZF9ibG9jayA9IHRydWU7XG5cdFx0XHRcdFx0bmF2LnJlamVjdChuZXcgRXJyb3IoJ25hdmlnYXRpb24gY2FuY2VsbGVkJykpO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHRiZWZvcmVfbmF2aWdhdGVfY2FsbGJhY2tzLmZvckVhY2goKGZuKSA9PiBmbihuYXZpZ2F0aW9uKSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNob3VsZF9ibG9jaykge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0ZS5yZXR1cm5WYWx1ZSA9ICcnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRoaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gJ2F1dG8nO1xuXHRcdH1cblx0fSk7XG5cblx0YWRkRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsICgpID0+IHtcblx0XHRpZiAoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID09PSAnaGlkZGVuJykge1xuXHRcdFx0cGVyc2lzdF9zdGF0ZSgpO1xuXHRcdH1cblx0fSk7XG5cblx0Ly8gQHRzLWV4cGVjdC1lcnJvciB0aGlzIGlzbid0IHN1cHBvcnRlZCBldmVyeXdoZXJlIHlldFxuXHRpZiAoIW5hdmlnYXRvci5jb25uZWN0aW9uPy5zYXZlRGF0YSkge1xuXHRcdHNldHVwX3ByZWxvYWQoKTtcblx0fVxuXG5cdC8qKiBAcGFyYW0ge01vdXNlRXZlbnR9IGV2ZW50ICovXG5cdGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuXHRcdC8vIEFkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vdmlzaW9ubWVkaWEvcGFnZS5qc1xuXHRcdC8vIE1JVCBsaWNlbnNlIGh0dHBzOi8vZ2l0aHViLmNvbS92aXNpb25tZWRpYS9wYWdlLmpzI2xpY2Vuc2Vcblx0XHRpZiAoZXZlbnQuYnV0dG9uIHx8IGV2ZW50LndoaWNoICE9PSAxKSByZXR1cm47XG5cdFx0aWYgKGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuY3RybEtleSB8fCBldmVudC5zaGlmdEtleSB8fCBldmVudC5hbHRLZXkpIHJldHVybjtcblx0XHRpZiAoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuO1xuXG5cdFx0Y29uc3QgYSA9IGZpbmRfYW5jaG9yKC8qKiBAdHlwZSB7RWxlbWVudH0gKi8gKGV2ZW50LmNvbXBvc2VkUGF0aCgpWzBdKSwgY29udGFpbmVyKTtcblx0XHRpZiAoIWEpIHJldHVybjtcblxuXHRcdGNvbnN0IHsgdXJsLCBleHRlcm5hbCwgdGFyZ2V0LCBkb3dubG9hZCB9ID0gZ2V0X2xpbmtfaW5mbyhhLCBiYXNlKTtcblx0XHRpZiAoIXVybCkgcmV0dXJuO1xuXG5cdFx0Ly8gYmFpbCBvdXQgYmVmb3JlIGBiZWZvcmVOYXZpZ2F0ZWAgaWYgbGluayBvcGVucyBpbiBhIGRpZmZlcmVudCB0YWJcblx0XHRpZiAodGFyZ2V0ID09PSAnX3BhcmVudCcgfHwgdGFyZ2V0ID09PSAnX3RvcCcpIHtcblx0XHRcdGlmICh3aW5kb3cucGFyZW50ICE9PSB3aW5kb3cpIHJldHVybjtcblx0XHR9IGVsc2UgaWYgKHRhcmdldCAmJiB0YXJnZXQgIT09ICdfc2VsZicpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBvcHRpb25zID0gZ2V0X3JvdXRlcl9vcHRpb25zKGEpO1xuXHRcdGNvbnN0IGlzX3N2Z19hX2VsZW1lbnQgPSBhIGluc3RhbmNlb2YgU1ZHQUVsZW1lbnQ7XG5cblx0XHQvLyBJZ25vcmUgVVJMIHByb3RvY29scyB0aGF0IGRpZmZlciB0byB0aGUgY3VycmVudCBvbmUgYW5kIGFyZSBub3QgaHR0cChzKSAoZS5nLiBgbWFpbHRvOmAsIGB0ZWw6YCwgYG15YXBwOmAsIGV0Yy4pXG5cdFx0Ly8gVGhpcyBtYXkgYmUgd3Jvbmcgd2hlbiB0aGUgcHJvdG9jb2wgaXMgeDogYW5kIHRoZSBsaW5rIGdvZXMgdG8geTouLiB3aGljaCBzaG91bGQgYmUgdHJlYXRlZCBhcyBhbiBleHRlcm5hbFxuXHRcdC8vIG5hdmlnYXRpb24sIGJ1dCBpdCdzIG5vdCBjbGVhciBob3cgdG8gaGFuZGxlIHRoYXQgY2FzZSBhbmQgaXQncyBub3QgbGlrZWx5IHRvIGNvbWUgdXAgaW4gcHJhY3RpY2UuXG5cdFx0Ly8gTUVNTzogV2l0aG91dCB0aGlzIGNvbmRpdGlvbiwgZmlyZWZveCB3aWxsIG9wZW4gbWFpbGVyIHR3aWNlLlxuXHRcdC8vIFNlZTpcblx0XHQvLyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9raXQvaXNzdWVzLzQwNDVcblx0XHQvLyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9raXQvaXNzdWVzLzU3MjVcblx0XHQvLyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9raXQvaXNzdWVzLzY0OTZcblx0XHRpZiAoXG5cdFx0XHQhaXNfc3ZnX2FfZWxlbWVudCAmJlxuXHRcdFx0dXJsLnByb3RvY29sICE9PSBsb2NhdGlvbi5wcm90b2NvbCAmJlxuXHRcdFx0ISh1cmwucHJvdG9jb2wgPT09ICdodHRwczonIHx8IHVybC5wcm90b2NvbCA9PT0gJ2h0dHA6Jylcblx0XHQpXG5cdFx0XHRyZXR1cm47XG5cblx0XHRpZiAoZG93bmxvYWQpIHJldHVybjtcblxuXHRcdC8vIElnbm9yZSB0aGUgZm9sbG93aW5nIGJ1dCBmaXJlIGJlZm9yZU5hdmlnYXRlXG5cdFx0aWYgKGV4dGVybmFsIHx8IG9wdGlvbnMucmVsb2FkKSB7XG5cdFx0XHRpZiAoX2JlZm9yZV9uYXZpZ2F0ZSh7IHVybCwgdHlwZTogJ2xpbmsnIH0pKSB7XG5cdFx0XHRcdC8vIHNldCBgbmF2aWdhdGluZ2AgdG8gYHRydWVgIHRvIHByZXZlbnQgYGJlZm9yZU5hdmlnYXRlYCBjYWxsYmFja3Ncblx0XHRcdFx0Ly8gYmVpbmcgY2FsbGVkIHdoZW4gdGhlIHBhZ2UgdW5sb2Fkc1xuXHRcdFx0XHRuYXZpZ2F0aW5nID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBDaGVjayBpZiBuZXcgdXJsIG9ubHkgZGlmZmVycyBieSBoYXNoIGFuZCB1c2UgdGhlIGJyb3dzZXIgZGVmYXVsdCBiZWhhdmlvciBpbiB0aGF0IGNhc2Vcblx0XHQvLyBUaGlzIHdpbGwgZW5zdXJlIHRoZSBgaGFzaGNoYW5nZWAgZXZlbnQgaXMgZmlyZWRcblx0XHQvLyBSZW1vdmluZyB0aGUgaGFzaCBkb2VzIGEgZnVsbCBwYWdlIG5hdmlnYXRpb24gaW4gdGhlIGJyb3dzZXIsIHNvIG1ha2Ugc3VyZSBhIGhhc2ggaXMgcHJlc2VudFxuXHRcdGNvbnN0IFtub25oYXNoLCBoYXNoXSA9IHVybC5ocmVmLnNwbGl0KCcjJyk7XG5cdFx0aWYgKGhhc2ggIT09IHVuZGVmaW5lZCAmJiBub25oYXNoID09PSBzdHJpcF9oYXNoKGxvY2F0aW9uKSkge1xuXHRcdFx0Ly8gSWYgd2UgYXJlIHRyeWluZyB0byBuYXZpZ2F0ZSB0byB0aGUgc2FtZSBoYXNoLCB3ZSBzaG91bGQgb25seVxuXHRcdFx0Ly8gYXR0ZW1wdCB0byBzY3JvbGwgdG8gdGhhdCBlbGVtZW50IGFuZCBhdm9pZCBhbnkgaGlzdG9yeSBjaGFuZ2VzLlxuXHRcdFx0Ly8gT3RoZXJ3aXNlLCB0aGlzIGNhbiBjYXVzZSBGaXJlZm94IHRvIGluY29ycmVjdGx5IGFzc2lnbiBhIG51bGxcblx0XHRcdC8vIGhpc3Rvcnkgc3RhdGUgdmFsdWUgd2l0aG91dCBhbnkgc2lnbmFsIHRoYXQgd2UgY2FuIGRldGVjdC5cblx0XHRcdGNvbnN0IFssIGN1cnJlbnRfaGFzaF0gPSBjdXJyZW50LnVybC5ocmVmLnNwbGl0KCcjJyk7XG5cdFx0XHRpZiAoY3VycmVudF9oYXNoID09PSBoYXNoKSB7XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0Ly8gV2UncmUgYWxyZWFkeSBvbiAvIyBhbmQgY2xpY2sgb24gYSBsaW5rIHRoYXQgZ29lcyB0byAvIywgb3Igd2UncmUgb25cblx0XHRcdFx0Ly8gLyN0b3AgYW5kIGNsaWNrIG9uIGEgbGluayB0aGF0IGdvZXMgdG8gLyN0b3AuIEluIHRob3NlIGNhc2VzIGp1c3QgZ28gdG9cblx0XHRcdFx0Ly8gdGhlIHRvcCBvZiB0aGUgcGFnZSwgYW5kIGF2b2lkIGEgaGlzdG9yeSBjaGFuZ2UuXG5cdFx0XHRcdGlmIChoYXNoID09PSAnJyB8fCAoaGFzaCA9PT0gJ3RvcCcgJiYgYS5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3AnKSA9PT0gbnVsbCkpIHtcblx0XHRcdFx0XHR3aW5kb3cuc2Nyb2xsVG8oeyB0b3A6IDAgfSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0YS5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhhc2gpPy5zY3JvbGxJbnRvVmlldygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0Ly8gc2V0IHRoaXMgZmxhZyB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIG5hdmlnYXRpb25zIHRyaWdnZXJlZCBieVxuXHRcdFx0Ly8gY2xpY2tpbmcgYSBoYXNoIGxpbmsgYW5kIHRob3NlIHRyaWdnZXJlZCBieSBwb3BzdGF0ZVxuXHRcdFx0aGFzaF9uYXZpZ2F0aW5nID0gdHJ1ZTtcblxuXHRcdFx0dXBkYXRlX3Njcm9sbF9wb3NpdGlvbnMoY3VycmVudF9oaXN0b3J5X2luZGV4KTtcblxuXHRcdFx0dXBkYXRlX3VybCh1cmwpO1xuXG5cdFx0XHRpZiAoIW9wdGlvbnMucmVwbGFjZV9zdGF0ZSkgcmV0dXJuO1xuXG5cdFx0XHQvLyBoYXNoY2hhbmdlIGV2ZW50IHNob3VsZG4ndCBvY2N1ciBpZiB0aGUgcm91dGVyIGlzIHJlcGxhY2luZyBzdGF0ZS5cblx0XHRcdGhhc2hfbmF2aWdhdGluZyA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRuYXZpZ2F0ZSh7XG5cdFx0XHR0eXBlOiAnbGluaycsXG5cdFx0XHR1cmwsXG5cdFx0XHRrZWVwZm9jdXM6IG9wdGlvbnMua2VlcGZvY3VzLFxuXHRcdFx0bm9zY3JvbGw6IG9wdGlvbnMubm9zY3JvbGwsXG5cdFx0XHRyZXBsYWNlX3N0YXRlOiBvcHRpb25zLnJlcGxhY2Vfc3RhdGUgPz8gdXJsLmhyZWYgPT09IGxvY2F0aW9uLmhyZWZcblx0XHR9KTtcblx0fSk7XG5cblx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldmVudCkgPT4ge1xuXHRcdGlmIChldmVudC5kZWZhdWx0UHJldmVudGVkKSByZXR1cm47XG5cblx0XHRjb25zdCBmb3JtID0gLyoqIEB0eXBlIHtIVE1MRm9ybUVsZW1lbnR9ICovIChcblx0XHRcdEhUTUxGb3JtRWxlbWVudC5wcm90b3R5cGUuY2xvbmVOb2RlLmNhbGwoZXZlbnQudGFyZ2V0KVxuXHRcdCk7XG5cblx0XHRjb25zdCBzdWJtaXR0ZXIgPSAvKiogQHR5cGUge0hUTUxCdXR0b25FbGVtZW50IHwgSFRNTElucHV0RWxlbWVudCB8IG51bGx9ICovIChldmVudC5zdWJtaXR0ZXIpO1xuXG5cdFx0Y29uc3QgbWV0aG9kID0gc3VibWl0dGVyPy5mb3JtTWV0aG9kIHx8IGZvcm0ubWV0aG9kO1xuXG5cdFx0aWYgKG1ldGhvZCAhPT0gJ2dldCcpIHJldHVybjtcblxuXHRcdGNvbnN0IHVybCA9IG5ldyBVUkwoXG5cdFx0XHQoc3VibWl0dGVyPy5oYXNBdHRyaWJ1dGUoJ2Zvcm1hY3Rpb24nKSAmJiBzdWJtaXR0ZXI/LmZvcm1BY3Rpb24pIHx8IGZvcm0uYWN0aW9uXG5cdFx0KTtcblxuXHRcdGlmIChpc19leHRlcm5hbF91cmwodXJsLCBiYXNlKSkgcmV0dXJuO1xuXG5cdFx0Y29uc3QgZXZlbnRfZm9ybSA9IC8qKiBAdHlwZSB7SFRNTEZvcm1FbGVtZW50fSAqLyAoZXZlbnQudGFyZ2V0KTtcblxuXHRcdGNvbnN0IG9wdGlvbnMgPSBnZXRfcm91dGVyX29wdGlvbnMoZXZlbnRfZm9ybSk7XG5cdFx0aWYgKG9wdGlvbnMucmVsb2FkKSByZXR1cm47XG5cblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0Y29uc3QgZGF0YSA9IG5ldyBGb3JtRGF0YShldmVudF9mb3JtKTtcblxuXHRcdGNvbnN0IHN1Ym1pdHRlcl9uYW1lID0gc3VibWl0dGVyPy5nZXRBdHRyaWJ1dGUoJ25hbWUnKTtcblx0XHRpZiAoc3VibWl0dGVyX25hbWUpIHtcblx0XHRcdGRhdGEuYXBwZW5kKHN1Ym1pdHRlcl9uYW1lLCBzdWJtaXR0ZXI/LmdldEF0dHJpYnV0ZSgndmFsdWUnKSA/PyAnJyk7XG5cdFx0fVxuXG5cdFx0Ly8gQHRzLWV4cGVjdC1lcnJvciBgVVJMU2VhcmNoUGFyYW1zKGZkKWAgaXMga29zaGVyLCBidXQgdHlwZXNjcmlwdCBkb2Vzbid0IGtub3cgdGhhdFxuXHRcdHVybC5zZWFyY2ggPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGRhdGEpLnRvU3RyaW5nKCk7XG5cblx0XHRuYXZpZ2F0ZSh7XG5cdFx0XHR0eXBlOiAnZm9ybScsXG5cdFx0XHR1cmwsXG5cdFx0XHRrZWVwZm9jdXM6IG9wdGlvbnMua2VlcGZvY3VzLFxuXHRcdFx0bm9zY3JvbGw6IG9wdGlvbnMubm9zY3JvbGwsXG5cdFx0XHRyZXBsYWNlX3N0YXRlOiBvcHRpb25zLnJlcGxhY2Vfc3RhdGUgPz8gdXJsLmhyZWYgPT09IGxvY2F0aW9uLmhyZWZcblx0XHR9KTtcblx0fSk7XG5cblx0YWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBhc3luYyAoZXZlbnQpID0+IHtcblx0XHRpZiAoZXZlbnQuc3RhdGU/LltISVNUT1JZX0lOREVYXSkge1xuXHRcdFx0Y29uc3QgaGlzdG9yeV9pbmRleCA9IGV2ZW50LnN0YXRlW0hJU1RPUllfSU5ERVhdO1xuXHRcdFx0dG9rZW4gPSB7fTtcblxuXHRcdFx0Ly8gaWYgYSBwb3BzdGF0ZS1kcml2ZW4gbmF2aWdhdGlvbiBpcyBjYW5jZWxsZWQsIHdlIG5lZWQgdG8gY291bnRlcmFjdCBpdFxuXHRcdFx0Ly8gd2l0aCBoaXN0b3J5LmdvLCB3aGljaCBtZWFucyB3ZSBlbmQgdXAgYmFjayBoZXJlLCBoZW5jZSB0aGlzIGNoZWNrXG5cdFx0XHRpZiAoaGlzdG9yeV9pbmRleCA9PT0gY3VycmVudF9oaXN0b3J5X2luZGV4KSByZXR1cm47XG5cblx0XHRcdGNvbnN0IHNjcm9sbCA9IHNjcm9sbF9wb3NpdGlvbnNbaGlzdG9yeV9pbmRleF07XG5cdFx0XHRjb25zdCBzdGF0ZSA9IGV2ZW50LnN0YXRlW1NUQVRFU19LRVldID8/IHt9O1xuXHRcdFx0Y29uc3QgdXJsID0gbmV3IFVSTChldmVudC5zdGF0ZVtQQUdFX1VSTF9LRVldID8/IGxvY2F0aW9uLmhyZWYpO1xuXHRcdFx0Y29uc3QgbmF2aWdhdGlvbl9pbmRleCA9IGV2ZW50LnN0YXRlW05BVklHQVRJT05fSU5ERVhdO1xuXHRcdFx0Y29uc3QgaXNfaGFzaF9jaGFuZ2UgPSBzdHJpcF9oYXNoKGxvY2F0aW9uKSA9PT0gc3RyaXBfaGFzaChjdXJyZW50LnVybCk7XG5cdFx0XHRjb25zdCBzaGFsbG93ID1cblx0XHRcdFx0bmF2aWdhdGlvbl9pbmRleCA9PT0gY3VycmVudF9uYXZpZ2F0aW9uX2luZGV4ICYmIChoYXNfbmF2aWdhdGVkIHx8IGlzX2hhc2hfY2hhbmdlKTtcblxuXHRcdFx0aWYgKHNoYWxsb3cpIHtcblx0XHRcdFx0Ly8gV2UgZG9uJ3QgbmVlZCB0byBuYXZpZ2F0ZSwgd2UganVzdCBuZWVkIHRvIHVwZGF0ZSBzY3JvbGwgYW5kL29yIHN0YXRlLlxuXHRcdFx0XHQvLyBUaGlzIGhhcHBlbnMgd2l0aCBoYXNoIGxpbmtzIGFuZCBgcHVzaFN0YXRlYC9gcmVwbGFjZVN0YXRlYC4gVGhlXG5cdFx0XHRcdC8vIGV4Y2VwdGlvbiBpcyBpZiB3ZSBoYXZlbid0IG5hdmlnYXRlZCB5ZXQsIHNpbmNlIHdlIGNvdWxkIGhhdmVcblx0XHRcdFx0Ly8gZ290IGhlcmUgYWZ0ZXIgYSBtb2RhbCBuYXZpZ2F0aW9uIHRoZW4gYSByZWxvYWRcblx0XHRcdFx0dXBkYXRlX3VybCh1cmwpO1xuXG5cdFx0XHRcdHNjcm9sbF9wb3NpdGlvbnNbY3VycmVudF9oaXN0b3J5X2luZGV4XSA9IHNjcm9sbF9zdGF0ZSgpO1xuXHRcdFx0XHRpZiAoc2Nyb2xsKSBzY3JvbGxUbyhzY3JvbGwueCwgc2Nyb2xsLnkpO1xuXG5cdFx0XHRcdGlmIChzdGF0ZSAhPT0gcGFnZS5zdGF0ZSkge1xuXHRcdFx0XHRcdHBhZ2UgPSB7IC4uLnBhZ2UsIHN0YXRlIH07XG5cdFx0XHRcdFx0cm9vdC4kc2V0KHsgcGFnZSB9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGN1cnJlbnRfaGlzdG9yeV9pbmRleCA9IGhpc3RvcnlfaW5kZXg7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgZGVsdGEgPSBoaXN0b3J5X2luZGV4IC0gY3VycmVudF9oaXN0b3J5X2luZGV4O1xuXG5cdFx0XHRhd2FpdCBuYXZpZ2F0ZSh7XG5cdFx0XHRcdHR5cGU6ICdwb3BzdGF0ZScsXG5cdFx0XHRcdHVybCxcblx0XHRcdFx0cG9wcGVkOiB7XG5cdFx0XHRcdFx0c3RhdGUsXG5cdFx0XHRcdFx0c2Nyb2xsLFxuXHRcdFx0XHRcdGRlbHRhXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGFjY2VwdDogKCkgPT4ge1xuXHRcdFx0XHRcdGN1cnJlbnRfaGlzdG9yeV9pbmRleCA9IGhpc3RvcnlfaW5kZXg7XG5cdFx0XHRcdFx0Y3VycmVudF9uYXZpZ2F0aW9uX2luZGV4ID0gbmF2aWdhdGlvbl9pbmRleDtcblx0XHRcdFx0fSxcblx0XHRcdFx0YmxvY2s6ICgpID0+IHtcblx0XHRcdFx0XHRoaXN0b3J5LmdvKC1kZWx0YSk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG5hdl90b2tlbjogdG9rZW5cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBzaW5jZSBwb3BzdGF0ZSBldmVudCBpcyBhbHNvIGVtaXR0ZWQgd2hlbiBhbiBhbmNob3IgcmVmZXJlbmNpbmcgdGhlIHNhbWVcblx0XHRcdC8vIGRvY3VtZW50IGlzIGNsaWNrZWQsIHdlIGhhdmUgdG8gY2hlY2sgdGhhdCB0aGUgcm91dGVyIGlzbid0IGFscmVhZHkgaGFuZGxpbmdcblx0XHRcdC8vIHRoZSBuYXZpZ2F0aW9uLiBvdGhlcndpc2Ugd2Ugd291bGQgYmUgdXBkYXRpbmcgdGhlIHBhZ2Ugc3RvcmUgdHdpY2UuXG5cdFx0XHRpZiAoIWhhc2hfbmF2aWdhdGluZykge1xuXHRcdFx0XHRjb25zdCB1cmwgPSBuZXcgVVJMKGxvY2F0aW9uLmhyZWYpO1xuXHRcdFx0XHR1cGRhdGVfdXJsKHVybCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHRhZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgKCkgPT4ge1xuXHRcdC8vIGlmIHRoZSBoYXNoY2hhbmdlIGhhcHBlbmVkIGFzIGEgcmVzdWx0IG9mIGNsaWNraW5nIG9uIGEgbGluayxcblx0XHQvLyB3ZSBuZWVkIHRvIHVwZGF0ZSBoaXN0b3J5LCBvdGhlcndpc2Ugd2UgaGF2ZSB0byBsZWF2ZSBpdCBhbG9uZVxuXHRcdGlmIChoYXNoX25hdmlnYXRpbmcpIHtcblx0XHRcdGhhc2hfbmF2aWdhdGluZyA9IGZhbHNlO1xuXHRcdFx0aGlzdG9yeS5yZXBsYWNlU3RhdGUoXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQuLi5oaXN0b3J5LnN0YXRlLFxuXHRcdFx0XHRcdFtISVNUT1JZX0lOREVYXTogKytjdXJyZW50X2hpc3RvcnlfaW5kZXgsXG5cdFx0XHRcdFx0W05BVklHQVRJT05fSU5ERVhdOiBjdXJyZW50X25hdmlnYXRpb25faW5kZXhcblx0XHRcdFx0fSxcblx0XHRcdFx0JycsXG5cdFx0XHRcdGxvY2F0aW9uLmhyZWZcblx0XHRcdCk7XG5cdFx0fVxuXHR9KTtcblxuXHQvLyBmaXggbGlua1tyZWw9aWNvbl0sIGJlY2F1c2UgYnJvd3NlcnMgd2lsbCBvY2Nhc2lvbmFsbHkgdHJ5IHRvIGxvYWQgcmVsYXRpdmVcblx0Ly8gVVJMcyBhZnRlciBhIHB1c2hTdGF0ZS9yZXBsYWNlU3RhdGUsIHJlc3VsdGluZyBpbiBhIDQwNCDigJQgc2VlXG5cdC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9raXQvaXNzdWVzLzM3NDgjaXNzdWVjb21tZW50LTExMjU5ODA4OTdcblx0Zm9yIChjb25zdCBsaW5rIG9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpbmsnKSkge1xuXHRcdGlmIChsaW5rLnJlbCA9PT0gJ2ljb24nKSBsaW5rLmhyZWYgPSBsaW5rLmhyZWY7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblx0fVxuXG5cdGFkZEV2ZW50TGlzdGVuZXIoJ3BhZ2VzaG93JywgKGV2ZW50KSA9PiB7XG5cdFx0Ly8gSWYgdGhlIHVzZXIgbmF2aWdhdGVzIHRvIGFub3RoZXIgc2l0ZSBhbmQgdGhlbiB1c2VzIHRoZSBiYWNrIGJ1dHRvbiBhbmRcblx0XHQvLyBiZmNhY2hlIGhpdHMsIHdlIG5lZWQgdG8gc2V0IG5hdmlnYXRpbmcgdG8gbnVsbCwgdGhlIHNpdGUgZG9lc24ndCBrbm93XG5cdFx0Ly8gdGhlIG5hdmlnYXRpb24gYXdheSBmcm9tIGl0IHdhcyBzdWNjZXNzZnVsLlxuXHRcdC8vIEluZm8gYWJvdXQgYmZjYWNoZSBoZXJlOiBodHRwczovL3dlYi5kZXYvYmZjYWNoZVxuXHRcdGlmIChldmVudC5wZXJzaXN0ZWQpIHtcblx0XHRcdHN0b3Jlcy5uYXZpZ2F0aW5nLnNldChudWxsKTtcblx0XHR9XG5cdH0pO1xuXG5cdC8qKlxuXHQgKiBAcGFyYW0ge1VSTH0gdXJsXG5cdCAqL1xuXHRmdW5jdGlvbiB1cGRhdGVfdXJsKHVybCkge1xuXHRcdGN1cnJlbnQudXJsID0gdXJsO1xuXHRcdHN0b3Jlcy5wYWdlLnNldCh7IC4uLnBhZ2UsIHVybCB9KTtcblx0XHRzdG9yZXMucGFnZS5ub3RpZnkoKTtcblx0fVxufVxuXG4vKipcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHRhcmdldFxuICogQHBhcmFtIHt7XG4gKiAgIHN0YXR1czogbnVtYmVyO1xuICogICBlcnJvcjogQXBwLkVycm9yIHwgbnVsbDtcbiAqICAgbm9kZV9pZHM6IG51bWJlcltdO1xuICogICBwYXJhbXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gKiAgIHJvdXRlOiB7IGlkOiBzdHJpbmcgfCBudWxsIH07XG4gKiAgIGRhdGE6IEFycmF5PGltcG9ydCgndHlwZXMnKS5TZXJ2ZXJEYXRhTm9kZSB8IG51bGw+O1xuICogICBmb3JtOiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgbnVsbDtcbiAqIH19IG9wdHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gX2h5ZHJhdGUoXG5cdHRhcmdldCxcblx0eyBzdGF0dXMgPSAyMDAsIGVycm9yLCBub2RlX2lkcywgcGFyYW1zLCByb3V0ZSwgZGF0YTogc2VydmVyX2RhdGFfbm9kZXMsIGZvcm0gfVxuKSB7XG5cdGh5ZHJhdGVkID0gdHJ1ZTtcblxuXHRjb25zdCB1cmwgPSBuZXcgVVJMKGxvY2F0aW9uLmhyZWYpO1xuXG5cdGlmICghX19TVkVMVEVLSVRfRU1CRURERURfXykge1xuXHRcdC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vc3ZlbHRlanMva2l0L3B1bGwvNDkzNSNpc3N1ZWNvbW1lbnQtMTMyODA5MzM1OCBmb3Igb25lIG1vdGl2YXRpb25cblx0XHQvLyBvZiBkZXRlcm1pbmluZyB0aGUgcGFyYW1zIG9uIHRoZSBjbGllbnQgc2lkZS5cblx0XHQoeyBwYXJhbXMgPSB7fSwgcm91dGUgPSB7IGlkOiBudWxsIH0gfSA9IGdldF9uYXZpZ2F0aW9uX2ludGVudCh1cmwsIGZhbHNlKSB8fCB7fSk7XG5cdH1cblxuXHQvKiogQHR5cGUge2ltcG9ydCgnLi90eXBlcy5qcycpLk5hdmlnYXRpb25GaW5pc2hlZCB8IHVuZGVmaW5lZH0gKi9cblx0bGV0IHJlc3VsdDtcblxuXHR0cnkge1xuXHRcdGNvbnN0IGJyYW5jaF9wcm9taXNlcyA9IG5vZGVfaWRzLm1hcChhc3luYyAobiwgaSkgPT4ge1xuXHRcdFx0Y29uc3Qgc2VydmVyX2RhdGFfbm9kZSA9IHNlcnZlcl9kYXRhX25vZGVzW2ldO1xuXHRcdFx0Ly8gVHlwZSBpc24ndCBjb21wbGV0ZWx5IGFjY3VyYXRlLCB3ZSBzdGlsbCBuZWVkIHRvIGRlc2VyaWFsaXplIHVzZXNcblx0XHRcdGlmIChzZXJ2ZXJfZGF0YV9ub2RlPy51c2VzKSB7XG5cdFx0XHRcdHNlcnZlcl9kYXRhX25vZGUudXNlcyA9IGRlc2VyaWFsaXplX3VzZXMoc2VydmVyX2RhdGFfbm9kZS51c2VzKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGxvYWRfbm9kZSh7XG5cdFx0XHRcdGxvYWRlcjogYXBwLm5vZGVzW25dLFxuXHRcdFx0XHR1cmwsXG5cdFx0XHRcdHBhcmFtcyxcblx0XHRcdFx0cm91dGUsXG5cdFx0XHRcdHBhcmVudDogYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IGRhdGEgPSB7fTtcblx0XHRcdFx0XHRmb3IgKGxldCBqID0gMDsgaiA8IGk7IGogKz0gMSkge1xuXHRcdFx0XHRcdFx0T2JqZWN0LmFzc2lnbihkYXRhLCAoYXdhaXQgYnJhbmNoX3Byb21pc2VzW2pdKS5kYXRhKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIGRhdGE7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNlcnZlcl9kYXRhX25vZGU6IGNyZWF0ZV9kYXRhX25vZGUoc2VydmVyX2RhdGFfbm9kZSlcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0LyoqIEB0eXBlIHtBcnJheTxpbXBvcnQoJy4vdHlwZXMuanMnKS5CcmFuY2hOb2RlIHwgdW5kZWZpbmVkPn0gKi9cblx0XHRjb25zdCBicmFuY2ggPSBhd2FpdCBQcm9taXNlLmFsbChicmFuY2hfcHJvbWlzZXMpO1xuXG5cdFx0Y29uc3QgcGFyc2VkX3JvdXRlID0gcm91dGVzLmZpbmQoKHsgaWQgfSkgPT4gaWQgPT09IHJvdXRlLmlkKTtcblxuXHRcdC8vIHNlcnZlci1zaWRlIHdpbGwgaGF2ZSBjb21wYWN0ZWQgdGhlIGJyYW5jaCwgcmVpbnN0YXRlIGVtcHR5IHNsb3RzXG5cdFx0Ly8gc28gdGhhdCBlcnJvciBib3VuZGFyaWVzIGNhbiBiZSBsaW5lZCB1cCBjb3JyZWN0bHlcblx0XHRpZiAocGFyc2VkX3JvdXRlKSB7XG5cdFx0XHRjb25zdCBsYXlvdXRzID0gcGFyc2VkX3JvdXRlLmxheW91dHM7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxheW91dHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKCFsYXlvdXRzW2ldKSB7XG5cdFx0XHRcdFx0YnJhbmNoLnNwbGljZShpLCAwLCB1bmRlZmluZWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmVzdWx0ID0gYXdhaXQgZ2V0X25hdmlnYXRpb25fcmVzdWx0X2Zyb21fYnJhbmNoKHtcblx0XHRcdHVybCxcblx0XHRcdHBhcmFtcyxcblx0XHRcdGJyYW5jaCxcblx0XHRcdHN0YXR1cyxcblx0XHRcdGVycm9yLFxuXHRcdFx0Zm9ybSxcblx0XHRcdHJvdXRlOiBwYXJzZWRfcm91dGUgPz8gbnVsbFxuXHRcdH0pO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChlcnJvciBpbnN0YW5jZW9mIFJlZGlyZWN0KSB7XG5cdFx0XHQvLyB0aGlzIGlzIGEgcmVhbCBlZGdlIGNhc2Ug4oCUIGBsb2FkYCB3b3VsZCBuZWVkIHRvIHJldHVyblxuXHRcdFx0Ly8gYSByZWRpcmVjdCBidXQgb25seSBpbiB0aGUgYnJvd3NlclxuXHRcdFx0YXdhaXQgbmF0aXZlX25hdmlnYXRpb24obmV3IFVSTChlcnJvci5sb2NhdGlvbiwgbG9jYXRpb24uaHJlZikpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHJlc3VsdCA9IGF3YWl0IGxvYWRfcm9vdF9lcnJvcl9wYWdlKHtcblx0XHRcdHN0YXR1czogZ2V0X3N0YXR1cyhlcnJvciksXG5cdFx0XHRlcnJvcjogYXdhaXQgaGFuZGxlX2Vycm9yKGVycm9yLCB7IHVybCwgcGFyYW1zLCByb3V0ZSB9KSxcblx0XHRcdHVybCxcblx0XHRcdHJvdXRlXG5cdFx0fSk7XG5cdH1cblxuXHRpZiAocmVzdWx0LnByb3BzLnBhZ2UpIHtcblx0XHRyZXN1bHQucHJvcHMucGFnZS5zdGF0ZSA9IHt9O1xuXHR9XG5cblx0aW5pdGlhbGl6ZShyZXN1bHQsIHRhcmdldCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtVUkx9IHVybFxuICogQHBhcmFtIHtib29sZWFuW119IGludmFsaWRcbiAqIEByZXR1cm5zIHtQcm9taXNlPGltcG9ydCgndHlwZXMnKS5TZXJ2ZXJOb2Rlc1Jlc3BvbnNlIHwgaW1wb3J0KCd0eXBlcycpLlNlcnZlclJlZGlyZWN0Tm9kZT59XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxvYWRfZGF0YSh1cmwsIGludmFsaWQpIHtcblx0Y29uc3QgZGF0YV91cmwgPSBuZXcgVVJMKHVybCk7XG5cdGRhdGFfdXJsLnBhdGhuYW1lID0gYWRkX2RhdGFfc3VmZml4KHVybC5wYXRobmFtZSk7XG5cdGlmICh1cmwucGF0aG5hbWUuZW5kc1dpdGgoJy8nKSkge1xuXHRcdGRhdGFfdXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoVFJBSUxJTkdfU0xBU0hfUEFSQU0sICcxJyk7XG5cdH1cblx0aWYgKERFViAmJiB1cmwuc2VhcmNoUGFyYW1zLmhhcyhJTlZBTElEQVRFRF9QQVJBTSkpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCB1c2VkIHJlc2VydmVkIHF1ZXJ5IHBhcmFtZXRlciBcIiR7SU5WQUxJREFURURfUEFSQU19XCJgKTtcblx0fVxuXHRkYXRhX3VybC5zZWFyY2hQYXJhbXMuYXBwZW5kKElOVkFMSURBVEVEX1BBUkFNLCBpbnZhbGlkLm1hcCgoaSkgPT4gKGkgPyAnMScgOiAnMCcpKS5qb2luKCcnKSk7XG5cblx0Y29uc3QgcmVzID0gYXdhaXQgbmF0aXZlX2ZldGNoKGRhdGFfdXJsLmhyZWYpO1xuXG5cdGlmICghcmVzLm9rKSB7XG5cdFx0Ly8gZXJyb3IgbWVzc2FnZSBpcyBhIEpTT04tc3RyaW5naWZpZWQgc3RyaW5nIHdoaWNoIGRldmFsdWUgY2FuJ3QgaGFuZGxlIGF0IHRoZSB0b3AgbGV2ZWxcblx0XHQvLyB0dXJuIGl0IGludG8gYSBIdHRwRXJyb3IgdG8gbm90IGNhbGwgaGFuZGxlRXJyb3Igb24gdGhlIGNsaWVudCBhZ2FpbiAod2FzIGFscmVhZHkgaGFuZGxlZCBvbiB0aGUgc2VydmVyKVxuXHRcdC8vIGlmIGBfX2RhdGEuanNvbmAgZG9lc24ndCBleGlzdCBvciB0aGUgc2VydmVyIGhhcyBhbiBpbnRlcm5hbCBlcnJvcixcblx0XHQvLyBhdm9pZCBwYXJzaW5nIHRoZSBIVE1MIGVycm9yIHBhZ2UgYXMgYSBKU09OXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmcgfCB1bmRlZmluZWR9ICovXG5cdFx0bGV0IG1lc3NhZ2U7XG5cdFx0aWYgKHJlcy5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJyk/LmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykpIHtcblx0XHRcdG1lc3NhZ2UgPSBhd2FpdCByZXMuanNvbigpO1xuXHRcdH0gZWxzZSBpZiAocmVzLnN0YXR1cyA9PT0gNDA0KSB7XG5cdFx0XHRtZXNzYWdlID0gJ05vdCBGb3VuZCc7XG5cdFx0fSBlbHNlIGlmIChyZXMuc3RhdHVzID09PSA1MDApIHtcblx0XHRcdG1lc3NhZ2UgPSAnSW50ZXJuYWwgRXJyb3InO1xuXHRcdH1cblx0XHR0aHJvdyBuZXcgSHR0cEVycm9yKHJlcy5zdGF0dXMsIG1lc3NhZ2UpO1xuXHR9XG5cblx0Ly8gVE9ETzogZml4IGVzbGludCBlcnJvciAvIGZpZ3VyZSBvdXQgaWYgaXQgYWN0dWFsbHkgYXBwbGllcyB0byBvdXIgc2l0dWF0aW9uXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuXHRyZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUpID0+IHtcblx0XHQvKipcblx0XHQgKiBNYXAgb2YgZGVmZXJyZWQgcHJvbWlzZXMgdGhhdCB3aWxsIGJlIHJlc29sdmVkIGJ5IGEgc3Vic2VxdWVudCBjaHVuayBvZiBkYXRhXG5cdFx0ICogQHR5cGUge01hcDxzdHJpbmcsIGltcG9ydCgndHlwZXMnKS5EZWZlcnJlZD59XG5cdFx0ICovXG5cdFx0Y29uc3QgZGVmZXJyZWRzID0gbmV3IE1hcCgpO1xuXHRcdGNvbnN0IHJlYWRlciA9IC8qKiBAdHlwZSB7UmVhZGFibGVTdHJlYW08VWludDhBcnJheT59ICovIChyZXMuYm9keSkuZ2V0UmVhZGVyKCk7XG5cdFx0Y29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xuXG5cdFx0LyoqXG5cdFx0ICogQHBhcmFtIHthbnl9IGRhdGFcblx0XHQgKi9cblx0XHRmdW5jdGlvbiBkZXNlcmlhbGl6ZShkYXRhKSB7XG5cdFx0XHRyZXR1cm4gZGV2YWx1ZS51bmZsYXR0ZW4oZGF0YSwge1xuXHRcdFx0XHRQcm9taXNlOiAoaWQpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoKGZ1bGZpbCwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdFx0XHRkZWZlcnJlZHMuc2V0KGlkLCB7IGZ1bGZpbCwgcmVqZWN0IH0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRsZXQgdGV4dCA9ICcnO1xuXG5cdFx0d2hpbGUgKHRydWUpIHtcblx0XHRcdC8vIEZvcm1hdCBmb2xsb3dzIG5kanNvbiAoZWFjaCBsaW5lIGlzIGEgSlNPTiBvYmplY3QpIG9yIHJlZ3VsYXIgSlNPTiBzcGVjXG5cdFx0XHRjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuXHRcdFx0aWYgKGRvbmUgJiYgIXRleHQpIGJyZWFrO1xuXG5cdFx0XHR0ZXh0ICs9ICF2YWx1ZSAmJiB0ZXh0ID8gJ1xcbicgOiBkZWNvZGVyLmRlY29kZSh2YWx1ZSwgeyBzdHJlYW06IHRydWUgfSk7IC8vIG5vIHZhbHVlIC0+IGZpbmFsIGNodW5rIC0+IGFkZCBhIG5ldyBsaW5lIHRvIHRyaWdnZXIgdGhlIGxhc3QgcGFyc2VcblxuXHRcdFx0d2hpbGUgKHRydWUpIHtcblx0XHRcdFx0Y29uc3Qgc3BsaXQgPSB0ZXh0LmluZGV4T2YoJ1xcbicpO1xuXHRcdFx0XHRpZiAoc3BsaXQgPT09IC0xKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb25zdCBub2RlID0gSlNPTi5wYXJzZSh0ZXh0LnNsaWNlKDAsIHNwbGl0KSk7XG5cdFx0XHRcdHRleHQgPSB0ZXh0LnNsaWNlKHNwbGl0ICsgMSk7XG5cblx0XHRcdFx0aWYgKG5vZGUudHlwZSA9PT0gJ3JlZGlyZWN0Jykge1xuXHRcdFx0XHRcdHJldHVybiByZXNvbHZlKG5vZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG5vZGUudHlwZSA9PT0gJ2RhdGEnKSB7XG5cdFx0XHRcdFx0Ly8gVGhpcyBpcyB0aGUgZmlyc3QgKGFuZCBwb3NzaWJseSBvbmx5LCBpZiBubyBwZW5kaW5nIHByb21pc2VzKSBjaHVua1xuXHRcdFx0XHRcdG5vZGUubm9kZXM/LmZvckVhY2goKC8qKiBAdHlwZSB7YW55fSAqLyBub2RlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAobm9kZT8udHlwZSA9PT0gJ2RhdGEnKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUudXNlcyA9IGRlc2VyaWFsaXplX3VzZXMobm9kZS51c2VzKTtcblx0XHRcdFx0XHRcdFx0bm9kZS5kYXRhID0gZGVzZXJpYWxpemUobm9kZS5kYXRhKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHJlc29sdmUobm9kZSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAnY2h1bmsnKSB7XG5cdFx0XHRcdFx0Ly8gVGhpcyBpcyBhIHN1YnNlcXVlbnQgY2h1bmsgY29udGFpbmluZyBkZWZlcnJlZCBkYXRhXG5cdFx0XHRcdFx0Y29uc3QgeyBpZCwgZGF0YSwgZXJyb3IgfSA9IG5vZGU7XG5cdFx0XHRcdFx0Y29uc3QgZGVmZXJyZWQgPSAvKiogQHR5cGUge2ltcG9ydCgndHlwZXMnKS5EZWZlcnJlZH0gKi8gKGRlZmVycmVkcy5nZXQoaWQpKTtcblx0XHRcdFx0XHRkZWZlcnJlZHMuZGVsZXRlKGlkKTtcblxuXHRcdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KGRlc2VyaWFsaXplKGVycm9yKSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGRlZmVycmVkLmZ1bGZpbChkZXNlcmlhbGl6ZShkYXRhKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHQvLyBUT0RPIGVkZ2UgY2FzZSBoYW5kbGluZyBuZWNlc3Nhcnk/IHN0cmVhbSgpIHJlYWQgZmFpbHM/XG59XG5cbi8qKlxuICogQHBhcmFtIHthbnl9IHVzZXNcbiAqIEByZXR1cm4ge2ltcG9ydCgndHlwZXMnKS5Vc2VzfVxuICovXG5mdW5jdGlvbiBkZXNlcmlhbGl6ZV91c2VzKHVzZXMpIHtcblx0cmV0dXJuIHtcblx0XHRkZXBlbmRlbmNpZXM6IG5ldyBTZXQodXNlcz8uZGVwZW5kZW5jaWVzID8/IFtdKSxcblx0XHRwYXJhbXM6IG5ldyBTZXQodXNlcz8ucGFyYW1zID8/IFtdKSxcblx0XHRwYXJlbnQ6ICEhdXNlcz8ucGFyZW50LFxuXHRcdHJvdXRlOiAhIXVzZXM/LnJvdXRlLFxuXHRcdHVybDogISF1c2VzPy51cmwsXG5cdFx0c2VhcmNoX3BhcmFtczogbmV3IFNldCh1c2VzPy5zZWFyY2hfcGFyYW1zID8/IFtdKVxuXHR9O1xufVxuXG5mdW5jdGlvbiByZXNldF9mb2N1cygpIHtcblx0Y29uc3QgYXV0b2ZvY3VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2F1dG9mb2N1c10nKTtcblx0aWYgKGF1dG9mb2N1cykge1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRhdXRvZm9jdXMuZm9jdXMoKTtcblx0fSBlbHNlIHtcblx0XHQvLyBSZXNldCBwYWdlIHNlbGVjdGlvbiBhbmQgZm9jdXNcblx0XHQvLyBXZSB0cnkgdG8gbWltaWMgYnJvd3NlcnMnIGJlaGF2aW91ciBhcyBjbG9zZWx5IGFzIHBvc3NpYmxlIGJ5IHRhcmdldGluZyB0aGVcblx0XHQvLyBmaXJzdCBzY3JvbGxhYmxlIHJlZ2lvbiwgYnV0IHVuZm9ydHVuYXRlbHkgaXQncyBub3QgYSBwZXJmZWN0IG1hdGNoIOKAlCBlLmcuXG5cdFx0Ly8gc2hpZnQtdGFiYmluZyB3b24ndCBpbW1lZGlhdGVseSBjeWNsZSB1cCBmcm9tIHRoZSBlbmQgb2YgdGhlIHBhZ2Ugb24gQ2hyb21pdW1cblx0XHQvLyBTZWUgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvaW50ZXJhY3Rpb24uaHRtbCNnZXQtdGhlLWZvY3VzYWJsZS1hcmVhXG5cdFx0Y29uc3Qgcm9vdCA9IGRvY3VtZW50LmJvZHk7XG5cdFx0Y29uc3QgdGFiaW5kZXggPSByb290LmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcblxuXHRcdHJvb3QudGFiSW5kZXggPSAtMTtcblx0XHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0cm9vdC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUsIGZvY3VzVmlzaWJsZTogZmFsc2UgfSk7XG5cblx0XHQvLyByZXN0b3JlIGB0YWJpbmRleGAgYXMgdG8gcHJldmVudCBgcm9vdGAgZnJvbSBzdGVhbGluZyBpbnB1dCBmcm9tIGVsZW1lbnRzXG5cdFx0aWYgKHRhYmluZGV4ICE9PSBudWxsKSB7XG5cdFx0XHRyb290LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCB0YWJpbmRleCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJvb3QucmVtb3ZlQXR0cmlidXRlKCd0YWJpbmRleCcpO1xuXHRcdH1cblxuXHRcdC8vIGNhcHR1cmUgY3VycmVudCBzZWxlY3Rpb24sIHNvIHdlIGNhbiBjb21wYXJlIHRoZSBzdGF0ZSBhZnRlclxuXHRcdC8vIHNuYXBzaG90IHJlc3RvcmF0aW9uIGFuZCBhZnRlck5hdmlnYXRlIGNhbGxiYWNrcyBoYXZlIHJ1blxuXHRcdGNvbnN0IHNlbGVjdGlvbiA9IGdldFNlbGVjdGlvbigpO1xuXG5cdFx0aWYgKHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24udHlwZSAhPT0gJ05vbmUnKSB7XG5cdFx0XHQvKiogQHR5cGUge1JhbmdlW119ICovXG5cdFx0XHRjb25zdCByYW5nZXMgPSBbXTtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3Rpb24ucmFuZ2VDb3VudDsgaSArPSAxKSB7XG5cdFx0XHRcdHJhbmdlcy5wdXNoKHNlbGVjdGlvbi5nZXRSYW5nZUF0KGkpKTtcblx0XHRcdH1cblxuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdGlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCAhPT0gcmFuZ2VzLmxlbmd0aCkgcmV0dXJuO1xuXG5cdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0aW9uLnJhbmdlQ291bnQ7IGkgKz0gMSkge1xuXHRcdFx0XHRcdGNvbnN0IGEgPSByYW5nZXNbaV07XG5cdFx0XHRcdFx0Y29uc3QgYiA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KGkpO1xuXG5cdFx0XHRcdFx0Ly8gd2UgbmVlZCB0byBkbyBhIGRlZXAgY29tcGFyaXNvbiByYXRoZXIgdGhhbiBqdXN0IGBhICE9PSBiYCBiZWNhdXNlXG5cdFx0XHRcdFx0Ly8gU2FmYXJpIGJlaGF2ZXMgZGlmZmVyZW50bHkgdG8gb3RoZXIgYnJvd3NlcnNcblx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHRhLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyICE9PSBiLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyIHx8XG5cdFx0XHRcdFx0XHRhLnN0YXJ0Q29udGFpbmVyICE9PSBiLnN0YXJ0Q29udGFpbmVyIHx8XG5cdFx0XHRcdFx0XHRhLmVuZENvbnRhaW5lciAhPT0gYi5lbmRDb250YWluZXIgfHxcblx0XHRcdFx0XHRcdGEuc3RhcnRPZmZzZXQgIT09IGIuc3RhcnRPZmZzZXQgfHxcblx0XHRcdFx0XHRcdGEuZW5kT2Zmc2V0ICE9PSBiLmVuZE9mZnNldFxuXHRcdFx0XHRcdCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIGlmIHRoZSBzZWxlY3Rpb24gaGFzbid0IGNoYW5nZWQgKGFzIGEgcmVzdWx0IG9mIGFuIGVsZW1lbnQgYmVpbmcgKGF1dG8pZm9jdXNlZCxcblx0XHRcdFx0Ly8gb3IgYSBwcm9ncmFtbWF0aWMgc2VsZWN0aW9uLCB3ZSByZXNldCBldmVyeXRoaW5nIGFzIHBhcnQgb2YgdGhlIG5hdmlnYXRpb24pXG5cdFx0XHRcdC8vIGZpeGVzIGh0dHBzOi8vZ2l0aHViLmNvbS9zdmVsdGVqcy9raXQvaXNzdWVzLzg0Mzlcblx0XHRcdFx0c2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG59XG5cbi8qKlxuICogQHBhcmFtIHtpbXBvcnQoJy4vdHlwZXMuanMnKS5OYXZpZ2F0aW9uU3RhdGV9IGN1cnJlbnRcbiAqIEBwYXJhbSB7aW1wb3J0KCcuL3R5cGVzLmpzJykuTmF2aWdhdGlvbkludGVudCB8IHVuZGVmaW5lZH0gaW50ZW50XG4gKiBAcGFyYW0ge1VSTCB8IG51bGx9IHVybFxuICogQHBhcmFtIHtFeGNsdWRlPGltcG9ydCgnQHN2ZWx0ZWpzL2tpdCcpLk5hdmlnYXRpb25UeXBlLCAnZW50ZXInPn0gdHlwZVxuICovXG5mdW5jdGlvbiBjcmVhdGVfbmF2aWdhdGlvbihjdXJyZW50LCBpbnRlbnQsIHVybCwgdHlwZSkge1xuXHQvKiogQHR5cGUgeyh2YWx1ZTogYW55KSA9PiB2b2lkfSAqL1xuXHRsZXQgZnVsZmlsO1xuXG5cdC8qKiBAdHlwZSB7KGVycm9yOiBhbnkpID0+IHZvaWR9ICovXG5cdGxldCByZWplY3Q7XG5cblx0Y29uc3QgY29tcGxldGUgPSBuZXcgUHJvbWlzZSgoZiwgcikgPT4ge1xuXHRcdGZ1bGZpbCA9IGY7XG5cdFx0cmVqZWN0ID0gcjtcblx0fSk7XG5cblx0Ly8gSGFuZGxlIGFueSBlcnJvcnMgb2ZmLWNoYWluIHNvIHRoYXQgaXQgZG9lc24ndCBzaG93IHVwIGFzIGFuIHVuaGFuZGxlZCByZWplY3Rpb25cblx0Y29tcGxldGUuY2F0Y2goKCkgPT4ge30pO1xuXG5cdC8qKiBAdHlwZSB7aW1wb3J0KCdAc3ZlbHRlanMva2l0JykuTmF2aWdhdGlvbn0gKi9cblx0Y29uc3QgbmF2aWdhdGlvbiA9IHtcblx0XHRmcm9tOiB7XG5cdFx0XHRwYXJhbXM6IGN1cnJlbnQucGFyYW1zLFxuXHRcdFx0cm91dGU6IHsgaWQ6IGN1cnJlbnQucm91dGU/LmlkID8/IG51bGwgfSxcblx0XHRcdHVybDogY3VycmVudC51cmxcblx0XHR9LFxuXHRcdHRvOiB1cmwgJiYge1xuXHRcdFx0cGFyYW1zOiBpbnRlbnQ/LnBhcmFtcyA/PyBudWxsLFxuXHRcdFx0cm91dGU6IHsgaWQ6IGludGVudD8ucm91dGU/LmlkID8/IG51bGwgfSxcblx0XHRcdHVybFxuXHRcdH0sXG5cdFx0d2lsbFVubG9hZDogIWludGVudCxcblx0XHR0eXBlLFxuXHRcdGNvbXBsZXRlXG5cdH07XG5cblx0cmV0dXJuIHtcblx0XHRuYXZpZ2F0aW9uLFxuXHRcdC8vIEB0cy1leHBlY3QtZXJyb3Jcblx0XHRmdWxmaWwsXG5cdFx0Ly8gQHRzLWV4cGVjdC1lcnJvclxuXHRcdHJlamVjdFxuXHR9O1xufVxuXG5pZiAoREVWKSB7XG5cdC8vIE5hc3R5IGhhY2sgdG8gc2lsZW5jZSBoYXJtbGVzcyB3YXJuaW5ncyB0aGUgdXNlciBjYW4gZG8gbm90aGluZyBhYm91dFxuXHRjb25zdCBjb25zb2xlX3dhcm4gPSBjb25zb2xlLndhcm47XG5cdGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIHdhcm4oLi4uYXJncykge1xuXHRcdGlmIChcblx0XHRcdGFyZ3MubGVuZ3RoID09PSAxICYmXG5cdFx0XHQvPChMYXlvdXR8UGFnZXxFcnJvcikoX1tcXHckXSspPz4gd2FzIGNyZWF0ZWQgKHdpdGggdW5rbm93bnx3aXRob3V0IGV4cGVjdGVkKSBwcm9wICcoZGF0YXxmb3JtKScvLnRlc3QoXG5cdFx0XHRcdGFyZ3NbMF1cblx0XHRcdClcblx0XHQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Y29uc29sZV93YXJuKC4uLmFyZ3MpO1xuXHR9O1xuXG5cdGlmIChpbXBvcnQubWV0YS5ob3QpIHtcblx0XHRpbXBvcnQubWV0YS5ob3Qub24oJ3ZpdGU6YmVmb3JlVXBkYXRlJywgKCkgPT4ge1xuXHRcdFx0aWYgKGVycm9yZWQpIHtcblx0XHRcdFx0bG9jYXRpb24ucmVsb2FkKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cbn1cbiIsImltcG9ydCB7IGdldENvbnRleHQgfSBmcm9tICdzdmVsdGUnO1xuaW1wb3J0IHsgQlJPV1NFUiB9IGZyb20gJ2VzbS1lbnYnO1xuaW1wb3J0IHsgc3RvcmVzIGFzIGJyb3dzZXJfc3RvcmVzIH0gZnJvbSAnLi4vY2xpZW50L2NsaWVudC5qcyc7XG5cbi8qKlxuICogQSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYWxsIG9mIHRoZSBjb250ZXh0dWFsIHN0b3Jlcy4gT24gdGhlIHNlcnZlciwgdGhpcyBtdXN0IGJlIGNhbGxlZCBkdXJpbmcgY29tcG9uZW50IGluaXRpYWxpemF0aW9uLlxuICogT25seSB1c2UgdGhpcyBpZiB5b3UgbmVlZCB0byBkZWZlciBzdG9yZSBzdWJzY3JpcHRpb24gdW50aWwgYWZ0ZXIgdGhlIGNvbXBvbmVudCBoYXMgbW91bnRlZCwgZm9yIHNvbWUgcmVhc29uLlxuICovXG5leHBvcnQgY29uc3QgZ2V0U3RvcmVzID0gKCkgPT4ge1xuXHRjb25zdCBzdG9yZXMgPSBCUk9XU0VSID8gYnJvd3Nlcl9zdG9yZXMgOiBnZXRDb250ZXh0KCdfX3N2ZWx0ZV9fJyk7XG5cblx0cmV0dXJuIHtcblx0XHQvKiogQHR5cGUge3R5cGVvZiBwYWdlfSAqL1xuXHRcdHBhZ2U6IHtcblx0XHRcdHN1YnNjcmliZTogc3RvcmVzLnBhZ2Uuc3Vic2NyaWJlXG5cdFx0fSxcblx0XHQvKiogQHR5cGUge3R5cGVvZiBuYXZpZ2F0aW5nfSAqL1xuXHRcdG5hdmlnYXRpbmc6IHtcblx0XHRcdHN1YnNjcmliZTogc3RvcmVzLm5hdmlnYXRpbmcuc3Vic2NyaWJlXG5cdFx0fSxcblx0XHQvKiogQHR5cGUge3R5cGVvZiB1cGRhdGVkfSAqL1xuXHRcdHVwZGF0ZWQ6IHN0b3Jlcy51cGRhdGVkXG5cdH07XG59O1xuXG4vKipcbiAqIEEgcmVhZGFibGUgc3RvcmUgd2hvc2UgdmFsdWUgY29udGFpbnMgcGFnZSBkYXRhLlxuICpcbiAqIE9uIHRoZSBzZXJ2ZXIsIHRoaXMgc3RvcmUgY2FuIG9ubHkgYmUgc3Vic2NyaWJlZCB0byBkdXJpbmcgY29tcG9uZW50IGluaXRpYWxpemF0aW9uLiBJbiB0aGUgYnJvd3NlciwgaXQgY2FuIGJlIHN1YnNjcmliZWQgdG8gYXQgYW55IHRpbWUuXG4gKlxuICogQHR5cGUge2ltcG9ydCgnc3ZlbHRlL3N0b3JlJykuUmVhZGFibGU8aW1wb3J0KCdAc3ZlbHRlanMva2l0JykuUGFnZT59XG4gKi9cbmV4cG9ydCBjb25zdCBwYWdlID0ge1xuXHRzdWJzY3JpYmUoZm4pIHtcblx0XHRjb25zdCBzdG9yZSA9IF9fU1ZFTFRFS0lUX0RFVl9fID8gZ2V0X3N0b3JlKCdwYWdlJykgOiBnZXRTdG9yZXMoKS5wYWdlO1xuXHRcdHJldHVybiBzdG9yZS5zdWJzY3JpYmUoZm4pO1xuXHR9XG59O1xuXG4vKipcbiAqIEEgcmVhZGFibGUgc3RvcmUuXG4gKiBXaGVuIG5hdmlnYXRpbmcgc3RhcnRzLCBpdHMgdmFsdWUgaXMgYSBgTmF2aWdhdGlvbmAgb2JqZWN0IHdpdGggYGZyb21gLCBgdG9gLCBgdHlwZWAgYW5kIChpZiBgdHlwZSA9PT0gJ3BvcHN0YXRlJ2ApIGBkZWx0YWAgcHJvcGVydGllcy5cbiAqIFdoZW4gbmF2aWdhdGluZyBmaW5pc2hlcywgaXRzIHZhbHVlIHJldmVydHMgdG8gYG51bGxgLlxuICpcbiAqIE9uIHRoZSBzZXJ2ZXIsIHRoaXMgc3RvcmUgY2FuIG9ubHkgYmUgc3Vic2NyaWJlZCB0byBkdXJpbmcgY29tcG9uZW50IGluaXRpYWxpemF0aW9uLiBJbiB0aGUgYnJvd3NlciwgaXQgY2FuIGJlIHN1YnNjcmliZWQgdG8gYXQgYW55IHRpbWUuXG4gKiBAdHlwZSB7aW1wb3J0KCdzdmVsdGUvc3RvcmUnKS5SZWFkYWJsZTxpbXBvcnQoJ0BzdmVsdGVqcy9raXQnKS5OYXZpZ2F0aW9uIHwgbnVsbD59XG4gKi9cbmV4cG9ydCBjb25zdCBuYXZpZ2F0aW5nID0ge1xuXHRzdWJzY3JpYmUoZm4pIHtcblx0XHRjb25zdCBzdG9yZSA9IF9fU1ZFTFRFS0lUX0RFVl9fID8gZ2V0X3N0b3JlKCduYXZpZ2F0aW5nJykgOiBnZXRTdG9yZXMoKS5uYXZpZ2F0aW5nO1xuXHRcdHJldHVybiBzdG9yZS5zdWJzY3JpYmUoZm4pO1xuXHR9XG59O1xuXG4vKipcbiAqIEEgcmVhZGFibGUgc3RvcmUgd2hvc2UgaW5pdGlhbCB2YWx1ZSBpcyBgZmFsc2VgLiBJZiBbYHZlcnNpb24ucG9sbEludGVydmFsYF0oaHR0cHM6Ly9raXQuc3ZlbHRlLmRldi9kb2NzL2NvbmZpZ3VyYXRpb24jdmVyc2lvbikgaXMgYSBub24temVybyB2YWx1ZSwgU3ZlbHRlS2l0IHdpbGwgcG9sbCBmb3IgbmV3IHZlcnNpb25zIG9mIHRoZSBhcHAgYW5kIHVwZGF0ZSB0aGUgc3RvcmUgdmFsdWUgdG8gYHRydWVgIHdoZW4gaXQgZGV0ZWN0cyBvbmUuIGB1cGRhdGVkLmNoZWNrKClgIHdpbGwgZm9yY2UgYW4gaW1tZWRpYXRlIGNoZWNrLCByZWdhcmRsZXNzIG9mIHBvbGxpbmcuXG4gKlxuICogT24gdGhlIHNlcnZlciwgdGhpcyBzdG9yZSBjYW4gb25seSBiZSBzdWJzY3JpYmVkIHRvIGR1cmluZyBjb21wb25lbnQgaW5pdGlhbGl6YXRpb24uIEluIHRoZSBicm93c2VyLCBpdCBjYW4gYmUgc3Vic2NyaWJlZCB0byBhdCBhbnkgdGltZS5cbiAqIEB0eXBlIHtpbXBvcnQoJ3N2ZWx0ZS9zdG9yZScpLlJlYWRhYmxlPGJvb2xlYW4+ICYgeyBjaGVjaygpOiBQcm9taXNlPGJvb2xlYW4+IH19XG4gKi9cbmV4cG9ydCBjb25zdCB1cGRhdGVkID0ge1xuXHRzdWJzY3JpYmUoZm4pIHtcblx0XHRjb25zdCBzdG9yZSA9IF9fU1ZFTFRFS0lUX0RFVl9fID8gZ2V0X3N0b3JlKCd1cGRhdGVkJykgOiBnZXRTdG9yZXMoKS51cGRhdGVkO1xuXG5cdFx0aWYgKEJST1dTRVIpIHtcblx0XHRcdHVwZGF0ZWQuY2hlY2sgPSBzdG9yZS5jaGVjaztcblx0XHR9XG5cblx0XHRyZXR1cm4gc3RvcmUuc3Vic2NyaWJlKGZuKTtcblx0fSxcblx0Y2hlY2s6ICgpID0+IHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRCUk9XU0VSXG5cdFx0XHRcdD8gJ0Nhbm5vdCBjaGVjayB1cGRhdGVkIHN0b3JlIGJlZm9yZSBzdWJzY3JpYmluZydcblx0XHRcdFx0OiAnQ2FuIG9ubHkgY2hlY2sgdXBkYXRlZCBzdG9yZSBpbiBicm93c2VyJ1xuXHRcdCk7XG5cdH1cbn07XG5cbi8qKlxuICogQHRlbXBsYXRlIHtrZXlvZiBSZXR1cm5UeXBlPHR5cGVvZiBnZXRTdG9yZXM+fSBOYW1lXG4gKiBAcGFyYW0ge05hbWV9IG5hbWVcbiAqIEByZXR1cm5zIHtSZXR1cm5UeXBlPHR5cGVvZiBnZXRTdG9yZXM+W05hbWVdfVxuICovXG5mdW5jdGlvbiBnZXRfc3RvcmUobmFtZSkge1xuXHR0cnkge1xuXHRcdHJldHVybiBnZXRTdG9yZXMoKVtuYW1lXTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdGBDYW5ub3Qgc3Vic2NyaWJlIHRvICcke25hbWV9JyBzdG9yZSBvbiB0aGUgc2VydmVyIG91dHNpZGUgb2YgYSBTdmVsdGUgY29tcG9uZW50LCBhcyBpdCBpcyBib3VuZCB0byB0aGUgY3VycmVudCByZXF1ZXN0IHZpYSBjb21wb25lbnQgY29udGV4dC4gVGhpcyBwcmV2ZW50cyBzdGF0ZSBmcm9tIGxlYWtpbmcgYmV0d2VlbiB1c2Vycy5gICtcblx0XHRcdFx0J0ZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUgaHR0cHM6Ly9raXQuc3ZlbHRlLmRldi9kb2NzL3N0YXRlLW1hbmFnZW1lbnQjYXZvaWQtc2hhcmVkLXN0YXRlLW9uLXRoZS1zZXJ2ZXInXG5cdFx0KTtcblx0fVxufVxuIiwiPHNjcmlwdD5cblx0aW1wb3J0IHsgcGFnZSB9IGZyb20gJyRhcHAvc3RvcmVzJztcbjwvc2NyaXB0PlxuXG48aDE+eyRwYWdlLnN0YXR1c308L2gxPlxuPHA+eyRwYWdlLmVycm9yPy5tZXNzYWdlfTwvcD5cbiJdLCJuYW1lcyI6WyJzdG9yYWdlLmdldCJdLCJtYXBwaW5ncyI6Ijs7O0FBS08sU0FBUyxJQUFJLEtBQUssUUFBUSxLQUFLLE9BQU87QUFDNUMsTUFBSTtBQUNILFdBQU8sTUFBTSxlQUFlLEdBQUcsQ0FBQztBQUFBLEVBQ2xDLFFBQVM7QUFBQSxFQUVQO0FBQ0Y7QUNYTyxNQUFNLGVBQWU7QUFDckIsTUFBTSxhQUFhO0FDeUREQSxJQUFZLFVBQVUsS0FBSyxDQUFDO0FBTW5DQSxJQUFZLFlBQVksS0FBSyxDQUFBO0FDeER4QyxNQUFNLFlBQVksTUFBTTtBQUM5QixRQUFNLFNBQW9DLFdBQVcsWUFBWTtBQUUxRCxTQUFBO0FBQUE7QUFBQSxJQUVOLE1BQU07QUFBQSxNQUNMLFdBQVcsT0FBTyxLQUFLO0FBQUEsSUFDeEI7QUFBQTtBQUFBLElBRUEsWUFBWTtBQUFBLE1BQ1gsV0FBVyxPQUFPLFdBQVc7QUFBQSxJQUM5QjtBQUFBO0FBQUEsSUFFQSxTQUFTLE9BQU87QUFBQSxFQUFBO0FBRWxCO0FBU08sTUFBTSxPQUFPO0FBQUEsRUFDbkIsVUFBVSxJQUFJO0FBQ2IsVUFBTSxRQUFnRCxVQUFZLEVBQUE7QUFDM0QsV0FBQSxNQUFNLFVBQVUsRUFBRTtBQUFBLEVBQzFCO0FBQ0Q7Ozs7O0FDakNLLFNBQUEsT0FBQSxPQUFBLE1BQU0sTUFBTSxDQUFBLFlBQUEsT0FDYixNQUFNLE9BQU8sT0FBTyxDQUFBOzsiLCJ4X2dvb2dsZV9pZ25vcmVMaXN0IjpbMCwxLDIsMyw0XX0=
